(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{1056:function(t,e,s){t.exports=s.p+"assets/img/8595981e68e85f1bbe6b00c1992fac2f.76471981.png"},1057:function(t,e,s){t.exports=s.p+"assets/img/b072e4bc131649cdb2df78d6834fb2a5.78795f97.png"},1058:function(t,e,s){t.exports=s.p+"assets/img/87aa5ddf8620438fbfd436049752fabb.3119d0ab.png"},1059:function(t,e,s){t.exports=s.p+"assets/img/ee5cdd8bb35d4000b5b8c9b7875b3949.5a5d7439.png"},1060:function(t,e,s){t.exports=s.p+"assets/img/image-20231212192234556.8edef269.png"},1061:function(t,e,s){t.exports=s.p+"assets/img/image-20231215151614961.34de20b6.png"},1062:function(t,e,s){t.exports=s.p+"assets/img/image-20231215152048615.8e70e435.png"},1063:function(t,e,s){t.exports=s.p+"assets/img/image-20231215153721931.bfd6bf0d.png"},1064:function(t,e,s){t.exports=s.p+"assets/img/image-20231215154114740.b1e65ac2.png"},1065:function(t,e,s){t.exports=s.p+"assets/img/image-20231217151126643.0ff726cf.png"},1066:function(t,e,s){t.exports=s.p+"assets/img/image-20231217151159677.a67bf3c2.png"},1067:function(t,e,s){t.exports=s.p+"assets/img/image-20231217151244921.fbb34124.png"},1068:function(t,e,s){t.exports=s.p+"assets/img/image-20231217151505741.87de1aa9.png"},1069:function(t,e,s){t.exports=s.p+"assets/img/image-20231217151608656.64acd913.png"},1070:function(t,e,s){t.exports=s.p+"assets/img/image-20231217152042610.c7dbadb9.png"},1071:function(t,e,s){t.exports=s.p+"assets/img/image-20231217152004513.63e9862b.png"},1072:function(t,e,s){t.exports=s.p+"assets/img/image-20231217152116922.2b69ba6a.png"},1073:function(t,e,s){t.exports=s.p+"assets/img/image-20231217160619817.b1842e4d.png"},1074:function(t,e,s){t.exports=s.p+"assets/img/image-20231217160649310.8da3d8f9.png"},1075:function(t,e,s){t.exports=s.p+"assets/img/image-20231217153111416.10ef5380.png"},1076:function(t,e,s){t.exports=s.p+"assets/img/image-20231217153615857.84b57d24.png"},1077:function(t,e,s){t.exports=s.p+"assets/img/image-20231217153655464.77ac41bf.png"},1078:function(t,e,s){t.exports=s.p+"assets/img/image-20231217153725692.2b4a3913.png"},1079:function(t,e,s){t.exports=s.p+"assets/img/image-20231217153815681.e39151a6.png"},1080:function(t,e,s){t.exports=s.p+"assets/img/image-20231217153833585.214a27f6.png"},1081:function(t,e,s){t.exports=s.p+"assets/img/image-20231217153905835.e296b32f.png"},1082:function(t,e,s){t.exports=s.p+"assets/img/image-20231217152542151.bbd86644.png"},1083:function(t,e,s){t.exports=s.p+"assets/img/image-20231217154641860.848b127d.png"},1084:function(t,e,s){t.exports=s.p+"assets/img/image-20231217154707627.237b3e1d.png"},1085:function(t,e,s){t.exports=s.p+"assets/img/a5154481cf404ef5b1efdfd7da309fd5.64757174.png"},1086:function(t,e,s){t.exports=s.p+"assets/img/0294fa56ef7f43de9dac0d457ef683e1.37f6a827.png"},1087:function(t,e,s){t.exports=s.p+"assets/img/070727556c8645febea27f4e38e8664c.ffa50c41.png"},1088:function(t,e,s){t.exports=s.p+"assets/img/7276c8a470bc4b3bb2fdd6c620796e67.d8bdd94a.png"},1089:function(t,e,s){t.exports=s.p+"assets/img/8bfa9fb75e594d87b8c2180d404532a1.bdfb789f.png"},1090:function(t,e,s){t.exports=s.p+"assets/img/76652e9d87664b2185a324938f6f670e.03fe3625.png"},1091:function(t,e,s){t.exports=s.p+"assets/img/4e16252b5cd84eafbbc83a0a0017ebc5.1f67a664.png"},1092:function(t,e,s){t.exports=s.p+"assets/img/30c7ab2944db45fa8b14c8d9af4beb97.d8a11488.png"},1093:function(t,e,s){t.exports=s.p+"assets/img/a2daf7d616f740b9b2d91f74238e0b8b.79837e92.png"},1094:function(t,e,s){t.exports=s.p+"assets/img/3a4b3cb754584716afd45624a089a3e7.dfb2195f.png"},1095:function(t,e,s){t.exports=s.p+"assets/img/image-20231217154906260.3fbc2eba.png"},1096:function(t,e,s){t.exports=s.p+"assets/img/image-20231217154921358.adb79d5e.png"},1097:function(t,e,s){t.exports=s.p+"assets/img/image-20231217154941982.d3852b87.png"},1098:function(t,e,s){t.exports=s.p+"assets/img/image-20231217154958333.a8ae5567.png"},1099:function(t,e,s){t.exports=s.p+"assets/img/image-20231217155016545.cc10010b.png"},1100:function(t,e,s){t.exports=s.p+"assets/img/image-20231217155035712.2c2a2f83.png"},1101:function(t,e,s){t.exports=s.p+"assets/img/image-20231217155055807.8726c221.png"},1102:function(t,e,s){t.exports=s.p+"assets/img/image-20231217155108228.77eee638.png"},1103:function(t,e,s){t.exports=s.p+"assets/img/image-20231217155157092.66d60ab1.png"},1104:function(t,e,s){t.exports=s.p+"assets/img/image-20231217155311252.2b24d225.png"},1105:function(t,e,s){t.exports=s.p+"assets/img/image-20231217155331604.6b97e43e.png"},1106:function(t,e,s){t.exports=s.p+"assets/img/image-20231217155437060.73d2c979.png"},1107:function(t,e,s){t.exports=s.p+"assets/img/image-20231217155421639.6f34a3b1.png"},1108:function(t,e,s){t.exports=s.p+"assets/img/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBALyrlrojmiqTlpbnnmoTnrJHlrrk=,size_20,color_FFFFFF,t_70,g_se,x_16.966239dc.png"},1109:function(t,e,s){t.exports=s.p+"assets/img/995aec06c0984425adbb592efb684f5f.6c276f35.png"},1110:function(t,e,s){t.exports=s.p+"assets/img/f77eda84e2924061873a3f47f4c54e36.3d3b82b5.png"},1111:function(t,e,s){t.exports=s.p+"assets/img/6812936c8b644040b915e0333288ef8e.4c7e5285.png"},1410:function(t,e,s){"use strict";s.r(e);var n=s(4),a=Object(n.a)({},(function(){var t=this,e=t._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"命令-13-时间日期"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#命令-13-时间日期"}},[t._v("#")]),t._v(" 命令--13.时间日期")]),t._v(" "),e("h2",{attrs:{id:"时区设置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#时区设置"}},[t._v("#")]),t._v(" 时区设置")]),t._v(" "),e("p",[t._v("在"),e("a",{attrs:{href:"https://so.csdn.net/so/search?q=Linux&spm=1001.2101.3001.7020",target:"_blank",rel:"noopener noreferrer"}},[t._v("Linux"),e("OutboundLink")],1),t._v("系统中，默认使用的是UTC时间。")]),t._v(" "),e("p",[t._v("即使在安装系统的时候，选择的时区是亚洲上海，Linux默认的BIOS时间（也称：硬件时间）也是"),e("a",{attrs:{href:"https://so.csdn.net/so/search?q=UTC%E6%97%B6%E9%97%B4&spm=1001.2101.3001.7020",target:"_blank",rel:"noopener noreferrer"}},[t._v("UTC时间"),e("OutboundLink")],1),t._v("。\n在重启之后，系统时间会和硬件时间同步，如果两者不一致，会以硬件时间为标准进行时间的校准。所以，之前设置的时区和时间就失效了\n北京时间比UTC时间早8小时，以2023年1月1日0000UTC为例，UTC时间是零点，北京时间为2023年1月1日早上8点整。")]),t._v(" "),e("div",{staticClass:"language-powershell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-powershell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看当前系统时间")]),t._v("\ndate\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看当前硬件时间")]),t._v("\nhwclock或clock\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#查看当前系统时区")]),t._v("\ndate "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("R\n\n\n\n"),e("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[root@jysp jysp]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# date ")]),t._v("\n2023年 12月 15日 星期五 09:14:28 CST\n\n"),e("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[root@jysp jysp]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# hwclock")]),t._v("\n2023年12月15日 星期五 09时12分57秒  "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("0"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("179492 秒\n\n"),e("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[jysp@jysp ~]")]),t._v("$ date "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("R\nFri"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 15 Dec 2023 09:12:23 "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("0800\n\n")])])]),e("h3",{attrs:{id:"图形化设置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#图形化设置"}},[t._v("#")]),t._v(" 图形化设置")]),t._v(" "),e("p",[t._v("CentOS7如何图形化设置时区？")]),t._v(" "),e("p",[t._v("这与图形化设置网络、设置主机名、设置新用户等，基本相同。过程简单，对于初学者比较友好。")]),t._v(" "),e("h4",{attrs:{id:"_1-进入设置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-进入设置"}},[t._v("#")]),t._v(" 1.进入设置")]),t._v(" "),e("p",[t._v("点击【应用程序】->【系统工具】->【设置】选项")]),t._v(" "),e("p",[e("img",{attrs:{src:s(1056),alt:"https://img-blog.csdnimg.cn/img_convert/8595981e68e85f1bbe6b00c1992fac2f.png"}})]),t._v(" "),e("h4",{attrs:{id:"_2-找到时区"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-找到时区"}},[t._v("#")]),t._v(" 2.找到时区")]),t._v(" "),e("p",[t._v("点击【详细信息】->【日期和时间】")]),t._v(" "),e("p",[e("img",{attrs:{src:s(1057),alt:"img"}})]),t._v(" "),e("h4",{attrs:{id:"_3-操作认证"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-操作认证"}},[t._v("#")]),t._v(" 3.操作认证")]),t._v(" "),e("p",[t._v("点击【解锁】并输入密码进行【认证】")]),t._v(" "),e("p",[t._v("Centos7不需要认证，而Centos8和ubuntu 修改时区时需要认证。按要求认证即可。")]),t._v(" "),e("h4",{attrs:{id:"_4-自动设置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-自动设置"}},[t._v("#")]),t._v(" 4.自动设置")]),t._v(" "),e("p",[t._v("开启【自动设置日期和时间】、【自动设置时区】选项")]),t._v(" "),e("p",[t._v("根据情况，可决定是否开启自动设置。")]),t._v(" "),e("h3",{attrs:{id:"tzselect"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#tzselect"}},[t._v("#")]),t._v(" tzselect")]),t._v(" "),e("p",[t._v("用tzselect设置时区采用人机交互的形式，十分方便。")]),t._v(" "),e("p",[t._v("命令中第一个字母t是时间time的简写;\n命令中第二个字母z是区域zone的简写。")]),t._v(" "),e("p",[t._v("使用tzselect 设置时区，按照提示，一步步进行，没有难度。\n按照提示一路选择: 5) asia —-> 9) china ——> 1) beijing\n但成功设置后，会提示把时区变量作为全局变量添加到profile中")]),t._v(" "),e("p",[e("img",{attrs:{src:s(1058),alt:"img"}})]),t._v(" "),e("p",[t._v("1.可以采用命令追加形式")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",[e("code",[t._v("echo “export TZ='Asia/Shanghai'”  >>/etc/profile\n")])])]),e("p",[t._v("2.可以采用vim 打开文件，在最后一行添加内容")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",[e("code",[t._v("export  TZ='Asia/Shanghai'\n")])])]),e("p",[t._v("保存，退出\n完成对文件的修改后，并不能马上更改时区，仍然需要执行命令 source /etc/profile\n当执行source命令时，系统会退出当前bash，并重新登录。\n再重新查看时间与时区，已更新。")]),t._v(" "),e("h3",{attrs:{id:"timedatectl"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#timedatectl"}},[t._v("#")]),t._v(" timedatectl")]),t._v(" "),e("p",[t._v("timedatectl是一个命令行工具，它允许你查看或者修改系统的时间和日期。它在所有现代的基于 system 的 linux 系统中都可以使用。\ntimedatectl 打印当前时区信息\n如果不带参数直接运行，会正常打印出时间信息。")]),t._v(" "),e("p",[t._v("timedatectl 查看可以设置的时区")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",[e("code",[t._v("timedatectl list-timezones\n")])])]),e("p",[t._v("带上list-timezones参数运行下，看到如下的结果：")]),t._v(" "),e("p",[t._v("上面的结果展示不全， 往下翻找可以看到 Asia/Shanghai 这一行。")]),t._v(" "),e("p",[t._v("不想全部看完，可按q退出查看。")]),t._v(" "),e("p",[t._v("timedatectl 设置时区")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",[e("code",[t._v("timedatectl set-timezone Asia/Shanghai\n")])])]),e("h3",{attrs:{id:"cp文件设置时区"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#cp文件设置时区"}},[t._v("#")]),t._v(" cp文件设置时区")]),t._v(" "),e("p",[t._v("cp文件设置时区")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",[e("code",[t._v("    cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime\n")])])]),e("p",[t._v("这种方式也可以设置时间，但是还是建议使用timedatectl工具。 因为timedatectl工具屏蔽了各个linux的差异性。vim修改时区文件")]),t._v(" "),e("h3",{attrs:{id:"vim修改时区文件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#vim修改时区文件"}},[t._v("#")]),t._v(" vim修改时区文件")]),t._v(" "),e("p",[t._v("我们如何确定自己的时区是正确的？\n时区文件默认的是：/etc/localtime\n下面命令会把我们系统的时间还有时区显示出来")]),t._v(" "),e("p",[e("img",{attrs:{src:s(1059),alt:"img"}})]),t._v(" "),e("p",[t._v("原文链接：https://blog.csdn.net/qq_36142959/article/details/132719285")]),t._v(" "),e("h2",{attrs:{id:"时间命令"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#时间命令"}},[t._v("#")]),t._v(" 时间命令")]),t._v(" "),e("h3",{attrs:{id:"_1、date命令-重点"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1、date命令-重点"}},[t._v("#")]),t._v(" 1、date命令（重点）")]),t._v(" "),e("p",[e("code",[t._v("date")]),t._v(" :"),e("strong",[t._v("打印")]),t._v("或者"),e("strong",[t._v("设置")]),t._v("当前系统日期和时间")]),t._v(" "),e("p",[e("code",[t._v("date --help")]),t._v(" 自己先求帮助")]),t._v(" "),e("div",{staticClass:"language-powershell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-powershell"}},[e("code",[t._v("用法：date "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("选项"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("格式"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n　或：date "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("u"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("utc"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("universal"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[MMDDhhmm[[CC]YY][.ss]]")]),t._v("\nDisplay the current time in the given FORMAT"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" or "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),t._v(" the system date"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n \nMandatory arguments to long options are mandatory "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" short options too"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("d"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("date=STRING         display time described by STRING"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" not "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'now'")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("f"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("file=DATEFILE       like "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("date once "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" each line of DATEFILE\n  "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("I"),e("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[TIMESPEC]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("iso-8601"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("=TIMESPEC"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("  output date/time in ISO 8601 format"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n                            TIMESPEC="),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'date'")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" date only "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("the default"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                            "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'hours'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'minutes'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'seconds'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" or "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ns'")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" date\n                            and time to the indicated precision"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("r"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("reference=文件          显示文件指定文件的最后修改时间\n  "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("R"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("rfc-2822                以RFC 2822格式输出日期和时间\n                                例如：2006年8月7日，星期一 12:34:56 "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("0600\n      "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("rfc-3339=TIMESPEC   output date and time in RFC 3339 format"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n                            TIMESPEC="),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'date'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'seconds'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" or "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ns'")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v("\n                            date and time to the indicated precision"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n                            Date and time components are separated by\n                            a single space: 2006-08-07 12:34:56-06:00\n  "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("s"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),t._v("=STRING          "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),t._v(" time described by STRING\n  "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("u"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("utc"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("universal    print or "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),t._v(" Coordinated Universal Time "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("UTC"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("help            显示此帮助信息并退出\n      "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("version         显示版本信息并退出\n\n给定的格式FORMAT 控制着输出，解释序列如下：\n\n  "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("    一个文字的 "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("a    当前locale 的星期名缩写"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("例如： 日，代表星期日"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("A    当前locale 的星期名全称 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("如：星期日"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("b    当前locale 的月名缩写 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("如：一，代表一月"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("B    当前locale 的月名全称 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("如：一月"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("c    当前locale 的日期和时间 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("如：2005年3月3日 星期四 23:05:25"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("C    世纪；比如 "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("Y，通常为省略当前年份的后两位数字"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("例如：20"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("d    按月计的日期"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("例如：01"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("D    按月计的日期；等于"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("m/"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("d/"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("y\n  "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("e    按月计的日期，添加空格，等于"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("_d\n  "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("F    完整日期格式，等价于 "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("Y-"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("m-"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("d\n  "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("g    ISO-8601 格式年份的最后两位 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("参见"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("G"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("G    ISO-8601 格式年份 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("参见"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("V"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("，一般只和 "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("V 结合使用\n  "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("h    等于"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("b\n  "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("H    小时"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("00-23"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("I    小时"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("00-12"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("j    按年计的日期"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("001-366"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("k   hour"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" space padded "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" 0"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("23"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" same as "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("_H\n  "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("l   hour"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" space padded "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" 1"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("12"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" same as "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("_I\n  "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("m   month "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("01"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("12"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("M   minute "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("00"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("59"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("n    换行\n  "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("N    纳秒"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("000000000-999999999"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("p    当前locale 下的"),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"上午"')]),t._v("或者"),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"下午"')]),t._v("，未知时输出为空\n  "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("P    与"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("p 类似，但是输出小写字母\n  "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("r    当前locale 下的 12 小时时钟时间 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("如：11:11:04 下午"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("R    24 小时时间的时和分，等价于 "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("H:"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("M\n  "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("s    自UTC 时间 1970-01-01 00:00:00 以来所经过的秒数\n  "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("S    秒"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("00-60"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("t    输出制表符 Tab\n  "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("T    时间，等于"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("H:"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("M:"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("S\n  "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("u    星期，1 代表星期一\n  "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("U    一年中的第几周，以周日为每星期第一天"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("00-53"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("V    ISO-8601 格式规范下的一年中第几周，以周一为每星期第一天"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("01-53"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("w    一星期中的第几日"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("0-6"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("，0 代表周一\n  "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("W    一年中的第几周，以周一为每星期第一天"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("00-53"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("x    当前locale 下的日期描述 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("如：12/31/99"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("X    当前locale 下的时间描述 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("如：23:13:48"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("y    年份最后两位数位 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("00-99"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("Y    年份\n  "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("z "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("hhmm              数字时区"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("例如，"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("0400"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v(":z "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("hh:mm            数字时区"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("例如，"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("04:00"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("::z "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("hh:mm:ss        数字时区"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("例如，"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("04:00:00"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v(":::z                 数字时区带有必要的精度 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("例如，"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("04，"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("05:30"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("Z                    按字母表排序的时区缩写 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("例如，EDT"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n默认情况下，日期的数字区域以0 填充。\nThe following optional flags may follow "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'%'")]),t._v(":\n\n  "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("hyphen"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("do")]),t._v(" not pad the field\n  _  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("underscore"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" pad with spaces\n  0  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("zero"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" pad with zeros\n  ^  use upper case "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" possible\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#  use opposite case if possible")]),t._v("\n\n在任何标记之后还允许一个可选的域宽度指定，它是一个十进制数字。\n作为一个可选的修饰声明，它可以是E，在可能的情况下使用本地环境关联的\n表示方式；或者是O，在可能的情况下使用本地环境关联的数字符号。\n\nExamples:\nConvert seconds since the epoch "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("1970-01-01 UTC"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" to a date\n  $ date "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("date="),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@2147483647'")]),t._v("\n\nShow the time on the west coast of the US "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("use tzselect"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("1"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" to find TZ"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  $ TZ="),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'America/Los_Angeles'")]),t._v(" date\n\nShow the local time "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" 9AM next Friday on the west coast of the US\n  $ date "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("date="),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'TZ=\"America/Los_Angeles\" 09:00 next Fri'")]),t._v("\n\nGNU coreutils online help: <http:"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("www"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("gnu"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("org/software/coreutils/>\n请向<http:"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("translationproject"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("org/team/zh_CN"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html> 报告date 的翻译错误\n要获取完整文档，请运行：info coreutils "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'date invocation'")]),t._v("\n")])])]),e("h4",{attrs:{id:"_1-打印日期或时间"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-打印日期或时间"}},[t._v("#")]),t._v(" ① 打印日期或时间")]),t._v(" "),e("div",{staticClass:"language-powershell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-powershell"}},[e("code",[t._v("常用格式：\n    获取系统当前时间\n    yyyy-mm-dd\n\t    date "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("F\n    \tdate "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("Y-"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("m-"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("d\n\n    yyyy-mm-dd HH:mm:ss\n\t    date "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'%F %T'")]),t._v("\n    \tdate "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'%Y-%m-%d %H:%M:%S'")]),t._v("\n\n\t获取非当前时间 days"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("months"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("years\n\tyyyy-mm-dd\n\t\tdate "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("d "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'+3days'")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'%F %T'")]),t._v("\n\t\tdate "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("date="),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'3days'")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'%F %T'")]),t._v("\n\t\t\n\t\tdate "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("d "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'-3days'")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'%F %T'")]),t._v("\n\t\tdate "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("d "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'3days ago'")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'%F %T'")]),t._v("\n\t\tdate "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("date="),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'-3days'")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'%F %T'")]),t._v("\n\n\n\n打印系统当前日期或时间\n"),e("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[root@heima ~]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# date")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[root@heima ~]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# date +%D")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[root@heima ~]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# date +%F")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[root@heima ~]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# date +%Y-%m-%d")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[root@heima ~]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# date +%T")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[root@heima ~]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# date +%X")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[root@heima ~]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# date +'%F %X'")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[root@heima ~]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# date +%c")]),t._v("\n打印系统非当前日期或时间\n"),e("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[root@heima ~]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# date -d '+3days' +%F")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[root@heima ~]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# date -d '-3days' +%F")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[root@heima ~]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# date -d '3days' +%F")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[root@heima ~]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# date -d '3days ago' +%F")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[root@heima ~]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# date --date='30days' +%F")]),t._v("\n\n\n"),e("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[jysp@jysp ~]")]),t._v("$ date "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'%Y %m %d'")]),t._v("\n2023 11 01\n"),e("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[jysp@jysp ~]")]),t._v("$ date "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("T\n10:32:06\n"),e("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[jysp@jysp ~]")]),t._v("$ date "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("X\n10时32分14秒\n"),e("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[jysp@jysp ~]")]),t._v("$ date "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("F "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("X\ndate: 额外的操作数 "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"%X"')]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Try")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'date --help'")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" more information"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[jysp@jysp ~]")]),t._v("$ date "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'%F %X'")]),t._v("\n2023-11-01 10时32分30秒\n"),e("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[jysp@jysp ~]")]),t._v("$ date "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("c\n2023年11月01日 星期三 10时33分10秒\n"),e("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[jysp@jysp ~]")]),t._v("$ date "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("d\ndate：选项需要一个参数 "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v(" d\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Try")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'date --help'")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" more information"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[jysp@jysp ~]")]),t._v("$ date "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("d "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'+3days'")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("F\n2023-11-04\n"),e("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[jysp@jysp ~]")]),t._v("$ date "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("d "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'+3days'")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("c\n2023年11月04日 星期六 10时34分06秒\n"),e("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[jysp@jysp ~]")]),t._v("$ date "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("d "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'-3days'")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("F\n2023-10-29\n"),e("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[jysp@jysp ~]")]),t._v("$ date "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("d "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'3days ago'")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("F\n2023-10-29\n"),e("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[jysp@jysp ~]")]),t._v("$ date "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("d "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'3days'")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("F\n2023-11-04\n"),e("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[jysp@jysp ~]")]),t._v("$ date "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("date="),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'30days'")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("F\n2023-12-01\n"),e("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[jysp@jysp ~]")]),t._v("$ \n")])])]),e("h4",{attrs:{id:"_2-设置系统日期或时间"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-设置系统日期或时间"}},[t._v("#")]),t._v(" ② 设置系统日期或时间")]),t._v(" "),e("div",{staticClass:"language-powershell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-powershell"}},[e("code",[t._v("选项："),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("s 设置当前系统时间，只有root权限才能设置，其他只能查看。\ndate "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("s 20200523 设置成20100523，这样会把具体时间设置成空00:00:00\ndate "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("s "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"01:01:01 2020-05-2"')]),t._v(" 这样可以设置全部时间\ndate "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("s "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"01:01:01 20200523"')]),t._v(" 这样可以设置全部时间\ndate "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("s "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2020-05-23 01:01:01"')]),t._v(" 这样可以设置全部时间\ndate "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("s "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"20200523 01:01:01"')]),t._v(" 这样可以设置全部时间\n\n注意：\n红帽8，设置为过去的时间，过段时间会被重置为当前时间\n")])])]),e("h3",{attrs:{id:"_2、hwclock命令"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2、hwclock命令"}},[t._v("#")]),t._v(" 2、hwclock命令")]),t._v(" "),e("h4",{attrs:{id:"_3-系统时间同步硬件时间"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-系统时间同步硬件时间"}},[t._v("#")]),t._v(" ③ 系统时间同步硬件时间")]),t._v(" "),e("p",[e("code",[t._v("hwclock")]),t._v(" :查看并且设置硬件时间")]),t._v(" "),e("div",{staticClass:"language-powershell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-powershell"}},[e("code",[t._v("选项：\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 设置系统时间：从硬件时间同步到系统时间")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("s"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("hctosys "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),t._v(" the system time "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" the RTC\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 设置硬件时间：从系统时间同步到硬件时间")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("w"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("systohc "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),t._v(" the RTC "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" the system time\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看硬件时间")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("l"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("localtime the RTC timescale is Local\n\n\n举例说明：\n"),e("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[root@heima ~]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# hwclock --hctosys")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[root@heima ~]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# hwclock")]),t._v("\n2019-06-23 18:44:10"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("377920+08:00\n\n"),e("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[root@heima ~]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# date")]),t._v("\n2019年 06月 23日 星期日 18:44:21 CST\n"),e("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[root@heima ~]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# date -s "20221010 12:12:12"')]),t._v("\n2022年 10月 10日 星期一 12:12:12 CST\n"),e("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[root@heima ~]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# date")]),t._v("\n2022年 10月 10日 星期一 12:12:14 CST\n"),e("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[root@heima ~]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# hwclock")]),t._v("\n2019-06-23 18:45:01"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("368135+08:00\n"),e("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[root@heima ~]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# hwclock --systohc")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[root@heima ~]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# hwclock")]),t._v("\n2022-10-10 12:12:43"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("179274+08:00\n")])])]),e("h3",{attrs:{id:"_3、timedatectl命令"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3、timedatectl命令"}},[t._v("#")]),t._v(" 3、timedatectl命令")]),t._v(" "),e("p",[e("code",[t._v("timedatectl")])]),t._v(" "),e("p",[t._v("查看当前时间、时区、NTP服务状态\n设置系统时间、硬件时间、时区")]),t._v(" "),e("blockquote",[e("p",[t._v("ntp服务")])]),t._v(" "),e("div",{staticClass:"language-powershell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-powershell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 从7开始就有")]),t._v("\ntimedatectl "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("h 设置和查看系统的时间和日期（设置时区以及开启或关闭ntp服务）\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看当前时间")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[jysp@jysp ~]")]),t._v("$ timedatectl status\n      Local time: 三 2023-11-01 10:47:08 CST\n  Universal time: 三 2023-11-01 02:47:08 UTC\n        RTC time: 三 2023-11-01 02:47:42\n       Time zone: Asia/Shanghai "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("CST"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("0800"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n     NTP enabled: yes\nNTP synchronized: no\n RTC in local TZ: no\n      DST active: n/a\n\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 关闭NTP同步")]),t._v("\ntimedatectl "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("set-ntp")]),t._v(" no\n\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 设置时间:系统时间、硬件时间")]),t._v("\ntimedatectl "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("set-time")]),t._v(" 2020-10-10\ntimedatectl "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("set-time")]),t._v(" 11:11:11\ntimedatectl list-timezones\ntimedatectl "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("set-timezone")]),t._v(" xxx\n\n\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 同步当前时间")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 6版本中")]),t._v("\nntpdate\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 8版本中")]),t._v("\ntimedatectl "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("set-ntp")]),t._v(" yes\ntimedatectl status\nchronyc makestep\n")])])]),e("h3",{attrs:{id:"_4、cal命令-了解"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4、cal命令-了解"}},[t._v("#")]),t._v(" 4、cal命令（了解）")]),t._v(" "),e("p",[e("code",[t._v("cal")]),t._v(" :查看日历")]),t._v(" "),e("div",{staticClass:"language-powershell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-powershell"}},[e("code",[t._v("用法：\n cal "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("选项"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("日"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" 月"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" 年"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n选项：\n "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("1"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("one        只显示当前月份"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("默认"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("3"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("three      显示上个月、当月和下个月\n "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("s"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("sunday     周日作为一周第一天\n "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("m"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("monday     周一用为一周第一天\n "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("j"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("julian     输出儒略日\n "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("y"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("year       输出整年\n "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("V"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("version    显示版本信息并退出\n "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("h"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("help       显示此帮助并退出\n\n")])])]),e("div",{staticClass:"language-powershell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-powershell"}},[e("code",[t._v("cal 或者 cal "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("1 \t\t表示直接输出当前月份的日历\ncal "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("3 \t\t\t\t 表示输出上一个月"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("本月"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("下个月的日历\ncal "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("y 年份 \t\t\t表示输出某一个年份的日历\n")])])]),e("h3",{attrs:{id:"_5、tzselector-了解"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5、tzselector-了解"}},[t._v("#")]),t._v(" 5、tzselector（了解）")]),t._v(" "),e("p",[t._v("用tzselect设置时区采用人机交互的形式，十分方便。")]),t._v(" "),e("p",[t._v("命令中第一个字母t是时间time的简写;\n命令中第二个字母z是区域zone的简写。")]),t._v(" "),e("p",[t._v("使用tzselect 设置时区，按照提示，一步步进行，没有难度。\n按照提示一路选择: 5) asia —-> 9) china ——> 1) beijing")]),t._v(" "),e("h3",{attrs:{id:"综合应用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#综合应用"}},[t._v("#")]),t._v(" 综合应用")]),t._v(" "),e("h4",{attrs:{id:"_4-应用案例"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-应用案例"}},[t._v("#")]),t._v(" ④ 应用案例")]),t._v(" "),e("blockquote",[e("p",[t._v("有时候我们需要用到当前的系统时间，如何调用？比如以当前系统日期命名创建目录或文件")])]),t._v(" "),e("div",{staticClass:"language-powershell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-powershell"}},[e("code",[t._v("2020-10-10"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("log"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tar"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("gz\n2020-10-11"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("log"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tar"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("gz\n$"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("：括号里面的命令优先执行 \tdate "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("F \t\t2019-06-23\n`` ：引号里面的命令优先执行，不允许嵌套\n\n创建目录和文件，以当前系统日期命名\n"),e("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[root@heima ~]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# mkdir $(date +%F)")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[root@heima ~]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# touch $(date -d '+3days' +%Y%m%d).log")]),t._v("\n")])])]),e("h2",{attrs:{id:"时间同步ntp"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#时间同步ntp"}},[t._v("#")]),t._v(" 时间同步NTP")]),t._v(" "),e("h3",{attrs:{id:"_1、了解时间同步的重要性"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1、了解时间同步的重要性"}},[t._v("#")]),t._v(" 1、了解时间同步的重要性")]),t._v(" "),e("p",[t._v("由于IT系统中，准确的计时非常重要，有很多种原因需要准确计时，如")]),t._v(" "),e("p",[t._v("在网络传输中，数据包和日志需要准确的时间戳")]),t._v(" "),e("p",[t._v("各种应用程序中，如订单信息，交易信息等都需要准确的时间戳")]),t._v(" "),e("p",[t._v("在Linux系统中， Network Time Protocol (NTP)，NTP协议由在用户空间中运行的守护程序实现，即ntp和chrony。")]),t._v(" "),e("blockquote",[e("p",[t._v("红帽6以前使用ntp，红帽7ntp和chrony，红帽8 chrony")])]),t._v(" "),e("h3",{attrs:{id:"_2、了解时间同步服务器"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2、了解时间同步服务器"}},[t._v("#")]),t._v(" 2、了解时间同步服务器")]),t._v(" "),e("p",[e("img",{attrs:{src:s(1060),alt:"image-20231212192234556"}})]),t._v(" "),e("p",[e("strong",[t._v("查看可以提供时间同步的服务器：")])]),t._v(" "),e("p",[t._v("http://www.ntp.org.cn/pool")]),t._v(" "),e("p",[e("img",{attrs:{src:s(1061),alt:"image-20231215151614961"}})]),t._v(" "),e("h3",{attrs:{id:"_3、chrony如何同步自己系统时间"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3、chrony如何同步自己系统时间"}},[t._v("#")]),t._v(" 3、chrony如何同步自己系统时间")]),t._v(" "),e("blockquote",[e("p",[t._v("需要联网")])]),t._v(" "),e("p",[t._v("（1）方式一：自动同步")]),t._v(" "),e("div",{staticClass:"language-powershell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-powershell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 手动设置时间")]),t._v("\ndate "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("s "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2020-10-10 10:10:10"')]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看chrony安装包")]),t._v("\nyum list"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v("grep chrony\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看软件包，配置文件位置")]),t._v("\nrpm "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("qc chrony\n")])])]),e("p",[e("img",{attrs:{src:s(1062),alt:"image-20231215152048615"}})]),t._v(" "),e("div",{staticClass:"language-powershell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-powershell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 重启服务")]),t._v("\nsystemctl restart chronyd"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("service\nsystemctl status chronyd"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("service\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 修改时间，测试自动同步")]),t._v("\ndate "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("s "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2020-10-10 10:10:10"')]),t._v("\n")])])]),e("p",[t._v("（2）方式二：手动临时同步")]),t._v(" "),e("p",[t._v("临时指定ntp服务器同步")]),t._v(" "),e("div",{staticClass:"language-powershell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-powershell"}},[e("code",[t._v("systemctl status chronyd"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("service\nsystemctl stop chronyd"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("service\n\nchronyd "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("q "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"server cn.ntp.org.cn iburst"')]),t._v("\n")])])]),e("h3",{attrs:{id:"_4、chrony搭建时间同步服务"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4、chrony搭建时间同步服务"}},[t._v("#")]),t._v(" 4、chrony搭建时间同步服务")]),t._v(" "),e("h4",{attrs:{id:"一-了解rhel7和rhel8区别"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#一-了解rhel7和rhel8区别"}},[t._v("#")]),t._v(" ㈠ 了解RHEL7和RHEL8区别")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("在RHEL7中，用户可以在"),e("strong",[t._v("ntp")]),t._v("和"),e("strong",[t._v("chrony")]),t._v("之间进行选择，以确保准确的计时。")])]),t._v(" "),e("li",[e("p",[t._v("在RHEL8中，不再支持"),e("strong",[t._v("ntp")]),t._v(",使用"),e("strong",[t._v("chronyd")]),t._v("守护进程来实现NTP,默认已启用,从chrony软件包获得。")])]),t._v(" "),e("li",[e("p",[t._v("chrony和ntp之间的差异")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("ntpd服务器在控制客户端访问方式上默认响应来自任何地址的请求，相对不安全chronyd默认不允许访问，要想提供时间同步服务端需要在allow中指定")])]),t._v(" "),e("li",[e("p",[t._v("ntpd 和 chronyd 在系统时钟校正方面的默认行为也不同。")])]),t._v(" "),e("li",[e("p",[t._v("客户端同步方式有差异")])])])]),t._v(" "),e("li",[e("p",[t._v("还有很多不同可以参考官方网站：https://chrony.tuxfamily.org/comparison.html")])])]),t._v(" "),e("p",[e("strong",[t._v("总结：")])]),t._v(" "),e("p",[e("strong",[t._v("chrony")]),t._v("在各种条件下表现良好，包括间歇性网络连接，高度拥挤的网络，温度变化（普通计算机时钟对温度敏感），以及不能连续运行或在虚拟机上运行的系统。")]),t._v(" "),e("h4",{attrs:{id:"二-rhel8配置时间同步服务"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#二-rhel8配置时间同步服务"}},[t._v("#")]),t._v(" ㈡ RHEL8配置时间同步服务")]),t._v(" "),e("ol",[e("li",[e("p",[t._v("关闭防火墙和selinux（实验）")])]),t._v(" "),e("li",[e("p",[t._v("配置软件仓库")])]),t._v(" "),e("li",[e("p",[t._v("软件三部曲")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("安装软件")])]),t._v(" "),e("li",[e("p",[t._v("确认软件是否成功安装")])]),t._v(" "),e("li",[e("p",[t._v("查看软件的文件列表（配置文件、程序本身、man手册）")])])])]),t._v(" "),e("li",[e("p",[t._v("了解配置文件（man 5 xxx.conf）")])]),t._v(" "),e("li",[e("p",[t._v("根据需求通过修改配置文件来完成服务搭建")])]),t._v(" "),e("li",[e("p",[t._v("启动服务，开机自启动")])]),t._v(" "),e("li",[e("p",[t._v("测试验证")])])]),t._v(" "),e("ul",[e("li",[e("p",[t._v("时间同步服务器端")]),t._v(" "),e("div",{staticClass:"language-powershell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-powershell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 防火墙")]),t._v("\nsystemctl status firewalld"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("service\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# selinux")]),t._v("\ngetenforce\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 软件仓库")]),t._v("\ndnf repolist\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看软件包")]),t._v("\nrpm "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("q chrony\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看配置文件")]),t._v("\nrpm "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("ql chrony\n\n\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# vim /etc/chrony.conf")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#自己本身向谁来同步时间")]),t._v("\npool cn"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ntp"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("org"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cn iburst\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#允许哪些客户端来同步,192.168.159网段的ip/子网掩码24位")]),t._v("\nallow 192"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("168"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("159"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0/24\n\n重启服务\nsystemctl restart chronyd"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("service\n\n查看服务状态\nsystemctl status chronyd"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("service\n\n查看udp端口状态\nnetstat "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("nlup"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v("grep chronyd\n")])])])]),t._v(" "),e("li",[e("p",[t._v("客户端")]),t._v(" "),e("p",[t._v("修改配置文件")]),t._v(" "),e("p",[e("img",{attrs:{src:s(1063),alt:"image-20231215153721931"}})]),t._v(" "),e("div",{staticClass:"language-powershell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-powershell"}},[e("code",[t._v("重启服务\nsystemctl restart chronyd"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("service\n\n查看当前客户端使用的源\nchronyc sources\nchronyc sourcestats\nchronyc sources "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("v\n\n"),e("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[root@client ~]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# chronyc sources")]),t._v("\n210 Number of sources = 1\nMS Name/IP address Stratum Poll Reach LastRx Last sample\n===============================================================================\n^? 192"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("168"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("159"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("100 3 6 37 5 "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("10766h"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("10766h"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" 3872us\n\n手动同步时间，官方不建议使用\n"),e("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[root@client ~]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# chronyc makestep")]),t._v("\n200 OK\n")])])])])]),t._v(" "),e("blockquote",[e("p",[t._v("*代办当前在使用的源")])]),t._v(" "),e("p",[e("img",{attrs:{src:s(1064),alt:"image-20231215154114740"}})]),t._v(" "),e("h3",{attrs:{id:"_5、windows开启ntp服务功能"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5、windows开启ntp服务功能"}},[t._v("#")]),t._v(" 5、windows开启ntp服务功能")]),t._v(" "),e("p",[t._v("（1）打开搜索"),e("code",[t._v("注册表")]),t._v("或"),e("code",[t._v("win+R 输入regedit")])]),t._v(" "),e("p",[e("img",{attrs:{src:s(1065),alt:"image-20231217151126643"}})]),t._v(" "),e("p",[e("img",{attrs:{src:s(1066),alt:"image-20231217151159677"}})]),t._v(" "),e("p",[t._v("（2）设定授权时间服务器")]),t._v(" "),e("p",[t._v("注册表路径： HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\W32Time\\Config")]),t._v(" "),e("p",[t._v("修改 AnnounceFlags 数a改为 5")]),t._v(" "),e("p",[e("img",{attrs:{src:s(1067),alt:"image-20231217151244921"}})]),t._v(" "),e("p",[t._v("HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\W32Time\\TimeProviders\\NtpServer")]),t._v(" "),e("p",[t._v("修改 Enabled 数值0修改为 1")]),t._v(" "),e("p",[e("img",{attrs:{src:s(1068),alt:"image-20231217151505741"}})]),t._v(" "),e("p",[t._v("（3）搜索"),e("code",[t._v("服务")]),t._v("或 "),e("code",[t._v("win+R 输入services.msc")]),t._v("打开服务面板")]),t._v(" "),e("p",[e("img",{attrs:{src:s(1069),alt:"image-20231217151608656"}})]),t._v(" "),e("p",[e("img",{attrs:{src:s(1070),alt:"image-20231217152042610"}})]),t._v(" "),e("p",[t._v("（4）启动服务")]),t._v(" "),e("p",[e("img",{attrs:{src:s(1071),alt:"image-20231217152004513"}})]),t._v(" "),e("p",[e("img",{attrs:{src:s(1072),alt:"image-20231217152116922"}})]),t._v(" "),e("p",[t._v("服务的启停，需要使用管理员运行")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("net start w32time")])]),t._v(" "),e("li",[e("p",[t._v("net stop w32time")])])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("Microsoft Windows [版本 10.0.19045.3693]\n(c) Microsoft Corporation。保留所有权利。\n\nC:\\WINDOWS\\system32>net start w32time\n请求的服务已经启动。\n\n请键入 NET HELPMSG 2182 以获得更多的帮助。\n\n\nC:\\WINDOWS\\system32>net stop w32time\nWindows Time 服务正在停止.\nWindows Time 服务已成功停止。\n\n\nC:\\WINDOWS\\system32>net start w32time\nWindows Time 服务正在启动 .\nWindows Time 服务已经启动成功。\n")])])]),e("p",[e("img",{attrs:{src:s(1073),alt:"image-20231217160619817"}})]),t._v(" "),e("p",[e("img",{attrs:{src:s(1074),alt:"image-20231217160649310"}})]),t._v(" "),e("p",[t._v("本机测试")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("C:\\Users\\miyufeng>w32tm /stripchart /computer:127.0.0.1\n正在跟踪 127.0.0.1 [127.0.0.1:123]。\n当前时间是 2023/12/17 15:23:45。\n15:23:45, d:+00.0013197s o:+00.0004149s  [                           *                           ]\n15:23:47, d:+00.0006835s o:+00.0002398s  [                           *                           ]\n15:23:49, d:+00.0004796s o:+00.0000808s  [                           *                           ]\n")])])]),e("p",[t._v("（5）防火墙配置")]),t._v(" "),e("p",[e("img",{attrs:{src:s(1075),alt:"image-20231217153111416"}})]),t._v(" "),e("p",[e("img",{attrs:{src:s(1076),alt:"image-20231217153615857"}})]),t._v(" "),e("p",[e("img",{attrs:{src:s(1077),alt:"image-20231217153655464"}})]),t._v(" "),e("p",[e("img",{attrs:{src:s(1078),alt:"image-20231217153725692"}})]),t._v(" "),e("p",[e("img",{attrs:{src:s(1079),alt:"image-20231217153815681"}})]),t._v(" "),e("p",[e("img",{attrs:{src:s(1080),alt:"image-20231217153833585"}})]),t._v(" "),e("p",[e("img",{attrs:{src:s(1081),alt:"image-20231217153905835"}})]),t._v(" "),e("p",[t._v("（6）局域网内设备时间同步测试")]),t._v(" "),e("p",[e("img",{attrs:{src:s(1082),alt:"image-20231217152542151"}})]),t._v(" "),e("p",[e("img",{attrs:{src:s(1083),alt:"image-20231217154641860"}})]),t._v(" "),e("p",[e("img",{attrs:{src:s(1084),alt:"image-20231217154707627"}})]),t._v(" "),e("h3",{attrs:{id:"_6、ntp工具"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_6、ntp工具"}},[t._v("#")]),t._v(" 6、ntp工具")]),t._v(" "),e("h4",{attrs:{id:"ntp客户端"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ntp客户端"}},[t._v("#")]),t._v(" ntp客户端")]),t._v(" "),e("p",[t._v("1、安装ntp和"),e("a",{attrs:{href:"https://so.csdn.net/so/search?q=ntpdate&spm=1001.2101.3001.7020",target:"_blank",rel:"noopener noreferrer"}},[t._v("ntpdate"),e("OutboundLink")],1),t._v("两个rpm包。")]),t._v(" "),e("p",[t._v("使用yum install ntp、yum install ntpdate命令执行安装操作（本次省略）")]),t._v(" "),e("p",[t._v("2、配置ntp客户端文件【/etc/ntp.conf】中的server项, 只保留server的有效行（默认有3-4行server有效行去向公网同步时间，需注释掉）。如")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("server "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.29")]),t._v(".12.120  perfer      "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#提供ntp-server的主机地址")]),t._v("\nserver  "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.29")]),t._v(".120.12 perfer  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("iburst）    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#提供ntp-server的主机地址")]),t._v("\n")])])]),e("p",[t._v("#restrict default kod nomodify notrap nopeer noquery 注释此行内容  作为ntp服务器可注释掉（取消默认不行其他主机连接同步时间）")]),t._v(" "),e("p",[t._v("server x.x.x.x iburst  同步时间服务ip  客户端只是配这个就可以")]),t._v(" "),e("p",[t._v("3、启动ntpd服务、并添加至开机启动项。如")]),t._v(" "),e("p",[t._v("启动服务")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("systemctl  start  ntpd        "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#启动ntpd服务")]),t._v("\nsystemctl  start  ntpdate\nsystemctl "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("enable")]),t._v("  ntpd        "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#将ntpd添加到开机启动项")]),t._v("\nsystemctl "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("enable")]),t._v("  ntpdate\nsystemctl is-enabled ntpd        "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#查看是否在开机启动项")]),t._v("\nsystemctl is-enabled ntpdate\nsystemctl list-unit-files "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" ntp     "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#查看是否在开机启动项")]),t._v("\nsystemctl status ntpd                     "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#查看ntpd服务的状态")]),t._v("\n")])])]),e("p",[t._v("4、验证")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v(" ntpq "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p")]),t._v("           "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#查看该主机使用的ntp-server情况和同步延时等信息；")]),t._v("\n timedatectl      "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#查看ntpd服务或chronyd服务是否生效。")]),t._v("\n                  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#只有centos7、redhat7、ubuntu14等以上（含）才有该命令；")]),t._v("\n")])])]),e("p",[t._v("5、其他配置（或添加时间同步的计划任务）\n使用ntpdate命令也可以执行"),e("a",{attrs:{href:"https://so.csdn.net/so/search?q=ntp%E6%97%B6%E9%97%B4%E5%90%8C%E6%AD%A5&spm=1001.2101.3001.7020",target:"_blank",rel:"noopener noreferrer"}},[t._v("ntp时间同步"),e("OutboundLink")],1),t._v("，不需要ntp客户的ntpd服务。如")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("ntpdate "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.29")]),t._v(".120.12     "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#向172.29.120.12的ntpserver主机同步本地系统时间。")]),t._v("\nntpdate "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-u")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.29")]),t._v(".120.12  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("##同上，-u参数是可以在客户端ntpd服务启动时同时执行的命令。")]),t._v("\n")])])]),e("p",[t._v("计划任务中的时间同步，同样的效果。也可以和客户端的ntpd服务同时存在。")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("crontab")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-l")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" * * "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" /usr/sbin/ntpdate "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-u")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.29")]),t._v(".120.12 "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" /usr/sbin/ntpdate "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-u")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.29")]),t._v(".12.120\n")])])]),e("p",[e("img",{attrs:{src:s(1085),alt:"img"}})]),t._v(" "),e("p",[t._v("查看服务状态 ntpstat ntptime timedatectl 三个命令看状态")]),t._v(" "),e("p",[e("img",{attrs:{src:s(1086),alt:"img"}})]),t._v(" "),e("p",[t._v("CentOS7下使用NTP遇到的问题\n问题1、在CentOS7下使用NTP时，客户端ntpd服务添加到开机启动项中了，但主机系统启动后ntpd服务还是停止状态（dead），无法正常启动。\n解决以上现象有两种方法 ，本人常用方法一的操作：\n方法一：\n1.通过命令 systemctl enable ntpd 设置NTP服务开机自启动。\n2.重启虚拟机后查看 服务运行状态 systemctl status ntpd ，发现服务并没有成功启动。\n3.查看chrony是否被设置为开机自启动。通过指令 systemctl is-enabled chronyd\n或systemctl list-unit-files | grep chrony 查看，发现这个服务已经被设置为开机自启动所以导致NTP服务的自启动失败。\n4.所以要把 chrony 的自启动去掉。执行指令 systemctl disable chronyd 。\n5.重启虚拟机， 执行 systemctl status ntpd ，问题解决。\nsystemctl list-unit-files|grep ntpd\nsystemctl list-unit-files|grep chrony\n"),e("img",{attrs:{src:s(1087),alt:"img"}})]),t._v(" "),e("p",[t._v("方法二：\n需要开机自启动某服务，第一个想到的当然是开机启动自定义脚本。\n在Centos之前版本只要在 /etc/rc.d/rc.local 文件中加入 启动服务的命令，当虚拟机重启时就会执行该文件中的命令，服务也就启动了。但是但Centos7版本，这个文件的权限被降低了，所以当你打开这个文件时，注释中很友好的提示让你给这个文件赋权，以确保它有可执行权限。chmod +x /etc/rc.d/rc.local 。\n所以只要把指令写到这个文件中，就可以在开机时启动服务或者让虚拟机做其它事情。\nchmod +x /etc/rc.d/rc.local\necho “systemctl start ntpd” >> !$\n"),e("img",{attrs:{src:s(1088),alt:"img"}})]),t._v(" "),e("p",[t._v("问题2、ntpdate命令执行报错，提示ntpd服务已经存在（ntpdate：the NTP socket is in use, exiting）\n报错的原因是因为客户端有ntpd服务在运行。因此需要继续执行，必须加-u参数，如\nupdate -u 172.29.120.12")]),t._v(" "),e("p",[e("img",{attrs:{src:s(1089),alt:"img"}})]),t._v(" "),e("p",[t._v("问题3、启动了ntpd服务，却未执行过同步时间操作。\n需要检查ntpd服务是否生效、并应用是否也生效了。如")]),t._v(" "),e("p",[e("img",{attrs:{src:s(1090),alt:"img"}})]),t._v(" "),e("p",[e("img",{attrs:{src:s(1091),alt:"img"}})]),t._v(" "),e("p",[t._v("查看状态 ntpstat ntptime timedatectl")]),t._v(" "),e("p",[e("img",{attrs:{src:s(1092),alt:"img"}})]),t._v(" "),e("p",[t._v("1、npq -p 执行结果的参数解释")]),t._v(" "),e("p",[e("img",{attrs:{src:s(1093),alt:"img"}})]),t._v(" "),e("p",[t._v("ntpq -p命令列出了所有作为时钟源校正过本地NTP服务器时钟上层NTP服务器的列表，每一列的含义分别如下：\nremote：响应请求的NTP服务器的名称（IP地址或域名），带“”的表示本地NTP服务器与该服务器同步\nrefid：远程NTP服务器使用的上一级ntp服务器的IP地址\nst：远程NTP服务器的级别，由于NTP是层级结构，有顶端的服务器，多层的Relay Server再到客户端。所以服务器从高到低，级别可以设定为1~16级。为了减缓负荷和网络堵塞，原则上应该避免直接连接到级别为1的服务器。\nt：本地NTP服务器与远程NTP服务器的通信方式。u：单播；b：广播；I：本地\nwhen：上次成功请求后到现在的秒数\npoll：本地NTP服务器与远程NTP服务器同步的时间间隔。\nreach：这是一个八进制的值，用来测试衡量前八次查询是否成功和服务器连接。377表示都成功，0表示不成功\ndelay：网络延时，单位为微秒（μs）\noffset：本地NTP服务器与远程NTP服务器的时间偏移，单位为毫秒（ms）。offset越接近于0，主机与NTP服务器的时间越接近\njitter：查询偏差的分布值，用于表示远程NTP的网络延时是否稳定，单位为微秒（μs）*")]),t._v(" "),e("p",[t._v("2、timedatectl 命令的讲解\ntimedatectl输出解析")]),t._v(" "),e("p",[e("img",{attrs:{src:s(1094),alt:"img"}})]),t._v(" "),e("p",[t._v("1.1.Local time\n本地时间，初始值来自于RTC，由内核维护，系统启动之后和RTC就没有关系，通常等于RTC+时区值（如上图的本地时间=RTC+8）")]),t._v(" "),e("p",[t._v("1.2.Universal time\n系统时间永远是UTC，在应用程序使用的时候转换为本地时间")]),t._v(" "),e("p",[t._v("1.3.RTC（real-time clock）time\n指硬件时间，一般是主板上的特殊电路，专用用于记录时间，有电池供电，不受服务器和操作系统的开启关闭影响。也称作BIOS时间。\n需要注意的是：当/etc/sysconfig/clock 文件中 UTC=true时， BIOS 使用UTC时间； UTC=false时， BIOS 使用本地时间。\nhwclock --localtime #显示 BIOS 中实际的时间\nhwclock --systohc #根据系统时间设置硬件时间")]),t._v(" "),e("p",[t._v("1.4.Time zone\n本地时区，即服务器所在的时区，在中国通常使用Asia/Shanghai\ntimedatectl set-timezone “Asia/Shanghai” #设置时区为上海")]),t._v(" "),e("p",[t._v("1.5.NTP enable\n状态为“yes”,表示开启NTP同步。\n网络时间协议，英文名称：Network Time Protocol（NTP）是用来使计算机时间同步化的一种协议，它可以使计算机对其服务器或时钟源（如石英钟，GPS等等)做同步化，它可以提供高精准度的时间校正。\ntimedatectl set-ntp true #开启ntp同步\ntimedatectl set-ntp false #禁止ntp同步")]),t._v(" "),e("p",[t._v("1.6.NTP synchronized\n为“yes”,表示NTP同步完成。")]),t._v(" "),e("p",[t._v('1.7.RTC in local TZ\n设置RTC时间，为"no"表示未设置\ntimedatectl set-local-rtc 1 #将RTC设置为本地时间\ntimedatectl set-local-rtc 0 #将RTC设置为UTC')]),t._v(" "),e("p",[t._v("2.2、timedatectl常用命令\ntimedatectl set-time 15:58:30 #只设置时间\ntimedatectl set-time 20151120 #只设置日期\ntimedatectl set-time ‘16:10:40 2015-11-20’ #设置时间和日期2.3 相关命令")]),t._v(" "),e("p",[t._v("rpm -qi ntp 查看版本   最新")]),t._v(" "),e("p",[t._v("date  系统时间\nclock  硬件时间")]),t._v(" "),e("p",[t._v("date -s  设置系统时间\nclock  -w 系统时间同步到硬件时间")]),t._v(" "),e("p",[t._v("ntpdate IP  同步ntp服务器时间")]),t._v(" "),e("p",[t._v("chkconfig --list ntpd 查看开机启动")]),t._v(" "),e("p",[t._v("chkconfig ntpd on  开机启动")]),t._v(" "),e("p",[t._v("ntpq -p  客户端查看同步情况 *号代表同步成功\nntpstat")]),t._v(" "),e("p",[t._v("ps aux | grep ntpd  查看进程")]),t._v(" "),e("p",[t._v("ss -ntul 看进程端口\nnetstat -anp | grep   ntpd\nss -ntulp  看进程端口")]),t._v(" "),e("p",[t._v('crontab -l; echo "*/60 * * * * /usr/sbin/ntpdate x.x.x.x(ntp服务器IP) >>/tmp/ntp.log  设置定时同步\ncrontab -l   查看计划任务')]),t._v(" "),e("p",[t._v('echo "*/60 * * * * /usr/sbin/ntpdate x.x.x.x(ntp服务器IP) >>/tmp/ntp.log')]),t._v(" "),e("p",[e("img",{attrs:{src:s(1095),alt:"image-20231217154906260"}})]),t._v(" "),e("p",[e("img",{attrs:{src:s(1096),alt:"image-20231217154921358"}})]),t._v(" "),e("p",[e("img",{attrs:{src:s(1097),alt:"image-20231217154941982"}})]),t._v(" "),e("p",[e("img",{attrs:{src:s(1098),alt:"image-20231217154958333"}})]),t._v(" "),e("p",[e("img",{attrs:{src:s(1099),alt:"image-20231217155016545"}})]),t._v(" "),e("p",[e("img",{attrs:{src:s(1100),alt:"image-20231217155035712"}})]),t._v(" "),e("p",[e("img",{attrs:{src:s(1101),alt:"image-20231217155055807"}})]),t._v(" "),e("p",[e("img",{attrs:{src:s(1102),alt:"image-20231217155108228"}})]),t._v(" "),e("p",[e("img",{attrs:{src:s(1103),alt:"image-20231217155157092"}})]),t._v(" "),e("p",[e("img",{attrs:{src:s(1104),alt:"image-20231217155311252"}})]),t._v(" "),e("p",[e("img",{attrs:{src:s(1105),alt:"image-20231217155331604"}})]),t._v(" "),e("p",[e("img",{attrs:{src:s(1106),alt:"image-20231217155437060"}})]),t._v(" "),e("p",[e("img",{attrs:{src:s(1107),alt:"image-20231217155421639"}})]),t._v(" "),e("h2",{attrs:{id:"chrony和ntp"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#chrony和ntp"}},[t._v("#")]),t._v(" chrony和ntp")]),t._v(" "),e("h3",{attrs:{id:"chrony和ntp的区别"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#chrony和ntp的区别"}},[t._v("#")]),t._v(" chrony和ntp的区别")]),t._v(" "),e("ul",[e("li",[t._v("（1）chronyd做的比ntpd好的\n"),e("ul",[e("li",[t._v("chronyd可以在时断时续访问参考时间源的环境下工作，而ntpd需要定期轮询参考时间源才能正常工作。")]),t._v(" "),e("li",[t._v("即使网络拥塞时间更长，chronyd也可以运行良好。")]),t._v(" "),e("li",[t._v("chronyd通常可以更快、更准确地同步时钟。")]),t._v(" "),e("li",[t._v("chronyd能够快速适应晶体振荡器温度变化引起的时钟频率的突然变化，而ntpd可能需要很长时间才能稳定下来。")]),t._v(" "),e("li",[t._v("在默认配置下，为了不影响其他正在运行的程序，chronyd从不在系统启动同步时钟之后执行时间步进。ntpd也可以配置为从不步进时间，但它必须使用不同的方法来调整时钟，这有一些缺点，包括对时钟精度的负面影响。")]),t._v(" "),e("li",[t._v("chronyd可以在更大的范围内调整Linux系统上的时钟频率，这使得它甚至可以在时钟损坏或不稳定的机器上运行。例如，在一些虚拟机上。")]),t._v(" "),e("li",[t._v("chronyd体积更小，占用的内存更少，而且只有在必要的时候才会唤醒CPU，这对于节能来说是更好的选择。")])])]),t._v(" "),e("li",[t._v("（2）chronyd能做的但ntpd做不到的\n"),e("ul",[e("li",[t._v("chronyd提供了对孤立网络的支持，在孤立网络中，时间校正的唯一方法就是手动输入。例如，由管理员查看时钟。chronyd可以检查在不同的更新中修正的错误，从而估算出计算机增加或减少时间的速度，并在随后使用这个估算来调整计算机时钟。")]),t._v(" "),e("li",[t._v("chronyd可以计算RTC时钟（在计算机关闭时保持时间的时钟）的增益和损耗率。它可以在系统启动时使用这些计算的数据，以及从RTC时钟获取的时间调整值来设置系统时间。RTC时钟设备目前仅在Linux系统上可用。"),e("br"),t._v("\n支持Linux上的硬件时间戳，允许在本地网络上进行非常精确的同步。")])])]),t._v(" "),e("li",[t._v("（3）ntpd做得到但chronyd做不到的\n"),e("ul",[e("li",[t._v("ntpd支持NTP v4（RFC 5905）的所有同步模式，包括broadcast、multicast和manycast clients and servers模式。请注意，broadcast和multicast模式（即使有身份验证）与普通servers and clients模式相比，更不精确、更不安全，通常应避免使用。")]),t._v(" "),e("li",[t._v("ntpd支持使用公钥加密的Autokey协议（RFC 5906）对服务器进行身份验证。注意，该协议已被证明是不安全的，可能会被Network Time Security（NTS）取代。")]),t._v(" "),e("li",[t._v("ntpd包含很多参考时间源的驱动程序，而chronyd依赖于其他程序（例如gpsd），以使用共享内存（SHM）或Unix domain socket（SOCK）访问参考时间源的数据。")])])]),t._v(" "),e("li",[t._v("（4）chronyd与ntpd，该怎么选\n"),e("ul",[e("li",[t._v("除了由不支持Chrony的工具管理或监视的系统，或者具有不能与Chrony一起使用的硬件参考时钟的系统之外，其他系统都应该首选Chrony。")]),t._v(" "),e("li",[t._v("需要使用Autokey协议对数据包进行身份验证的系统只能使用ntpd，因为chronyd不支持这个协议。Autokey协议存在严重的安全问题，应避免使用该协议。使用对称密钥进行身份验证，而不是使用Autokey，这是chronyd和ntpd都支持的。Chrony支持更强的哈希函数，如SHA256和SHA512，而ntpd只能使用MD5和SHA1。")])])])]),t._v(" "),e("h3",{attrs:{id:"chrony的组成与端口说明"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#chrony的组成与端口说明"}},[t._v("#")]),t._v(" chrony的组成与端口说明")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("chrony 是由 守护进程 chronyd 以及 命令行工具 chronyc 组成的，具体如下图"),e("br"),t._v(" "),e("img",{attrs:{src:s(1108),alt:"在这里插入图片描述"}})])]),t._v(" "),e("li",[e("p",[t._v("chronyd 在后台静默运行并通过 "),e("code",[t._v("123")]),t._v(" 端口与时间服务器定时同步时间，默认的配置文件是 "),e("code",[t._v("/etc/chrony.conf")])])]),t._v(" "),e("li",[e("p",[t._v("chronyc 通过 "),e("code",[t._v("323")]),t._v(" 端口与 chronyd 交互，可监控 chronyd 的性能并在运行时更改各种操作参数"),e("br"),t._v("\nchronyc 通过下面的方式访问 chronyd")]),t._v(" "),e("ul",[e("li",[t._v("1、通过 IPv4 或 IPv6 访问")]),t._v(" "),e("li",[t._v("2、通过 Unix 域 socket, 但只能访问到本地的 chronyd，而且需要 root 用户或者 chrony 用户才能访问")])])]),t._v(" "),e("li",[e("p",[t._v("chronyd和ntp一样，端口都是"),e("code",[t._v("udp")])])])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("[root@yum-centos-dmz ~]# netstat -nulp | grep chro\nudp        0      0 0.0.0.0:123             0.0.0.0:*                           8938/chronyd        \nudp        0      0 127.0.0.1:323           0.0.0.0:*                           8938/chronyd        \nudp6       0      0 ::1:323                 :::*                                8938/chronyd        \n[root@yum-centos-dmz ~]# \n\n")])])]),e("ul",[e("li",[t._v("默认情况下，chronyc 先通过 Unix 域 socket 访问 chronyd，默认的 socket 文件是 "),e("code",[t._v("/var/run/chrony/chronyd.sock")]),t._v(", 如果失败（常见的原因是使用非 root 用户运行 chronyc ），将尝试通过 127.0.0.1 访问 chronyd")])]),t._v(" "),e("h3",{attrs:{id:"chrony安装和命令管理说明"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#chrony安装和命令管理说明"}},[t._v("#")]),t._v(" chrony安装和命令管理说明")]),t._v(" "),e("ul",[e("li",[t._v("在新的 Linux 发行版（centos8、Ubuntu 20.04、Fedora 30）及以后的版本中，系统默认已经安装了 chrony，在这之前的版本是没有安装的，可以使用下面的命令进行安装"),e("br"),t._v(" "),e("code",[t._v("yum install chrony -y")])]),t._v(" "),e("li",[t._v("安装完成后，chrony 服务默认会自动加到 systemctl 中管理，下面列出了一些常用的命令")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("#查询 chronyd 服务状态\nsystemctl status chronyd     \n\n#启动 chronyd 服务\nsystemctl start chronyd   \n\n#关闭 chronyd 服务\nsystemctl stop chronyd   \n\n#重启 chronyd 服务\nsystemctl restart chronyd   \n\n#设置 chronyd 服务开机自启\nsystemctl enable chronyd\nsystemctl daemon-reload\n\n")])])]),e("h4",{attrs:{id:"启动服务报错处理"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#启动服务报错处理"}},[t._v("#")]),t._v(" 启动服务报错处理")]),t._v(" "),e("p",[t._v("另外，启动 chronyd 服务的时候如果出现下面截图中的错误，需要安装或者升级 "),e("code",[t._v("libsepol")]),t._v("、"),e("code",[t._v("policycoreutils-python")]),t._v("【最小化安装的系统可能会出现这种问题】\n查看日志或者执行"),e("code",[t._v("journalctl -xe")]),t._v("均可查看报错内容~")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("具体的问题说明详见"),e("a",{attrs:{href:"https://bugzilla.redhat.com/show_bug.cgi?id=1592775",target:"_blank",rel:"noopener noreferrer"}},[t._v("Red Hat Bugzilla – Bug 1592775"),e("OutboundLink")],1)])]),t._v(" "),e("li",[e("p",[t._v("解决方法 安装 libsepol 和 policycoreutils-python\n"),e("code",[t._v("yum install libsepol policycoreutils-python -y")])])])]),t._v(" "),e("h3",{attrs:{id:"chrony常用配置参数说明"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#chrony常用配置参数说明"}},[t._v("#")]),t._v(" chrony常用配置参数说明")]),t._v(" "),e("ul",[e("li",[t._v("守护进程 chronyd 的默认配置文件是 "),e("code",[t._v("/etc/chrony.conf")]),t._v("，其中可配置项很多，这里介绍一些常用的")])]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("配置项")]),t._v(" "),e("th",[t._v("说明")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("server")]),t._v(" "),e("td",[t._v("客户端需找哪个服务器询问当前时间")])]),t._v(" "),e("tr",[e("td",[t._v("pool")]),t._v(" "),e("td",[t._v("同 server 配置项")])]),t._v(" "),e("tr",[e("td",[t._v("driftfile")]),t._v(" "),e("td",[t._v("本地时钟和服务器时钟的预估漂移保存到哪个文件中")])]),t._v(" "),e("tr",[e("td",[t._v("makestep")]),t._v(" "),e("td",[t._v("纠正客户端时间的步进参数")])]),t._v(" "),e("tr",[e("td",[t._v("rtcsync")]),t._v(" "),e("td",[t._v("是否允许内核同步实时时钟")])]),t._v(" "),e("tr",[e("td",[t._v("allow")]),t._v(" "),e("td",[t._v("允许客户端通过内网地址同步时钟")])]),t._v(" "),e("tr",[e("td",[t._v("local stratum 10")]),t._v(" "),e("td",[t._v("开启，即使server指令种时间服务器不可用，也允许将本地时间作为标准时间授予其他客户端")])]),t._v(" "),e("tr",[e("td",[t._v("logdir")]),t._v(" "),e("td",[t._v("日志目录")])])])]),t._v(" "),e("h3",{attrs:{id:"chronyd常用命令说明"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#chronyd常用命令说明"}},[t._v("#")]),t._v(" chronyd常用命令说明")]),t._v(" "),e("ul",[e("li",[t._v("查看时间同步源状态： "),e("code",[t._v("chronyc sourcestats -v")]),t._v(" 【-v是列出详细，可以不要】")]),t._v(" "),e("li",[t._v("立即校准时间服务器："),e("code",[t._v("chronyc tracking")]),t._v(" 【配置的时候默认是自动校准的，一般用于服务端修改时间了，客户端立即校准用】")]),t._v(" "),e("li",[t._v("启用NTP时间同步： "),e("code",[t._v("timedatectl set-ntp yes")]),t._v("【默认是启用的，timedatectl命令可以查看状态】")]),t._v(" "),e("li",[t._v("查看客户端连接情况【服务端执行】："),e("code",[t._v("chronyc clients")])]),t._v(" "),e("li",[t._v("列出ntp状态详细："),e("code",[t._v("timedatectl")]),e("br"),t._v("\n下面timedatectl说明中有详细介绍哈\n"),e("ul",[e("li",[t._v("设置硬件时间"),e("br"),t._v("\n硬件时间默认为UTC： "),e("code",[t._v("timedatectl set-local-rtc 1/0")]),t._v(" "),e("ul",[e("li",[t._v("设置硬件时钟为本地时间："),e("code",[t._v("timedatectl set-local-rtc 1")])]),t._v(" "),e("li",[t._v("设置硬件时钟为UTC时间："),e("code",[t._v("timedatectl set-local-rtc 0")])])])]),t._v(" "),e("li",[t._v("启用NTP时间同步： "),e("code",[t._v("timedatectl set-ntp yes")])]),t._v(" "),e("li",[t._v("开启 NTP："),e("code",[t._v("timedatectl set-ntp true/flase")])]),t._v(" "),e("li",[t._v("校准时间服务器： "),e("code",[t._v("chronyc tracking")])])])])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("[root@yum-centos-dmz ~]# timedatectl \n      Local time: Wed 2022-07-06 09:53:00 CST\n  Universal time: Wed 2022-07-06 01:53:00 UTC\n        RTC time: Wed 2022-07-06 01:44:58\n       Time zone: Asia/Shanghai (CST, +0800)  # 当前zone【我们要 +8 才正常】 最后timedatectl命令有说如何定义\n     NTP enabled: yes   # ntp是否启用\nNTP synchronized: yes  # 是否完成过一次ntp同步\n RTC in local TZ: no    #是否启用rtc时间【我们为cst+8，所以这为no才是正常的】\n      DST active: n/a\n[root@yum-centos-dmz ~]# \n\n")])])]),e("h4",{attrs:{id:"ntpdate客户端立即更新时间"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ntpdate客户端立即更新时间"}},[t._v("#")]),t._v(" ntpdate客户端立即更新时间")]),t._v(" "),e("ul",[e("li",[t._v("立即更新时间，我们可以使用ntpdate"),e("br"),t._v("\n这个还是比较好用的，如果服务端时间更新了，客户端没有及时更新，可以执行这个命令"),e("br"),t._v("\n如下，我在服务端更新时间了")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('[root@ccx_server128 ~]# date\n2022年 03月 01日 星期二 01:10:04 CST\n[root@ccx_server128 ~]# timedatectl set-time "2022-02-28 17:10:34"\nFailed to set time: Automatic time synchronization is enabled\n[root@ccx_server128 ~]# timedatectl \n      Local time: 二 2022-03-01 01:13:18 CST\n  Universal time: 一 2022-02-28 17:13:18 UTC\n        RTC time: 一 2022-02-28 17:13:18\n       Time zone: Asia/Shanghai (CST, +0800)\n     NTP enabled: yes\nNTP synchronized: no\n RTC in local TZ: no\n      DST active: n/a\n[root@ccx_server128 ~]# timedatectl set-time "2022-06-28 17:10:34"\nFailed to set time: Automatic time synchronization is enabled\n[root@ccx_server128 ~]# timedatectl set-ntp no\n[root@ccx_server128 ~]# timedatectl set-time "2022-02-28 17:13:55"\n[root@ccx_server128 ~]# date\n2022年 02月 28日 星期一 17:13:57 CST\n[root@ccx_server128 ~]# timedatectl \n      Local time: 一 2022-02-28 17:14:02 CST\n  Universal time: 一 2022-02-28 09:14:02 UTC\n        RTC time: 一 2022-02-28 09:14:02\n       Time zone: Asia/Shanghai (CST, +0800)\n     NTP enabled: no\nNTP synchronized: no\n RTC in local TZ: no\n      DST active: n/a\n[root@ccx_server128 ~]# timedatectl set-ntp yes\n[root@ccx_server128 ~]# \n\n# 然后我去客户端立即获取。。。多香啊\n[root@ccx_server129 ~]# date\nTue Mar  1 01:15:13 CST 2022\n[root@ccx_server129 ~]# \n[root@ccx_server129 ~]# ntpdate 192.168.59.128\n28 Feb 17:15:37 ntpdate[46458]: step time server 192.168.59.128 offset -28789.784156 sec\n[root@ccx_server129 ~]# date\nMon Feb 28 17:15:39 CST 2022\n[root@ccx_server129 ~]# \n\n')])])]),e("ul",[e("li",[t._v("当然，这也带来一个问题，好像chronyd状态出问题了，不是"),e("code",[t._v("^*")]),t._v("了，然后重启一下又恢复正常，所以，可能这个netdate和重启服务效果一样吧。")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("[root@ccx_server129 ~]# chronyc sources\n210 Number of sources = 1\nMS Name/IP address         Stratum Poll Reach LastRx Last sample               \n===============================================================================\n^? ccx_server128                 0   6   377     -     +0ns[   +0ns] +/-    0ns\n[root@ccx_server129 ~]# systemctl restart chronyd #重启了\n[root@ccx_server129 ~]# chronyc sources\n210 Number of sources = 1\nMS Name/IP address         Stratum Poll Reach LastRx Last sample               \n===============================================================================\n^? ccx_server128                10   6     1     2  -3874ns[-3874ns] +/-  106us\n[root@ccx_server129 ~]# chronyc sources\n210 Number of sources = 1\nMS Name/IP address         Stratum Poll Reach LastRx Last sample               \n===============================================================================\n^* ccx_server128                10   6     7     1  +1884ns[-7831ns] +/-   99us\n[root@ccx_server129 ~]# \n\n")])])]),e("h2",{attrs:{id:"内网chrony配置时间同步"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#内网chrony配置时间同步"}},[t._v("#")]),t._v(" 内网chrony配置时间同步")]),t._v(" "),e("h3",{attrs:{id:"内网环境服务端配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#内网环境服务端配置"}},[t._v("#")]),t._v(" 内网环境服务端配置")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("守护进程 chronyd 既可作为客户端 与 服务器同步时间，又可作为一个服务器，接受其他客户端同步时间的请求")])]),t._v(" "),e("li",[e("p",[t._v("下面以配置局域网时间服务器为例来说明 chronyd 的客户端和服务器的配置，虚拟机规划如下：")])])]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("用途")]),t._v(" "),e("th",[t._v("ip")]),t._v(" "),e("th",[t._v("系统")]),t._v(" "),e("th",[t._v("配置前系统时间")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("服务端ip")]),t._v(" "),e("td",[t._v("192.168.59.128")]),t._v(" "),e("td",[t._v("CentOS Linux release 7.6.1810 (Core)")]),t._v(" "),e("td",[t._v("2022年 02月 28日 星期一 19:41:38 CST")])]),t._v(" "),e("tr",[e("td",[t._v("客户端ip")]),t._v(" "),e("td",[t._v("192.168.59.129")]),t._v(" "),e("td",[t._v("CentOS Linux release 7.6.1810 (Core)")]),t._v(" "),e("td",[t._v("Mon Feb 28 06:46:54 EST 2022")])])])]),t._v(" "),e("ul",[e("li",[t._v("注：我上面2台虚拟机没有通公网的，所以我下面安装服务用的是本地源方式搭建。")])]),t._v(" "),e("h3",{attrs:{id:"时区确定"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#时区确定"}},[t._v("#")]),t._v(" 时区确定")]),t._v(" "),e("ul",[e("li",[t._v("配置前先执行timedatectl 如果是UTC时间，如下"),e("code",[t._v("UTC，+0")]),t._v("，则需要修改时区")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("[root@test21 ~]# timedatectl \n      Local time: Wed 2022-07-06 06:50:32 UTC\n  Universal time: Wed 2022-07-06 06:50:32 UTC\n        RTC time: Wed 2022-07-06 06:50:32\n       Time zone: UTC (UTC, +0000)\n     NTP enabled: yes\nNTP synchronized: no\n RTC in local TZ: no\n      DST active: n/a\n[root@test21 ~]# \n\n")])])]),e("ul",[e("li",[t._v("修改方式为： "),e("code",[t._v("timedatectl set-timezone Asia/Shanghai")]),t._v("，修改后正确信息如下")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("[root@test21 ~]# timedatectl set-timezone Asia/Shanghai\n[root@test21 ~]# timedatectl \n      Local time: Wed 2022-07-06 14:54:56 CST\n  Universal time: Wed 2022-07-06 06:54:56 UTC\n        RTC time: Wed 2022-07-06 06:54:56\n       Time zone: Asia/Shanghai (CST, +0800)\n     NTP enabled: yes\nNTP synchronized: no\n RTC in local TZ: no\n      DST active: n/a\n[root@test21 ~]# \n\n")])])]),e("h3",{attrs:{id:"安装chrony"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装chrony"}},[t._v("#")]),t._v(" 安装chrony")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("[root@ccx_server128 ~]# yum install -y chrony\n[root@ccx_server128 ~]# \n[root@ccx_server128 ~]# systemctl enable chronyd --now\n[root@ccx_server128 ~]# systemctl is-active chronyd\nactive\n[root@ccx_server128 ~]# \n")])])]),e("h3",{attrs:{id:"服务端配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#服务端配置"}},[t._v("#")]),t._v(" 服务端配置")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("安装 chrony 之后，默认的配置是客户端的启动配置的，要想作为一个时间服务器来运行的话， 需要在配置中增加 "),e("code",[t._v("allow")]),t._v(" 配置项，它表示允许客户端通过该地址和服务器同步时间"),e("br"),t._v("\n默认配置文件："),e("code",[t._v("/etc/chrony.conf")])])]),t._v(" "),e("li",[e("p",[t._v("另外，时间服务器的时间也需要从网络上其他的时间服务器进行同步，这里直接用默认的即可，具体的配置如下"),e("br"),t._v("\n【其实我没做啥修改，就把allow取消注释，然后加上服务端的ip即可】"),e("br"),t._v("\n我给没注释的代码都加上说明了，可以看看哦。")])])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("[root@ccx_server128 ~]# cat /etc/chrony.conf \n# Use public servers from the pool.ntp.org project.\n# Please consider joining the pool (http://www.pool.ntp.org/join.html).\n#server 0.centos.pool.ntp.org iburst\n#server 1.centos.pool.ntp.org iburst\n#server 0.centos.pool.ntp.org iburst\n#server 1.centos.pool.ntp.org iburst\n#表示与本机IP同步时间，其他server注释或删除\n#注：内网环境必须这么做，否则其他会无法同步成功。 如果通公网，可以使用公网的服务器时间\nserver 127.127.1.0\n\n# Record the rate at which the system clock gains/losses time.\n# 为了在下次启动时稳定的同步，系统时钟的预估漂移需要保存到指定的文件中\ndriftfile /var/lib/chrony/drift\n\n# Allow the system clock to be stepped in the first three updates\n# if its offset is larger than 1 second.\n# 如果系统时钟由于某种原因与启动后的服务器时间相差甚远，允许 chronyd \n# 通过步进而不是回转来快速纠正它，这个过程将花费很长时间\nmakestep 1.0 3\n\n# Enable kernel synchronization of the real-time clock (RTC).\n# 为了使客户端实时时钟接近服务器的时钟，以便下次时钟启动时更接近真实的时间\n# 增加了一种 rtcsync 模式，该模式下，系统时间会定期的拷贝到实时时钟里\nrtcsync\n\n# Enable hardware timestamping on all interfaces that support it.\n#hwtimestamp *\n\n# Increase the minimum number of selectable sources required to adjust\n# the system clock.\n#minsources 2\n\n# Allow NTP client access from local network.\n# 允许指定网络的主机同步时间，不指定就是拒绝所有，且默认不开启。\n# 如果要允许所有则：  allow 0.0.0.0/24\n#如下，允许一个网段，如果有多个网段，则添加多个allow\nallow 192.168.59.0/24\n#allow ...\n\n# Serve time even if not synchronized to a time source.\n# 不去同步任何人的时间，时间同步服务级别\n# 开启后，即使server指令中时间服务器不可用，也允许将本地时间作为标准时间授予其他客户端\n#注：内网环境必须开，否则其他虚拟机无法同步时间\nlocal stratum 10\n\n# Specify file containing keys for NTP authentication.\n#keyfile /etc/chrony.keys\n\n# Specify directory for log files.\n# chrony日志存放路径\nlogdir /var/log/chrony\n\n# Select which information is logged.\n#log measurements statistics tracking\n[root@ccx_server128 ~]# \n")])])]),e("h4",{attrs:{id:"pool说明"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#pool说明"}},[t._v("#")]),t._v(" pool说明")]),t._v(" "),e("ul",[e("li",[t._v("pool=server。 一般我们都直接用server，只是我这说明一下pool的意思罢了。")]),t._v(" "),e("li",[t._v("pool 配置项\n"),e("ul",[e("li",[t._v("客户端需要去时间服务器获取时间，配置文件中 server 和 pool 配置项表示时间服务器的地址，支持域名或者IP")]),t._v(" "),e("li",[t._v("pool指的是进行时间同步的服务器IP地址或域名，作为服务器来说，其机器时间也需要从其他时间服务器同步，此时，服务器是作为一个客户端从网络服务器上获取时间")]),t._v(" "),e("li",[t._v("建议配置多个时间服务器的地址，优先选择同步良好，网络稳定且靠近客户端的地址")])])])]),t._v(" "),e("h4",{attrs:{id:"防火墙设置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#防火墙设置"}},[t._v("#")]),t._v(" 防火墙设置")]),t._v(" "),e("ul",[e("li",[t._v("注：chronyd和ntp一样端口是upd的而非tcp，都是依赖123端口通信的，323是chronyd之间通信用的，如果你放开了123端口别人连接不上，关闭防火墙又能连上了，那把323端口开放【理论不用开放这个的】")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("[root@ccx_server128 ~]#  netstat -nulp | grep chro\nudp        0      0 0.0.0.0:123             0.0.0.0:*                           11048/chronyd        \nudp        0      0 127.0.0.1:323           0.0.0.0:*                           11048/chronyd        \nudp6       0      0 ::1:323                 :::*                                11048/chronyd        \n[root@ccx_server128 ~]#  \n\n")])])]),e("ul",[e("li",[t._v("可以先查看防火墙状态，如果是关闭的，那么下面操作不用做了，我的是测试机，是可以直接关闭防火墙的【如果客户端已配置，则关闭服务端防火墙后，客户端重启 "),e("code",[t._v("systemctl restart chronyd")]),t._v("】"),e("br"),t._v("\n以firewalld为例")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("[root@ccx_server128 ~]# ip a | grep 128\n    inet6 ::1/128 scope host \n    inet 192.168.59.128/24 brd 192.168.59.255 scope global noprefixroute ens33\n[root@ccx_server128 ~]# systemctl is-active firewalld.service \nactive\n[root@ccx_server128 ~]# systemctl stop firewalld.service\n[root@ccx_server128 ~]# \n[root@ccx_server128 ~]# systemctl is-active firewalld.service \ninactive\n[root@ccx_server128 ~]# \n\n")])])]),e("ul",[e("li",[t._v("时间服务器如果有开启防火墙的话，需要开启 UDP 协议 的 123 端口，以允许客户端向服务器发送获取时间的请求"),e("br"),t._v("\n以firewalld为例")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("[root@ccx_server128 ~]# firewall-cmd --permanent --add-port=123/udp\nsuccess\n[root@ccx_server128 ~]# firewall-cmd --reload\nsuccess\n\n")])])]),e("ul",[e("li",[t._v("如果想要关闭防火墙的 123 端口，在服务器机器上执行下面的命令"),e("br"),t._v("\n以firewalld为例")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("[root@ccx_server128 ~]# firewall-cmd --permanent --remove-port=123/udp\nsuccess\n[root@ccx_server128 ~]# firewall-cmd --reload\nsuccess\n\n")])])]),e("ul",[e("li",[t._v("关于防火墙，我重新用一个新的ip搭建了个chronyd服务【和128一样的搭建方法】，将防火墙打开，测试客户端是否能正常同步，发现也能正常同步，防火墙不拦截嘛？【该测试仅用于参考】"),e("br"),t._v(" "),e("img",{attrs:{src:s(1109),alt:"在这里插入图片描述"}})])]),t._v(" "),e("h4",{attrs:{id:"重启chrony"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#重启chrony"}},[t._v("#")]),t._v(" 重启chrony")]),t._v(" "),e("ul",[e("li",[t._v("为使配置生效，需要重启 chronyd 服务")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("[root@ccx_server128 ~]# systemctl restart chronyd\n[root@ccx_server128 ~]# systemctl is-active chronyd\nactive\n[root@ccx_server128 ~]# \n\n")])])]),e("ul",[e("li",[t._v("查看端口监听是否正常")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("[root@ccx_server128 ~]#  netstat -nulp | grep chro\nudp        0      0 0.0.0.0:123             0.0.0.0:*                           11048/chronyd        \nudp        0      0 127.0.0.1:323           0.0.0.0:*                           11048/chronyd        \nudp6       0      0 ::1:323                 :::*                                11048/chronyd        \n[root@ccx_server128 ~]#  \n\n")])])]),e("h4",{attrs:{id:"服务端同步ntp服务器时间-时间模式调整"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#服务端同步ntp服务器时间-时间模式调整"}},[t._v("#")]),t._v(" 服务端同步ntp服务器时间&时间模式调整")]),t._v(" "),e("ul",[e("li",[t._v("内网主机是以本机时间为准，所以没有同步网络时间的概念，但是可以通过最后面timedatectl命令调整本机时间，其他客户端会自动更新为本机时间的。")])]),t._v(" "),e("h4",{attrs:{id:"查询ntp是否同步-查看同步的客户端信息"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#查询ntp是否同步-查看同步的客户端信息"}},[t._v("#")]),t._v(" 查询ntp是否同步&查看同步的客户端信息")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("查看时间同步源状态： "),e("code",[t._v("chronyc sourcestats -v")])]),t._v(" "),e("ul",[e("li",[t._v("因为我是本地源，所以是同步不成功的，这是正常的，这种情况就需要后面手动维护本机时间，确保客户端的时间能准确，也就是说，客户端的时间准不准确，就看自己平常咋维护服务端的时间了。"),e("br"),t._v(" "),e("img",{attrs:{src:s(1110),alt:"在这里插入图片描述"}})]),t._v(" "),e("li",[t._v("但是外网的不是这样，使用了ntp服务器时间，那么这就得有一条是同步成功的【具体看下面外网搭建】")])])]),t._v(" "),e("li",[e("p",[t._v("服务端命令："),e("code",[t._v("chronyc clients")]),t._v("【查看哪些ip连接我的ntp时间了】"),e("br"),t._v("\n注：我下面显示的是主机名而不是ip，是因为我添加解析了！！！如果没添加解析，显示的是ip。")])])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("# 注：要有客户端连了才有该信息，没人连是为空。\n[root@ccx_server128 ~]# chronyc clients\nHostname                      NTP   Drop Int IntL Last     Cmd   Drop Int  Last\n===============================================================================\nccx_server129                  16      0   6   -    15       0      0   -     -\n[root@ccx_server128 ~]# \n[root@ccx_server128 ~]# cat /etc/hosts\n127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4\n::1         localhost localhost.localdomain localhost6 localhost6.localdomain6\n192.168.59.129 ccx_server129\n[root@ccx_server128 ~]# \n\n")])])]),e("h3",{attrs:{id:"内网客户端配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#内网客户端配置"}},[t._v("#")]),t._v(" 内网客户端配置")]),t._v(" "),e("h4",{attrs:{id:"时区确定-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#时区确定-2"}},[t._v("#")]),t._v(" 时区确定")]),t._v(" "),e("ul",[e("li",[t._v("配置前先执行timedatectl 如果是UTC时间，如下"),e("code",[t._v("UTC，+0")]),t._v("，则需要修改时区")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("[root@test21 ~]# timedatectl \n      Local time: Wed 2022-07-06 06:50:32 UTC\n  Universal time: Wed 2022-07-06 06:50:32 UTC\n        RTC time: Wed 2022-07-06 06:50:32\n       Time zone: UTC (UTC, +0000)\n     NTP enabled: yes\nNTP synchronized: no\n RTC in local TZ: no\n      DST active: n/a\n[root@test21 ~]# \n\n")])])]),e("ul",[e("li",[t._v("修改方式为： "),e("code",[t._v("timedatectl set-timezone Asia/Shanghai")]),t._v("，修改后正确信息如下")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("[root@test21 ~]# timedatectl set-timezone Asia/Shanghai\n[root@test21 ~]# timedatectl \n      Local time: Wed 2022-07-06 14:54:56 CST\n  Universal time: Wed 2022-07-06 06:54:56 UTC\n        RTC time: Wed 2022-07-06 06:54:56\n       Time zone: Asia/Shanghai (CST, +0800)\n     NTP enabled: yes\nNTP synchronized: no\n RTC in local TZ: no\n      DST active: n/a\n[root@test21 ~]# \n\n")])])]),e("h4",{attrs:{id:"安装chrony-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装chrony-2"}},[t._v("#")]),t._v(" 安装chrony")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("[root@ccx_server129 ~]# yum install -y chrony\n[root@ccx_server129 ~]# \n[root@ccx_server129 ~]# systemctl enable chronyd --now\n[root@ccx_server129 ~]# systemctl is-active chronyd\nactive\n[root@ccx_server129 ~]# \n\n")])])]),e("h4",{attrs:{id:"客户端配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#客户端配置"}},[t._v("#")]),t._v(" 客户端配置")]),t._v(" "),e("ul",[e("li",[t._v("安装好 chrony 之后，编辑 "),e("code",[t._v("/etc/chrony.conf")]),t._v(" 配置文件，客户端的配置比较简单"),e("br"),t._v("\n我给没注释的代码都加上说明了，可以看看哦。")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("[root@ccx_server129 ~]# cat /etc/chrony.conf\n# Use public servers from the pool.ntp.org project.\n# Please consider joining the pool (http://www.pool.ntp.org/join.html).\n# 同步时间的服务器 IP 或 域名\n# 这直接使用服务端的ip即可\nserver 192.168.59.128 iburst\n#server 1.centos.pool.ntp.org iburst\n#server 2.centos.pool.ntp.org iburst\n#server 3.centos.pool.ntp.org iburst\n\n# Record the rate at which the system clock gains/losses time.\n# 系统时钟的预估漂移保存到指定的文件中，是为了在下次启动时能稳定的同步\ndriftfile /var/lib/chrony/drift\n\n# Allow the system clock to be stepped in the first three updates\n# if its offset is larger than 1 second.\n# 如果系统时钟由于某种原因与启动后的服务器时间相差甚远，允许 chronyd \n# 通过步进而不是回转来快速纠正它\nmakestep 1.0 3\n\n# Enable kernel synchronization of the real-time clock (RTC).\n# 为了使客户端实时时钟接近服务器的时钟，以便下次时钟启动时更接近真实的时间\n# 增加了一种 rtcsync 模式，该模式下，系统时间会定期的拷贝到实时时钟里\nrtcsync\n\n# Enable hardware timestamping on all interfaces that support it.\n#hwtimestamp *\n\n# Increase the minimum number of selectable sources required to adjust\n# the system clock.\n#minsources 2\n\n# Allow NTP client access from local network.\n#allow 192.168.0.0/16\n\n# Serve time even if not synchronized to a time source.\n#local stratum 10\n\n# Specify file containing keys for NTP authentication.\n#keyfile /etc/chrony.keys\n\n# Specify directory for log files.\n# chrony日志存放路径\nlogdir /var/log/chrony\n\n# Select which information is logged.\n#log measurements statistics tracking\n[root@ccx_server129 ~]# \n\n")])])]),e("h4",{attrs:{id:"重启chrony-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#重启chrony-2"}},[t._v("#")]),t._v(" "),e("a",{attrs:{href:"https://blog.csdn.net/cuichongxin/article/details/123178318",target:"_blank",rel:"noopener noreferrer"}},[e("OutboundLink")],1),t._v("重启chrony")]),t._v(" "),e("ul",[e("li",[t._v("为使配置生效，需要重启 chronyd 服务")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("[root@ccx_server129 ~]# systemctl restart chronyd\n[root@ccx_server129 ~]# systemctl is-active chronyd\nactive\n[root@ccx_server129 ~]# \n\n")])])]),e("h4",{attrs:{id:"查看服务器信息"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#查看服务器信息"}},[t._v("#")]),t._v(" 查看服务器信息")]),t._v(" "),e("ul",[e("li",[t._v("客户端查看连接情况命令："),e("code",[t._v("chronyc sources -v")]),t._v("【加-v显示详细信息，可以不加】"),e("br"),t._v("\n如下，我没同步前时间为"),e("code",[t._v("15:28")]),t._v("，同步以后时间变成"),e("code",[t._v("23:22")]),t._v("了【和服务端一样】【如果没有自动同步可以执行"),e("code",[t._v("chronyc tracking")]),t._v("立即同步】"),e("br"),t._v("\n显示的是主机名而非ip是因为我添加解析了。。。没添加解析是显示的ip\n"),e("ul",[e("li",[e("code",[t._v("^?")]),t._v("同步失败")]),t._v(" "),e("li",[e("code",[t._v("^*")]),t._v(" 同步成功【可能不是立即显示，反正只要Reach有值就表示成功了，状态需要等一会才能更新】")])])])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("[root@ccx_server129 ~]# \n[root@ccx_server129 ~]# date\nMon Feb 28 15:28:05 CST 2022\n[root@ccx_server129 ~]# systemctl restart chronyd\n[root@ccx_server129 ~]# chronyc sources\n210 Number of sources = 1\nMS Name/IP address         Stratum Poll Reach LastRx Last sample               \n===============================================================================\n^? ccx_server128                10   6     3     0  +2317ns[+2317ns] +/-   90us\n[root@ccx_server129 ~]# chronyc sources\n210 Number of sources = 1\nMS Name/IP address         Stratum Poll Reach LastRx Last sample               \n===============================================================================\n^? ccx_server128                10   6     3     1  +2317ns[+2317ns] +/-   90us\n[root@ccx_server129 ~]# chronyc sources\n210 Number of sources = 1\nMS Name/IP address         Stratum Poll Reach LastRx Last sample               \n===============================================================================\n^? ccx_server128                10   6     3     1  +2317ns[+2317ns] +/-   90us\n[root@ccx_server129 ~]# chronyc sources\n210 Number of sources = 1\nMS Name/IP address         Stratum Poll Reach LastRx Last sample               \n===============================================================================\n^* ccx_server128                10   6    17     0  -1762ns[-2940ns] +/-   92us\n[root@ccx_server129 ~]# chronyc sources\n210 Number of sources = 1\nMS Name/IP address         Stratum Poll Reach LastRx Last sample               \n===============================================================================\n^* ccx_server128                10   6    17     2  -1762ns[-2940ns] +/-   92us\n[root@ccx_server129 ~]# date\nMon Feb 28 23:22:20 CST 2022\n[root@ccx_server129 ~]# \n[root@ccx_server129 ~]# \n[root@ccx_server129 ~]# cat /etc/hosts\n127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4\n::1         localhost localhost.localdomain localhost6 localhost6.localdomain6\n192.168.59.128 ccx_server128\n[root@ccx_server129 ~]# \n[root@ccx_server129 ~]# chronyc sources -v\n210 Number of sources = 1\n\n  .-- Source mode  '^' = server, '=' = peer, '#' = local clock.\n / .- Source state '*' = current synced, '+' = combined , '-' = not combined,\n| /   '?' = unreachable, 'x' = time may be in error, '~' = time too variable.\n||                                                 .- xxxx [ yyyy ] +/- zzzz\n||      Reachability register (octal) -.           |  xxxx = adjusted offset,\n||      Log2(Polling interval) --.      |          |  yyyy = measured offset,\n||                                \\     |          |  zzzz = estimated error.\n||                                 |    |           \\\nMS Name/IP address         Stratum Poll Reach LastRx Last sample               \n===============================================================================\n^* ccx_server128                10   9   377   386    -15us[  -19us] +/-  133us\n[root@ccx_server129 ~]# \n\n")])])]),e("ul",[e("li",[t._v("而且，当时间同步成功以后，ntp服务这些全是yes"),e("br"),t._v("\n下面NTP synchronized状态如果为no，手动改为yes是不生效的。。成功以后状态会自动变成yes。"),e("br"),t._v("\n开启ntp命令是："),e("code",[t._v("timedatectl set-ntp true/flase")])])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("[root@ccx_server129 ~]# timedatectl \n      Local time: Mon 2022-02-28 23:38:32 CST\n  Universal time: Mon 2022-02-28 15:38:32 UTC\n        RTC time: Mon 2022-02-28 15:38:32\n       Time zone: Asia/Shanghai (CST, +0800)\n     NTP enabled: yes\nNTP synchronized: yes\n RTC in local TZ: yes\n      DST active: n/a\n# 这个警告是因为我吧时间改为本地了，下面有说改回RTC的方法哈。\nWarning: The system is configured to read the RTC time in the local time zone.\n         This mode can not be fully supported. It will create various problems\n         with time zone changes and daylight saving time adjustments. The RTC\n         time is never updated, it relies on external facilities to maintain it.\n         If at all possible, use RTC in UTC by calling\n         'timedatectl set-local-rtc 0'.\n[root@ccx_server129 ~]# \n\n")])])]),e("h4",{attrs:{id:"没加解析的服务器端说明"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#没加解析的服务器端说明"}},[t._v("#")]),t._v(" 没加解析的服务器端说明")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("上面是因为我排错的过程中添加解析了，所以无论是客户端还是服务端看到的ip都是主机名。。。"),e("br"),t._v("\n我下面呢重新用一台没加解析的虚拟机做服务端，重新试一下效果哦。")])]),t._v(" "),e("li",[e("p",[t._v("我这不对代码做解释了哦，具体的代码说明看上面哈~")])]),t._v(" "),e("li",[e("p",[t._v("服务端配置")])])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("[root@ciserver ~]# ip a | grep 151\n    inet 192.168.59.151/24 brd 192.168.59.255 scope global noprefixroute ens33\n[root@ciserver ~]# cat /etc/chrony.conf \n# Use public servers from the pool.ntp.org project.\n# Please consider joining the pool (http://www.pool.ntp.org/join.html).\n#server 0.centos.pool.ntp.org iburst\n#server 1.centos.pool.ntp.org iburst\n#server 2.centos.pool.ntp.org iburst\n#server 3.centos.pool.ntp.org iburst\n#server 192.168.59.128\nserver 127.127.1.0\n\n# Record the rate at which the system clock gains/losses time.\ndriftfile /var/lib/chrony/drift\n\n# Allow the system clock to be stepped in the first three updates\n# if its offset is larger than 1 second.\nmakestep 1.0 3\n\n# Enable kernel synchronization of the real-time clock (RTC).\nrtcsync\n\n# Enable hardware timestamping on all interfaces that support it.\n#hwtimestamp *\n\n# Increase the minimum number of selectable sources required to adjust\n# the system clock.\n#minsources 2\n\n# Allow NTP client access from local network.\n#allow 192.168.0.0/16\nallow 192.168.59.0/24\n\n# Serve time even if not synchronized to a time source.\nlocal stratum 10\n\n# Specify file containing keys for NTP authentication.\n#keyfile /etc/chrony.keys\n\n# Specify directory for log files.\nlogdir /var/log/chrony\n\n# Select which information is logged.\n#log measurements statistics tracking\n[root@ciserver ~]# \n[root@ciserver ~]# systemctl restart chronyd\n[root@ciserver ~]# \n[root@ciserver ~]# chronyc clients\nHostname                      NTP   Drop Int IntL Last     Cmd   Drop Int  Last\n===============================================================================\n[root@ciserver ~]# \n[root@ciserver ~]# date\nMon Feb 28 17:54:19 CST 2022\n[root@ciserver ~]# \n\n# 下面客户端配置完毕以后再回到服务端，可以看到客户端的ip了哦\n[root@ciserver ~]# chronyc clients\nHostname                      NTP   Drop Int IntL Last     Cmd   Drop Int  Last\n===============================================================================\n192.168.59.129                  5      0   4   -    34       0      0   -     -\n[root@ciserver ~]# \n\n")])])]),e("ul",[e("li",[t._v("客户端"),e("br"),t._v("\n我还是用上面的那个客户端来做测试吧")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("[root@ccx_server129 ~]# cat /etc/chrony.conf\n# Use public servers from the pool.ntp.org project.\n# Please consider joining the pool (http://www.pool.ntp.org/join.html).\nserver 192.168.59.151 iburst\n#server 192.168.59.128 iburst\n#server 1.centos.pool.ntp.org iburst\n#server 2.centos.pool.ntp.org iburst\n#server 3.centos.pool.ntp.org iburst\n\n# Record the rate at which the system clock gains/losses time.\ndriftfile /var/lib/chrony/drift\n\n# Allow the system clock to be stepped in the first three updates\n# if its offset is larger than 1 second.\nmakestep 1.0 3\n\n# Enable kernel synchronization of the real-time clock (RTC).\nrtcsync\n\n# Enable hardware timestamping on all interfaces that support it.\n#hwtimestamp *\n\n# Increase the minimum number of selectable sources required to adjust\n# the system clock.\n#minsources 2\n\n# Allow NTP client access from local network.\n#allow 192.168.0.0/16\n#allow 192.168.59.128\n#local stratum 10\n# Serve time even if not synchronized to a time source.\n#local stratum 10\n\n# Specify file containing keys for NTP authentication.\n#keyfile /etc/chrony.keys\n\n# Specify directory for log files.\nlogdir /var/log/chrony\n\n# Select which information is logged.\n#log measurements statistics tracking\n[root@ccx_server129 ~]# \n[root@ccx_server129 ~]# date #之前服务端的时间\nMon Feb 28 17:48:46 CST 2022\n[root@ccx_server129 ~]# \n[root@ccx_server129 ~]# systemctl restart chronyd #重启\n[root@ccx_server129 ~]# \n[root@ccx_server129 ~]# chronyc sources #生效了哦，同步成功了\n210 Number of sources = 1\nMS Name/IP address         Stratum Poll Reach LastRx Last sample               \n===============================================================================\n^* 192.168.59.151               10   6    17     3  -1053ns[-1698ns] +/-  150us\n[root@ccx_server129 ~]#  #时间也变了\n[root@ccx_server129 ~]# date\nMon Feb 28 17:54:56 CST 2022\n[root@ccx_server129 ~]# \n\n")])])]),e("h2",{attrs:{id:"外网chrony配置时间同步"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#外网chrony配置时间同步"}},[t._v("#")]),t._v(" 外网chrony配置时间同步")]),t._v(" "),e("h3",{attrs:{id:"外网环境chrony服务端配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#外网环境chrony服务端配置"}},[t._v("#")]),t._v(" 外网环境chrony服务端配置")]),t._v(" "),e("h4",{attrs:{id:"时区确定-3"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#时区确定-3"}},[t._v("#")]),t._v(" 时区确定")]),t._v(" "),e("ul",[e("li",[t._v("配置前先执行timedatectl 如果是UTC时间，如下"),e("code",[t._v("UTC，+0")]),t._v("，则需要修改时区")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("[root@test21 ~]# timedatectl \n      Local time: Wed 2022-07-06 06:50:32 UTC\n  Universal time: Wed 2022-07-06 06:50:32 UTC\n        RTC time: Wed 2022-07-06 06:50:32\n       Time zone: UTC (UTC, +0000)\n     NTP enabled: yes\nNTP synchronized: no\n RTC in local TZ: no\n      DST active: n/a\n[root@test21 ~]# \n\n")])])]),e("ul",[e("li",[t._v("修改方式为： "),e("code",[t._v("timedatectl set-timezone Asia/Shanghai")]),t._v("，修改后正确信息如下")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("[root@test21 ~]# timedatectl set-timezone Asia/Shanghai\n[root@test21 ~]# timedatectl \n      Local time: Wed 2022-07-06 14:54:56 CST\n  Universal time: Wed 2022-07-06 06:54:56 UTC\n        RTC time: Wed 2022-07-06 06:54:56\n       Time zone: Asia/Shanghai (CST, +0800)\n     NTP enabled: yes\nNTP synchronized: no\n RTC in local TZ: no\n      DST active: n/a\n[root@test21 ~]# \n\n")])])]),e("h4",{attrs:{id:"安装chrony-3"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装chrony-3"}},[t._v("#")]),t._v(" 安装chrony")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("[root@ccx_server128 ~]# yum install -y chrony\n[root@ccx_server128 ~]# \n[root@ccx_server128 ~]# systemctl enable chronyd --now\n[root@ccx_server128 ~]# systemctl is-active chronyd\nactive\n[root@ccx_server128 ~]# \n\n")])])]),e("h4",{attrs:{id:"服务端配置【国内常用的几个ntp服务器地址】"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#服务端配置【国内常用的几个ntp服务器地址】"}},[t._v("#")]),t._v(" 服务端配置【国内常用的几个ntp服务器地址】")]),t._v(" "),e("ul",[e("li",[t._v("国内NTP时间服务器："),e("br"),t._v("\n验证是否能用： 在配置主机上ping下面域名，能ping通就可以用。")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("#最常见、熟知的就是，www.pool.ntp.org/zone/cn\nntp.ntsc.ac.cn #国家授时中心 网络授时服务器的域名\ncn.ntp.org.cn #中国\nedu.ntp.org.cn #中国教育网\nntp1.aliyun.com #阿里云\nntp2.aliyun.com #阿里云\ncn.pool.ntp.org #最常用的国内NTP服务器\n\n")])])]),e("ul",[e("li",[t._v("外网配置很简单，也没啥讲究，配置文件"),e("code",[t._v("/etc/chrony.conf")]),t._v(" 修改一个内容就行了，修改内容如下："),e("br"),t._v("\n注：代码意思见上面内网环境中的服务端配置说明哈。")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("# 先在主机上ping一下，确定能ping通下面ntp服务器地址才行哈\n[root@yum-centos-dmz ~]# ping .cn.pool.ntp.org\nping: .cn.pool.ntp.org: Name or service not known\n[root@yum-centos-dmz ~]# ping cn.pool.ntp.org\nPING cn.pool.ntp.org (219.216.128.25) 56(84) bytes of data.\n64 bytes from 219.216.128.25 (219.216.128.25): icmp_seq=1 ttl=44 time=80.5 ms\n64 bytes from 219.216.128.25 (219.216.128.25): icmp_seq=2 ttl=44 time=80.2 ms\n^C\n--- cn.pool.ntp.org ping statistics ---\n2 packets transmitted, 2 received, 0% packet loss, time 1001ms\nrtt min/avg/max/mdev = 80.285/80.408/80.531/0.123 ms\n[root@yum-centos-dmz ~]# \n\n#把配置文件下面四行注释掉：\nserver 0.centos.pool.ntp.org iburst\nserver 1.centos.pool.ntp.org iburst\nserver 2.centos.pool.ntp.org iburst\nserver 3.centos.pool.ntp.org iburst\n#然后在下面添加这几行，也可以添加上面的ntp服务器地址\nserver 0.cn.pool.ntp.org iburst\nserver 1.cn.pool.ntp.org iburst\nserver 2.cn.pool.ntp.org iburst\nserver 3.cn.pool.ntp.org iburst\n\n# 添加下面内容，允许所有虚拟机连接\nallow 0.0.0.0/24\n\n# 取消注释下面行。外网环境下面如果不取消注释，可能chronyd服务无法同步，只有ntp可以同步，开了好。\nlocal stratum 10\n\n# 完整代码配置文件如下\n[root@yum-centos-dmz yum.repos.d]# cat /etc/chrony.conf \n# Use public servers from the pool.ntp.org project.\n# Please consider joining the pool (http://www.pool.ntp.org/join.html).\n#server 0.centos.pool.ntp.org iburst\n#server 1.centos.pool.ntp.org iburst\n#server 2.centos.pool.ntp.org iburst\n#server 3.centos.pool.ntp.org iburst\n#一定要先ping，要确保地址能ping通才可以正常同步啊！！！！\nserver cn.ntp.org.cn iburst\nserver cn.pool.ntp.org iburst\n#server 0.cn.pool.ntp.org iburst\n#server 1.cn.pool.ntp.org iburst\n#server 2.cn.pool.ntp.org iburst\n#server 3.cn.pool.ntp.org iburst\n\n# Record the rate at which the system clock gains/losses time.\ndriftfile /var/lib/chrony/drift\n\n# Allow the system clock to be stepped in the first three updates\n# if its offset is larger than 1 second.\nmakestep 1.0 3\n\n# Enable kernel synchronization of the real-time clock (RTC).\nrtcsync\n\n# Enable hardware timestamping on all interfaces that support it.\n#hwtimestamp *\n\n# Increase the minimum number of selectable sources required to adjust\n# the system clock.\n#minsources 2\n\n# Allow NTP client access from local network.\n#allow 192.168.0.0/16\nallow 1.2.105.0/24\nallow 1.2.0.0/16\n\n# Serve time even if not synchronized to a time source.\nlocal stratum 10\n\n# Specify file containing keys for NTP authentication.\n#keyfile /etc/chrony.keys\n\n# Specify directory for log files.\nlogdir /var/log/chrony\n\n# Select which information is logged.\n#log measurements statistics tracking\n[root@yum-centos-dmz yum.repos.d]#\n\n")])])]),e("h4",{attrs:{id:"防火墙设置-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#防火墙设置-2"}},[t._v("#")]),t._v(" 防火墙设置")]),t._v(" "),e("ul",[e("li",[t._v("引用上面内网中内容，方法一样。")]),t._v(" "),e("li",[t._v("注：chronyd和ntp一样端口是upd的而非tcp，都是依赖123端口通信的，323是chronyd之间通信用的，如果你放开了123端口别人连接不上，关闭防火墙又能连上了，那把323端口开放【理论不用开放这个的】")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("[root@ccx_server128 ~]#  netstat -nulp | grep chro\nudp        0      0 0.0.0.0:123             0.0.0.0:*                           11048/chronyd        \nudp        0      0 127.0.0.1:323           0.0.0.0:*                           11048/chronyd        \nudp6       0      0 ::1:323                 :::*                                11048/chronyd        \n[root@ccx_server128 ~]#  \n\n")])])]),e("ul",[e("li",[t._v("可以先查看防火墙状态，如果是关闭的，那么下面操作不用做了，我的是测试机，是可以直接关闭防火墙的【如果客户端已配置，则关闭服务端防火墙后，客户端重启 "),e("code",[t._v("systemctl restart chronyd")]),t._v("】"),e("br"),t._v("\n以firewalld为例")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("[root@ccx_server128 ~]# ip a | grep 128\n    inet6 ::1/128 scope host \n    inet 192.168.59.128/24 brd 192.168.59.255 scope global noprefixroute ens33\n[root@ccx_server128 ~]# systemctl is-active firewalld.service \nactive\n[root@ccx_server128 ~]# systemctl stop firewalld.service\n[root@ccx_server128 ~]# \n[root@ccx_server128 ~]# systemctl is-active firewalld.service \ninactive\n[root@ccx_server128 ~]# \n\n")])])]),e("ul",[e("li",[t._v("时间服务器如果有开启防火墙的话，需要开启 UDP 协议 的 123 端口，以允许客户端向服务器发送获取时间的请求"),e("br"),t._v("\n以firewalld为例")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("[root@ccx_server128 ~]# firewall-cmd --permanent --add-port=123/udp\nsuccess\n[root@ccx_server128 ~]# firewall-cmd --reload\nsuccess\n\n")])])]),e("ul",[e("li",[t._v("如果想要关闭防火墙的 123 端口，在服务器机器上执行下面的命令"),e("br"),t._v("\n以firewalld为例")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("[root@ccx_server128 ~]# firewall-cmd --permanent --remove-port=123/udp\nsuccess\n[root@ccx_server128 ~]# firewall-cmd --reload\nsuccess\n\n")])])]),e("h4",{attrs:{id:"重启chrony-3"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#重启chrony-3"}},[t._v("#")]),t._v(" 重启chrony")]),t._v(" "),e("ul",[e("li",[t._v("为使配置生效，需要重启 chronyd 服务")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("[root@yum-centos-dmz ~]# systemctl restart chronyd\n[root@yum-centos-dmz ~]# systemctl is-active chronyd\nactive\n[root@yum-centos-dmz ~]# \n\n")])])]),e("ul",[e("li",[t._v("查看端口监听是否正常")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("[root@yum-centos-dmz ~]# netstat -nulp | grep chro\nudp        0      0 0.0.0.0:123             0.0.0.0:*                           14248/chronyd       \nudp        0      0 127.0.0.1:323           0.0.0.0:*                           14248/chronyd       \nudp6       0      0 ::1:323                 :::*                                14248/chronyd       \n[root@yum-centos-dmz ~]# \n\n")])])]),e("h4",{attrs:{id:"服务端同步ntp服务器时间-时间模式调整-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#服务端同步ntp服务器时间-时间模式调整-2"}},[t._v("#")]),t._v(" 服务端同步ntp服务器时间&时间模式调整")]),t._v(" "),e("ul",[e("li",[t._v("理论上重启服务以后会自动同步时间的，如果没有自动同步，可以执行下面命令立即同步。"),e("br"),t._v("\n只要出现"),e("code",[t._v("^*")]),t._v("行就代表成功。【如果没有自动同步可以执行"),e("code",[t._v("chronyc tracking")]),t._v("立即同步】")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("[root@yum-centos-dmz ~]# chronyc sources -v\n210 Number of sources = 4\n\n  .-- Source mode  '^' = server, '=' = peer, '#' = local clock.\n / .- Source state '*' = current synced, '+' = combined , '-' = not combined,\n| /   '?' = unreachable, 'x' = time may be in error, '~' = time too variable.\n||                                                 .- xxxx [ yyyy ] +/- zzzz\n||      Reachability register (octal) -.           |  xxxx = adjusted offset,\n||      Log2(Polling interval) --.      |          |  yyyy = measured offset,\n||                                \\     |          |  zzzz = estimated error.\n||                                 |    |           \\\nMS Name/IP address         Stratum Poll Reach LastRx Last sample               \n===============================================================================\n^- electrode.felixc.at           3   6   377    31    -14us[  -14us] +/-  181ms\n^* 120.25.115.20                 2   6   146   164  -2455us[+2334us] +/-   35ms\n^- tick.ntp.infomaniak.ch        1   6   377    29  -3515us[-3515us] +/-  102ms\n^- makaki.miuku.net              2   6   377    30    -72ms[  -72ms] +/-  138ms\n[root@yum-centos-dmz ~]# chronyc sources \n210 Number of sources = 4\nMS Name/IP address         Stratum Poll Reach LastRx Last sample               \n===============================================================================\n^- electrode.felixc.at           3   6   377     8    +30ms[  +30ms] +/-  153ms\n^* 120.25.115.20                 2   6   231    11  -3186us[-5099us] +/-   38ms\n^- tick.ntp.infomaniak.ch        1   6   377     7    -47ms[  -47ms] +/-  151ms\n^- makaki.miuku.net              2   6   377     7    -21ms[  -21ms] +/-   91ms\n[root@yum-centos-dmz ~]# \n[root@yum-centos-dmz ~]# date\nTue Jul  5 02:53:16 UTC 2022\n[root@yum-centos-dmz ~]#\n\n")])])]),e("ul",[e("li",[t._v("理论上重启服务时间就自动同步的，但我看到虚拟机上的时间一直是2点过，而我本地的时间是10点过，不对啊，但同步又是成功的，后面我发现分和秒都和我本地对上的，想起了虚拟机是UTC模式啊，也就是没有+8.。。问题就在这。"),e("br"),t._v("\n所以我们就将UTC模式调整一下嘛【文章最后有说timedatectl命令的使用方式哈】")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("[root@yum-centos-dmz ~]# date\nTue Jul  5 03:09:28 UTC 2022\n\n# 下面命令可以看到UTC是+0\n[root@yum-centos-dmz ~]# timedatectl \n      Local time: Tue 2022-07-05 03:09:30 UTC\n  Universal time: Tue 2022-07-05 03:09:30 UTC\n        RTC time: Tue 2022-07-05 03:01:29\n       Time zone: UTC (UTC, +0000)\n     NTP enabled: yes\nNTP synchronized: yes\n RTC in local TZ: no\n      DST active: n/a\n[root@yum-centos-dmz ~]# \n[root@yum-centos-dmz ~]# timedatectl list-timezones | grep hai\nAsia/Shanghai\n[root@yum-centos-dmz ~]# timedatectl set-timezone Asia/Shanghai\n\n# 调整为上海以后就UTC就变成+8了，正常了。\n[root@yum-centos-dmz ~]# timedatectl \n      Local time: Tue 2022-07-05 11:10:33 CST\n  Universal time: Tue 2022-07-05 03:10:33 UTC\n        RTC time: Tue 2022-07-05 03:02:33\n       Time zone: Asia/Shanghai (CST, +0800)\n     NTP enabled: yes\nNTP synchronized: yes\n RTC in local TZ: no\n      DST active: n/a\n\n# 再次查看时间，正常了，搞定。\n[root@yum-centos-dmz ~]# date\nTue Jul  5 11:10:39 CST 2022\n[root@yum-centos-dmz ~]# \n\n")])])]),e("h4",{attrs:{id:"查看同步的客户端信息"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#查看同步的客户端信息"}},[t._v("#")]),t._v(" 查看同步的客户端信息")]),t._v(" "),e("ul",[e("li",[t._v("服务端命令："),e("code",[t._v("chronyc clients")]),t._v("【查看哪些ip连接我的ntp时间了】"),e("br"),t._v("\n注：我下面显示的是主机名而不是ip，是因为我添加解析了！！！如果没添加解析，显示的是ip。")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("# 注：要有客户端连了才有该信息，没人连是为空。\n[root@yum-centos-dmz ~]# chronyc clients\nHostname                      NTP   Drop Int IntL Last     Cmd   Drop Int  Last\n===============================================================================\nccx_server129                  16      0   6   -    15       0      0   -     -\n[root@yum-centos-dmz ~]#\n\n# 下面是别人连接以后【ip有修改】\n[root@yum-centos-dmz ~]# chronyc  clients\nHostname                      NTP   Drop Int IntL Last     Cmd   Drop Int  Last\n===============================================================================\n1.2.102.47                   5      0   6   -    51       0      0   -     -\n1.2.105.58                   3      0   6   -   141       0      0   -     -\n1.2.105.39                   8      0   6   -     1       0      0   -     -\n1.2.102.36                   4      0   6   -    15       0      0   -     -\n1.2.102.16                   3      0   6   -    10       0      0   -     -\n1.2.102.54                   2      0   6   -    48       0      0   -     -\n1.2.102.55                   2      0   6   -    29       0      0   -     -\n[root@yum-centos-dmz ~]# \n\n")])])]),e("h3",{attrs:{id:"外网客户端连接"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#外网客户端连接"}},[t._v("#")]),t._v(" 外网客户端连接")]),t._v(" "),e("h4",{attrs:{id:"时区确定-4"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#时区确定-4"}},[t._v("#")]),t._v(" 时区确定")]),t._v(" "),e("ul",[e("li",[t._v("配置前先执行timedatectl 如果是UTC时间，如下"),e("code",[t._v("UTC，+0")]),t._v("，则需要修改时区")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("[root@test21 ~]# timedatectl \n      Local time: Wed 2022-07-06 06:50:32 UTC\n  Universal time: Wed 2022-07-06 06:50:32 UTC\n        RTC time: Wed 2022-07-06 06:50:32\n       Time zone: UTC (UTC, +0000)\n     NTP enabled: yes\nNTP synchronized: no\n RTC in local TZ: no\n      DST active: n/a\n[root@test21 ~]# \n\n")])])]),e("ul",[e("li",[t._v("修改方式为： "),e("code",[t._v("timedatectl set-timezone Asia/Shanghai")]),t._v("，修改后正确信息如下")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("[root@test21 ~]# timedatectl set-timezone Asia/Shanghai\n[root@test21 ~]# timedatectl \n      Local time: Wed 2022-07-06 14:54:56 CST\n  Universal time: Wed 2022-07-06 06:54:56 UTC\n        RTC time: Wed 2022-07-06 06:54:56\n       Time zone: Asia/Shanghai (CST, +0800)\n     NTP enabled: yes\nNTP synchronized: no\n RTC in local TZ: no\n      DST active: n/a\n[root@test21 ~]# \n\n")])])]),e("h4",{attrs:{id:"chronyd的方法连接"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#chronyd的方法连接"}},[t._v("#")]),t._v(" chronyd的方法连接")]),t._v(" "),e("h5",{attrs:{id:"安装chrony-4"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装chrony-4"}},[t._v("#")]),t._v(" 安装chrony")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("[root@ccx_server129 ~]# yum install -y chrony\n[root@ccx_server129 ~]# \n[root@ccx_server129 ~]# systemctl enable chronyd --now\n[root@ccx_server129 ~]# systemctl is-active chronyd\nactive\n[root@ccx_server129 ~]# \n\n")])])]),e("h5",{attrs:{id:"客户端配置-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#客户端配置-2"}},[t._v("#")]),t._v(" 客户端配置")]),t._v(" "),e("ul",[e("li",[t._v("安装好 chrony 之后，编辑 "),e("code",[t._v("/etc/chrony.conf")]),t._v(" 配置文件，客户端的配置比较简单"),e("br"),t._v("\n我给没注释的代码都加上说明了，可以看看哦。")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("[root@test ~]#  cat /etc/chrony.conf\n# Use public servers from the pool.ntp.org project.\n# Please consider joining the pool (http://www.pool.ntp.org/join.html).\n# 同步时间的服务器 IP 或 域名\n# 这直接使用服务端的ip即可\nserver 1.2.105.41 iburst\n#server 1.centos.pool.ntp.org iburst\n#server 2.centos.pool.ntp.org iburst\n#server 3.centos.pool.ntp.org iburst\n\n# 其他配置默认不动即可。\n\n\n")])])]),e("h5",{attrs:{id:"重启chrony-4"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#重启chrony-4"}},[t._v("#")]),t._v(" 重启chrony")]),t._v(" "),e("ul",[e("li",[t._v("为使配置生效，需要重启 chronyd 服务")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("[root@test ~]#  systemctl restart chronyd\n[root@test ~]#  systemctl is-active chronyd\nactive\n[root@test ~]# \n\n")])])]),e("h5",{attrs:{id:"查看服务器信息-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#查看服务器信息-2"}},[t._v("#")]),t._v(" 查看服务器信息")]),t._v(" "),e("ul",[e("li",[t._v("客户端查看连接情况命令："),e("code",[t._v("chronyc sources -v")]),t._v("【加-v显示详细信息，可以不加】"),e("br"),t._v("\n如下，我没同步前时间为"),e("code",[t._v("15:28")]),t._v("，同步以后时间变成"),e("code",[t._v("23:22")]),t._v("了【和服务端一样】【如果没有自动同步可以执行"),e("code",[t._v("chronyc tracking")]),t._v("立即同步】"),e("br"),t._v("\n显示的是主机名而非ip是因为我添加解析了。。。没添加解析是显示的ip\n"),e("ul",[e("li",[e("code",[t._v("^?")]),t._v("同步失败")]),t._v(" "),e("li",[e("code",[t._v("^*")]),t._v(" 同步成功【可能不是立即显示，反正只要Reach有值就表示成功了，状态需要等一会才能更新】"),e("br"),t._v(" "),e("img",{attrs:{src:s(1111),alt:"在这里插入图片描述"}})])])])]),t._v(" "),e("h4",{attrs:{id:"ntp的方式连接chronyd服务端【必看】"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ntp的方式连接chronyd服务端【必看】"}},[t._v("#")]),t._v(" ntp的方式连接chronyd服务端【必看】")]),t._v(" "),e("h5",{attrs:{id:"ntp服务端搭建"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ntp服务端搭建"}},[t._v("#")]),t._v(" ntp服务端搭建")]),t._v(" "),e("ul",[e("li",[t._v("本文主要说的是chronyd服务，ntp是我测试的时候做过，也顺便说一下，ntp超级简单。"),e("br"),t._v("\n为什么用chronyd，是因为chronyd管理更方便，比如可以看到已经连接该主机的ip有哪些。")]),t._v(" "),e("li",[t._v("安装ntp，ntpdate已经系统默认安装过了")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("[root@localhost ~]# yum install -y ntp\n\n")])])]),e("ul",[e("li",[t._v("修改ntp配置文件")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("[root@localhost ~]# vim /etc/ntp.conf\n\n#把配置文件下面四行注释掉：\nserver 0.centos.pool.ntp.org iburst\nserver 1.centos.pool.ntp.org iburst\nserver 2.centos.pool.ntp.org iburst\nserver 3.centos.pool.ntp.org iburst\n\n#然后在下面添加这几行即可，其他默认不变就行了。\n#也可以使用上面chronyd中说到的公网ntp服务器\nserver 0.cn.pool.ntp.org iburst\nserver 1.cn.pool.ntp.org iburst\nserver 2.cn.pool.ntp.org iburst\nserver 3.cn.pool.ntp.org iburst\n\n")])])]),e("ul",[e("li",[e("p",[t._v("权限配置说明【默认允许所有连接，下面内容了解为主】")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("1 配置方法一：只允许192.168.100.0网段的客户机进行时间同步"),e("br"),t._v("\n在"),e("code",[t._v("restrict default kod nomodify notrap nopeer noquery")]),t._v("（表示默认拒绝所有IP的时间同步）之后增加一行："),e("br"),t._v(" "),e("code",[t._v("restrict 192.168.100.0 mask 255.255.255.0 nomodify notrap")])])]),t._v(" "),e("li",[e("p",[t._v("2 配置方法二：允许任何ip的客户机都可以进行时间同步"),e("br"),t._v("\n将"),e("code",[t._v("restrict default kod nomodify notrap nopeer noquery")]),t._v("修改为如下行："),e("br"),t._v(" "),e("code",[t._v("Restrict default nomodify")])])])])]),t._v(" "),e("li",[e("p",[t._v("参数说明：")]),t._v(" "),e("ul",[e("li",[e("code",[t._v("ignore")]),t._v(" ：关闭所有的 NTP 联机服务")]),t._v(" "),e("li",[e("code",[t._v("nomodify")]),t._v("：客户端不能更改服务端的时间参数，但是客户端可以通过服务端进行网络校时。")]),t._v(" "),e("li",[e("code",[t._v("notrust")]),t._v("：客户端除非通过认证，否则该客户端来源将被视为不信任子网")]),t._v(" "),e("li",[e("code",[t._v("noquery")]),t._v("：不提供客户端的时间查询")])])]),t._v(" "),e("li",[e("p",[t._v("启动ntp服务，并开机自启动")])])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("[root@localhost ~]# systemctl start ntpd\n[root@localhost ~]# systemctl enable ntpd\n\n")])])]),e("ul",[e("li",[t._v("查询ntp是否同步")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("[root@localhost ~]# ntpq -p\n     remote           refid      st t when poll reach   delay   offset  jitter\n==============================================================================\n*119.28.206.193  100.122.36.196   2 u  128  128  377   19.711   -0.468   5.363\n\n")])])]),e("ul",[e("li",[t._v("如果没有立即同步可以执行 "),e("code",[t._v("ntpdate cn.pool.ntp.org")]),t._v(" 或 "),e("code",[t._v("ntpdate -u cn.pool.ntp.org")]),t._v(" 立即同步"),e("br"),t._v("\n同步成功后如下，"),e("code",[t._v("NTP synchronized: yes")])])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("[root@yum-centos-dmz ~]# timedatectl \n      Local time: Wed 2022-07-06 14:08:15 CST\n  Universal time: Wed 2022-07-06 06:08:15 UTC\n        RTC time: Wed 2022-07-06 06:00:13\n       Time zone: Asia/Shanghai (CST, +0800)\n     NTP enabled: yes\nNTP synchronized: yes\n RTC in local TZ: no\n      DST active: n/a\n[root@yum-centos-dmz ~]# \n\n")])])]),e("ul",[e("li",[t._v("开启防火墙ntp默认端口udp123")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("[root@localhost ~]# firewall-cmd --permanent --zone=public --add-port=123/udp\nsuccess\n[root@localhost ~]# firewall-cmd --reload\nsuccess\n\n")])])]),e("h5",{attrs:{id:"说明【重要】"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#说明【重要】"}},[t._v("#")]),t._v(" 说明【重要】")]),t._v(" "),e("ul",[e("li",[t._v("服务器是chronyd服务，客户端如果我也用chronyd服务，有可能能用，有可能不能用，明白我意思吧？"),e("br"),t._v("\n但是我服务端是chronyd，我客户端用ntp方式，欸，那么就很好用，随时用随时正确。")]),t._v(" "),e("li",[t._v("如下，chronyd服务是不正常的，但是我用ntpdata拉取时间后重启又")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('# 现在状态正常\n[root@host-10-241-105-39 ~]# systemctl is-active chronyd\nactive\n[root@host-10-241-105-39 ~]#\n[root@host-10-241-105-39 ~]# \n# 看，之前的是一直同步失败的\n[root@host-10-241-105-39 ~]# timedatectl \n      Local time: Wed 2022-07-06 12:13:41 CST\n  Universal time: Wed 2022-07-06 04:13:41 UTC\n        RTC time: Wed 2022-07-06 04:13:41\n       Time zone: Asia/Shanghai (CST, +0800)\n     NTP enabled: yes\nNTP synchronized: no\n RTC in local TZ: no\n      DST active: n/a\n[root@host-10-241-105-39 ~]# \n\n# 我用ntp的方式更新时间成功了 \n[root@host-10-241-105-39 ~]# ntpdate 1.2.105.41\n 6 Jul 12:22:13 ntpdate[6220]: step time server 1.2.105.41 offset 481.822244 sec\n[root@host-10-241-105-39 ~]# timedatectl \n      Local time: Wed 2022-07-06 12:22:21 CST\n  Universal time: Wed 2022-07-06 04:22:21 UTC\n        RTC time: Wed 2022-07-06 04:14:19\n       Time zone: Asia/Shanghai (CST, +0800)\n     NTP enabled: yes\nNTP synchronized: no\n RTC in local TZ: no\n      DST active: n/a\n[root@host-10-241-105-39 ~]# date\nWed Jul  6 12:22:29 CST 2022\n[root@host-10-241-105-39 ~]#\n\n# 我修改时间为错误的\n[root@host-10-241-105-39 ~]# timedatectl set-time "2022-06-28 17:10:34"\nFailed to set time: Automatic time synchronization is enabled\n[root@host-10-241-105-39 ~]# date\nWed Jul  6 12:22:59 CST 2022\n[root@host-10-241-105-39 ~]# \n[root@host-10-241-105-39 ~]# timedatectl set-ntp no\n[root@host-10-241-105-39 ~]# timedatectl set-time "2022-07-01 17:10:34"\n[root@host-10-241-105-39 ~]# date\nFri Jul  1 17:10:35 CST 2022\n[root@host-10-241-105-39 ~]#\n\n# 使用chronyd的方式又成功了，他奶奶的，之前一直搞都是错误的同步不了。\n[root@host-10-241-105-39 ~]# chronyc tracking\n506 Cannot talk to daemon\n[root@host-10-241-105-39 ~]# systemctl is-active chronyd\nunknown\n[root@host-10-241-105-39 ~]# systemctl restart chronyd\n[root@host-10-241-105-39 ~]# chronyc tracking\nReference ID    : 00000000 ()\nStratum         : 0\nRef time (UTC)  : Thu Jan 01 00:00:00 1970\nSystem time     : 0.000000000 seconds slow of NTP time\nLast offset     : +0.000000000 seconds\nRMS offset      : 0.000000000 seconds\nFrequency       : 26.307 ppm slow\nResidual freq   : +0.000 ppm\nSkew            : 0.000 ppm\nRoot delay      : 1.000000000 seconds\nRoot dispersion : 1.000000000 seconds\nUpdate interval : 0.0 seconds\nLeap status     : Not synchronised\n[root@host-10-241-105-39 ~]# timedatectl \n      Local time: Wed 2022-07-06 12:26:12 CST\n  Universal time: Wed 2022-07-06 04:26:12 UTC\n        RTC time: Fri 2022-07-01 09:12:31\n       Time zone: Asia/Shanghai (CST, +0800)\n     NTP enabled: no\nNTP synchronized: yes\n RTC in local TZ: no\n      DST active: n/a\n[root@host-10-241-105-39 ~]# date\nWed Jul  6 12:26:23 CST 2022\n[root@host-10-241-105-39 ~]# \n[root@host-10-241-105-39 ~]# chronyc sources\n210 Number of sources = 1\nMS Name/IP address         Stratum Poll Reach LastRx Last sample               \n===============================================================================\n^* host-10-241-105-41.opens>     4   6   177    41    +39us[  +73us] +/-   91ms\n[root@host-10-241-105-39 ~]# \n\n')])])]),e("h5",{attrs:{id:"客户端安装ntpd"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#客户端安装ntpd"}},[t._v("#")]),t._v(" 客户端安装ntpd")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("[root@host-10-241-105-39 ~]#  yum install -y ntp\n[root@host-10-241-105-39 ~]#  \n[root@host-10-241-105-39 ~]#  systemctl enable ntpd --now\n[root@host-10-241-105-39 ~]#  systemctl is-active ntpd\nactive\n[root@host-10-241-105-39 ~]# \n\n")])])]),e("h5",{attrs:{id:"客户端配置并重启服务"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#客户端配置并重启服务"}},[t._v("#")]),t._v(" 客户端配置并重启服务")]),t._v(" "),e("ul",[e("li",[t._v("指需要修改一项，server注释现有的4项，加一个服务端ip即可。")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("[root@test ~]# cat /etc/ntp.conf | grep iburst\n#server 0.centos.pool.ntp.org iburst\n##server 1.centos.pool.ntp.org iburst\n#server 2.centos.pool.ntp.org iburst\n#server 3.centos.pool.ntp.org iburst\nserver 1.2.105.41 iburst\n[root@test ~]# \n\n")])])]),e("ul",[e("li",[t._v("重启服务生效")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("[root@test ~]# systemctl restart ntpd\n\n")])])]),e("h5",{attrs:{id:"客户端与ntp-server服务器同步一下时间"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#客户端与ntp-server服务器同步一下时间"}},[t._v("#")]),t._v(" 客户端与NTP server服务器同步一下时间")]),t._v(" "),e("ul",[e("li",[t._v("如果时间没有立即同步，执行："),e("code",[t._v("ntpdata -u 服务端ip")]),e("br"),t._v("\n如下，我修改为错误时间立即同步回来。")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('[root@test ~]# systemctl status ntpd\n● ntpd.service - Network Time Service\n   Loaded: loaded (/usr/lib/systemd/system/ntpd.service; disabled; vendor preset: disabled)\n   Active: active (running) since Wed 2022-07-06 04:05:58 UTC; 32min ago\n  Process: 21024 ExecStart=/usr/sbin/ntpd -u ntp:ntp $OPTIONS (code=exited, status=0/SUCCESS)\n Main PID: 21025 (ntpd)\n   CGroup: /system.slice/ntpd.service\n           └─21025 /usr/sbin/ntpd -u ntp:ntp -g\n\nJul 06 04:05:58 test.novalocal ntpd[21025]: Listen normally on 3 eth0 1.2.105.58 UDP 123\nJul 06 04:05:58 test.novalocal ntpd[21025]: Listen normally on 4 lo ::1 UDP 123\nJul 06 04:05:58 test.novalocal ntpd[21025]: Listen normally on 5 eth0 fe80::f816:3eff:fe18:a626 UDP 123\nJul 06 04:05:58 test.novalocal ntpd[21025]: Listening on routing socket on fd #22 for interface updates\nJul 06 04:05:58 test.novalocal ntpd[21025]: 0.0.0.0 c016 06 restart\nJul 06 04:05:58 test.novalocal ntpd[21025]: 0.0.0.0 c012 02 freq_set kernel 0.000 PPM\nJul 06 04:05:58 test.novalocal ntpd[21025]: 0.0.0.0 c011 01 freq_not_set\nJul 06 04:06:05 test.novalocal ntpd[21025]: 0.0.0.0 c614 04 freq_mode\nJul 06 04:27:22 test.novalocal ntpd[21025]: 0.0.0.0 0612 02 freq_set kernel 17.735 PPM\nJul 06 04:27:22 test.novalocal ntpd[21025]: 0.0.0.0 0615 05 clock_sync\n[root@test ~]# \n[root@test ~]# date\nWed Jul  6 04:38:23 UTC 2022\n[root@test ~]# timedatectl set-ntp no\n[root@test ~]# timedatectl set-time "2022-06-28 17:10:34"\n[root@test ~]# ntpdate 1.2.105.41\n28 Jun 17:10:46 ntpdate[21076]: the NTP socket is in use, exiting\n[root@test ~]# date\nTue Jun 28 17:10:48 UTC 2022\n[root@test ~]# ntpdate -u 1.2.105.41\n 6 Jul 04:39:32 ntpdate[21079]: step time server 1.2.105.41 offset 646112.382185 sec\n[root@test ~]# date\nWed Jul  6 04:39:35 UTC 2022\n[root@test ~]# \n\n')])])]),e("h5",{attrs:{id:"查看同步状态"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#查看同步状态"}},[t._v("#")]),t._v(" 查看同步状态")]),t._v(" "),e("ul",[e("li",[t._v("客户端和服务器都可以查询。")]),t._v(" "),e("li",[t._v("前面有"),e("code",[t._v("*")]),t._v("则正常。")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("#客户端1\n[root@test ~]# ntpq -p\n     remote           refid      st t when poll reach   delay   offset  jitter\n==============================================================================\n*host-10-241-105 162.159.200.1    4 u   45   64  377    0.643    3.976  11.360\n[root@test ~]# \n\n#客户端2\n[root@xz-oa-uatapp-05 ~]# ntpq -p\n     remote           refid      st t when poll reach   delay   offset  jitter\n==============================================================================\n*1.2.105.41   162.159.200.1    4 u   59   64  377    1.296   -4.194   0.785\n[root@xz-oa-uatapp-05 ~]# \n\n")])])]),e("h5",{attrs:{id:"同步时间加入定时任务"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#同步时间加入定时任务"}},[t._v("#")]),t._v(" 同步时间加入定时任务")]),t._v(" "),e("ul",[e("li",[t._v("理论上同步一次时间，如果系统不重启会一直生效保持和服务端时间一致，如果重启后没有立即更新，执行一下 "),e("code",[t._v("ntpdate -u 服务端ip")]),t._v("即可，个人觉得加定时任务意义不大。")]),t._v(" "),e("li",[t._v("客户端设置：")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("[root@test ~]# ls /usr/sbin/ntpdate \n/usr/sbin/ntpdate\n[root@test ~]# \n[root@test ~]# crontab -e\n\n#加入一行，意思是每天8点30同步一次时间\n30 8 * * * /usr/sbin/ntpdate -u 1.2.105.41\n\n")])])]),e("h2",{attrs:{id:"时间不同步可能的原因"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#时间不同步可能的原因"}},[t._v("#")]),t._v(" "),e("a",{attrs:{href:"https://blog.csdn.net/cuichongxin/article/details/123178318",target:"_blank",rel:"noopener noreferrer"}},[e("OutboundLink")],1),t._v("时间不同步可能的原因")]),t._v(" "),e("h3",{attrs:{id:"_1-chrony服务端、客户端-版本是否一致和服务是否正常【chrony各版本之间差异很大-确保版本一致】"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-chrony服务端、客户端-版本是否一致和服务是否正常【chrony各版本之间差异很大-确保版本一致】"}},[t._v("#")]),t._v(" 1.chrony服务端、客户端 版本是否一致和服务是否正常【chrony各版本之间差异很大，确保版本一致】")]),t._v(" "),e("ul",[e("li",[t._v("查看客户端和服务端版本是否一致")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("# 服务端\n[root@ccx_server128 ~]# chronyc -v\nchronyc (chrony) version 3.2 (+READLINE +IPV6 +DEBUG)\n[root@ccx_server128 ~]# \n#客户端\n[root@ccx_server129 ~]# chronyc -v\nchronyc (chrony) version 3.2 (+READLINE +IPV6 +DEBUG)\n[root@ccx_server129 ~]# \n\n")])])]),e("ul",[e("li",[t._v("查看服务是否正常")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("# 服务端\n[root@ccx_server128 ~]# systemctl is-active chronyd\nactive\n[root@ccx_server128 ~]# \n# 客户端\n[root@ccx_server129 ~]# systemctl is-active chronyd\nactive\n[root@ccx_server129 ~]# \n\n")])])]),e("h3",{attrs:{id:"_2、服务端防火墙原因"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2、服务端防火墙原因"}},[t._v("#")]),t._v(" 2、服务端防火墙原因")]),t._v(" "),e("ul",[e("li",[t._v("防火墙这个东西应该没啥好说的了，无论是iptables还是firewalld都最好关闭，如果不能关闭，则放开123端口【上面有说防火墙设置。】")]),t._v(" "),e("li",[t._v("selinux也可以关闭。"),e("br"),t._v(" "),e("code",[t._v("setenforce 0")]),t._v("临时关闭")])]),t._v(" "),e("h3",{attrs:{id:"_3、检查服务端和客户端是否能互通"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3、检查服务端和客户端是否能互通"}},[t._v("#")]),t._v(" 3、检查服务端和客户端是否能互通")]),t._v(" "),e("ul",[e("li",[t._v("也就是说客户端和服务端是不是在同一网络，能互相ssh就证明网络没问题。")])]),t._v(" "),e("h3",{attrs:{id:"_4、看看时区是否正确"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4、看看时区是否正确"}},[t._v("#")]),t._v(" 4、看看时区是否正确")]),t._v(" "),e("ul",[e("li",[t._v("执行"),e("code",[t._v("date")]),t._v(" 如果时区不是CST修改时区，我今天就遇到这个问题了，修改方式如下"),e("br"),t._v("\n这种情况一般是要和服务端保持一致哈，如果服务端不是est，客户端单独改了也没用。")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("[root@ccx_server129 ~]# date\nMon Feb 28 07:58:21 EST 2022\n[root@ccx_server129 ~]# \n[root@ccx_server129 ~]# timedatectl set-timezone Asia/Shanghai\n[root@ccx_server129 ~]# date\nMon Feb 28 22:56:13 CST 2022\n[root@ccx_server129 ~]# \n\n")])])]),e("h3",{attrs:{id:"_5、间隔2小时左右-chrony服务端机器ntp不同步"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5、间隔2小时左右-chrony服务端机器ntp不同步"}},[t._v("#")]),t._v(" 5、间隔2小时左右，chrony服务端机器ntp不同步")]),t._v(" "),e("ul",[e("li",[t._v("意思是NTP synchronized这个出问题了，看下面注释后面说的"),e("br"),t._v("\n但是此时同步状态是正常的【^*】")]),t._v(" "),e("li",[t._v("未找到相应解决办法。临时解决方法 ：在定时任务中 每隔一段时间重启该客户端的chrony。")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("[root@ccx_server129 ~]# timedatectl \n      Local time: Tue 2022-03-01 00:22:57 CST\n  Universal time: Mon 2022-02-28 16:22:57 UTC\n        RTC time: Mon 2022-02-28 16:22:57\n       Time zone: Asia/Shanghai (CST, +0800)\n     NTP enabled: yes\nNTP synchronized: yes # 就是这个变成no了\n RTC in local TZ: yes\n      DST active: n/a\n\nWarning: The system is configured to read the RTC time in the local time zone.\n         This mode can not be fully supported. It will create various problems\n         with time zone changes and daylight saving time adjustments. The RTC\n         time is never updated, it relies on external facilities to maintain it.\n         If at all possible, use RTC in UTC by calling\n         'timedatectl set-local-rtc 0'.\n[root@ccx_server129 ~]# \n[root@ccx_server129 ~]# chronyc sources\n210 Number of sources = 1\nMS Name/IP address         Stratum Poll Reach LastRx Last sample               \n===============================================================================\n^* ccx_server128                10   9   377   499    -15us[  -19us] +/-  133us\n[root@ccx_server129 ~]# \n\n")])])]),e("h3",{attrs:{id:"_6、更换为ntp方式连接"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_6、更换为ntp方式连接"}},[t._v("#")]),t._v(" 6、更换为ntp方式连接")]),t._v(" "),e("ul",[e("li",[t._v("我在测试环境各种顺畅，跑到真实环境就是各种报错，真绝了。这是今天遇到的一个大坑，解决方式就是更换为ntp。")]),t._v(" "),e("li",[t._v("服务端是chronyd，客户端用chronyd老是出问题，就改用ntp的方式连接chronyd即可。具体方法见上面ntp的方式连接chronyd服务端。")])]),t._v(" "),e("h3",{attrs:{id:"_7、配置文件server和allow"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_7、配置文件server和allow"}},[t._v("#")]),t._v(" 7、配置文件server和allow")]),t._v(" "),e("p",[t._v("我的服务端今天我是改为如下才正常的。"),e("br"),t._v("\n可以参考一下。")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("[root@yum-centos-dmz ~]# cat /etc/chrony.conf \n# Use public servers from the pool.ntp.org project.\n# Please consider joining the pool (http://www.pool.ntp.org/join.html).\n#server 0.centos.pool.ntp.org iburst\n#server 1.centos.pool.ntp.org iburst\n#server 2.centos.pool.ntp.org iburst\n#server 3.centos.pool.ntp.org iburst\nserver cn.pool.ntp.org iburst\n#server 0.cn.pool.ntp.org iburst\n#server 1.cn.pool.ntp.org iburst\n#server 2.cn.pool.ntp.org iburst\n#server 3.cn.pool.ntp.org iburst\n\n# Record the rate at which the system clock gains/losses time.\ndriftfile /var/lib/chrony/drift\n\n# Allow the system clock to be stepped in the first three updates\n# if its offset is larger than 1 second.\nmakestep 1.0 3\n\n# Enable kernel synchronization of the real-time clock (RTC).\nrtcsync\n\n# Enable hardware timestamping on all interfaces that support it.\n#hwtimestamp *\n\n# Increase the minimum number of selectable sources required to adjust\n# the system clock.\n#minsources 2\n\n# Allow NTP client access from local network.\n#allow 192.168.0.0/16\nallow 1.2.105.0/24\nallow 1.2.0.0/16\n\n# Serve time even if not synchronized to a time source.\n#local stratum 10\n\n# Specify file containing keys for NTP authentication.\n#keyfile /etc/chrony.keys\n\n# Specify directory for log files.\nlogdir /var/log/chrony\n\n# Select which information is logged.\n#log measurements statistics tracking\n[root@yum-centos-dmz ~]# \n\n")])])]),e("h3",{attrs:{id:"说明"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#说明"}},[t._v("#")]),t._v(" 说明")]),t._v(" "),e("ul",[e("li",[t._v("一般就上面几种情况导致不同步。")]),t._v(" "),e("li",[t._v("如果你上面都排查了还是没用，仔细检查配置文件，配置文件有问题。")])]),t._v(" "),e("h2",{attrs:{id:"timedatectl说明"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#timedatectl说明"}},[t._v("#")]),t._v(" "),e("a",{attrs:{href:"https://blog.csdn.net/cuichongxin/article/details/123178318",target:"_blank",rel:"noopener noreferrer"}},[e("OutboundLink")],1),t._v("timedatectl说明")]),t._v(" "),e("p",[t._v("timedatectl是Linux下的一条命令，用于控制系统时间和日期。可以用来查询和更改系统时钟于设定，同时可以设定和修改时区信息。这篇文章简单介绍一下如何使用timedatectl进行常见操作。")]),t._v(" "),e("h3",{attrs:{id:"查看系统时间timedatectl"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#查看系统时间timedatectl"}},[t._v("#")]),t._v(" 查看系统时间timedatectl")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("[root@ccx_server128 ~]# timedatectl \n      Local time: 二 2022-03-01 00:47:50 CST #当地时间\n  Universal time: 一 2022-02-28 16:47:50 UTC #伦敦时间\n        RTC time: 一 2022-02-28 16:47:50 #硬件时间\n       Time zone: Asia/Shanghai (CST, +0800) #时区：亚洲上海（东8区）UTC时间加上8等于当前时间\n     NTP enabled: yes #NTP服务\nNTP synchronized: no #NTP时间是否启用\n RTC in local TZ: no  #是否启用RTC硬件时间【设定系统时间计算方式，0表示使用utc时间计算方式，yes为0，no为1】【timedatectl set-local-rtc 1这个命令控制】\n      DST active: n/a\n[root@ccx_server128 ~]# \n\n")])])]),e("h3",{attrs:{id:"常见用法"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#常见用法"}},[t._v("#")]),t._v(" 常见用法")]),t._v(" "),e("ul",[e("li",[t._v("使用timedatectl可以进行如下常见操作\n"),e("ul",[e("li",[t._v("查看当前时间/日期/时区："),e("code",[t._v("timedatectl")]),t._v("或者"),e("code",[t._v("timedatectl status")])]),t._v(" "),e("li",[t._v("查看所有可用时区："),e("code",[t._v("timedatectl list-timezones")])]),t._v(" "),e("li",[t._v("设置时区："),e("code",[t._v("timedatectl set-timezone 时区信息")]),t._v(" "),e("ul",[e("li",[t._v("显示系统的所有时区： "),e("code",[t._v("timedatectl list-timezones")])]),t._v(" "),e("li",[t._v("如：设定系统时区为亚洲上海"),e("code",[t._v("timedatectl set-timezone Asia/Shanghai")])])])]),t._v(" "),e("li",[t._v("设置UTC："),e("code",[t._v("timedatectl set-timezone UTC")]),t._v("【别乱操作，设置这个以后上面定义的上海+8就没了，变成+0了】")]),t._v(" "),e("li",[t._v("设置硬件时钟为本地时间："),e("code",[t._v("timedatectl set-local-rtc 1")]),t._v("【/etc/adjtime 文件中第三个为状态】")]),t._v(" "),e("li",[t._v("设置硬件时钟为UTC时间："),e("code",[t._v("timedatectl set-local-rtc 0")]),t._v("【/etc/adjtime 文件中第三个为状态】")]),t._v(" "),e("li",[t._v("设置时间："),e("code",[t._v("timedatectl set-time HH:MM:SS")])]),t._v(" "),e("li",[t._v("设置日期："),e("code",[t._v("timedatectl set-time YYYY-MM-DD")])]),t._v(" "),e("li",[t._v("设置日期时间："),e("code",[t._v("timedatectl set-time “YYYY-MM-DD HH:MM:SS”")]),t._v("【年月日时分秒】\n"),e("ul",[e("li",[t._v("修改报错执行："),e("code",[t._v("timedatectl set-ntp no")])]),t._v(" "),e("li",[t._v("修改时间后执行："),e("code",[t._v("clock -w")]),t._v("【写入硬件时间，一般2个时间同步修改】")])])]),t._v(" "),e("li",[t._v("启动NTP时间同步（启用NTP服务或者Chrony服务）："),e("code",[t._v("timedatectl set-ntp true")])]),t._v(" "),e("li",[t._v("禁用NTP时间同步（禁用NTP服务或者Chrony服务）："),e("code",[t._v("timedatectl set-ntp false")])])])])]),t._v(" "),e("h3",{attrs:{id:"使用示例"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#使用示例"}},[t._v("#")]),t._v(" "),e("a",{attrs:{href:"https://blog.csdn.net/cuichongxin/article/details/123178318",target:"_blank",rel:"noopener noreferrer"}},[e("OutboundLink")],1),t._v("使用示例")]),t._v(" "),e("p",[t._v("我觉得上面常见用法中已经很明显了，我这不做全部示例，只做部分。")]),t._v(" "),e("h4",{attrs:{id:"设置时区"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#设置时区"}},[t._v("#")]),t._v(" "),e("a",{attrs:{href:"https://blog.csdn.net/cuichongxin/article/details/123178318",target:"_blank",rel:"noopener noreferrer"}},[e("OutboundLink")],1),t._v("设置时区")]),t._v(" "),e("ul",[e("li",[t._v("设置时区："),e("code",[t._v("timedatectl set-timezone 时区信息")]),t._v("【“要不要都行】\n"),e("ul",[e("li",[t._v("显示系统的所有时区： "),e("code",[t._v("timedatectl list-timezones")])]),t._v(" "),e("li",[t._v("如：设定系统时区为亚洲上海"),e("code",[t._v("timedatectl set-timezone Asia/Shanghai")])])])])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("[root@ccx_server129 ~]# date\nMon Feb 28 07:58:21 EST 2022\n[root@ccx_server129 ~]# \n[root@ccx_server129 ~]# timedatectl list-timezones | grep hai\nAsia/Shanghai\n[root@ccx_server129 ~]# \n[root@ccx_server129 ~]# timedatectl set-timezone Asia/Shanghai\n[root@ccx_server129 ~]# date\nMon Feb 28 22:56:13 CST 2022\n[root@ccx_server129 ~]# \n\n")])])]),e("h4",{attrs:{id:"设置时间"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#设置时间"}},[t._v("#")]),t._v(" 设置时间")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("设置时间："),e("code",[t._v("timedatectl set-time HH:MM:SS")])])]),t._v(" "),e("li",[e("p",[t._v("设置日期："),e("code",[t._v("timedatectl set-time YYYY-MM-DD")])])]),t._v(" "),e("li",[e("p",[t._v("设置日期时间："),e("code",[t._v("timedatectl set-time “YYYY-MM-DD HH:MM:SS”")]),t._v("【年月日时分秒】")]),t._v(" "),e("ul",[e("li",[t._v("修改报错执行："),e("code",[t._v("timedatectl set-ntp no")])]),t._v(" "),e("li",[t._v("修改时间后执行："),e("code",[t._v("clock -w")]),t._v("【写入硬件时间，一般2个时间同步修改】")])])]),t._v(" "),e("li",[e("p",[t._v("我这以我ntp服务端时间为例")])])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('[root@ccx_server128 ~]# date\n2022年 03月 01日 星期二 01:10:04 CST\n[root@ccx_server128 ~]# timedatectl set-time "2022-02-28 17:10:34"\nFailed to set time: Automatic time synchronization is enabled\n[root@ccx_server128 ~]# timedatectl \n      Local time: 二 2022-03-01 01:13:18 CST\n  Universal time: 一 2022-02-28 17:13:18 UTC\n        RTC time: 一 2022-02-28 17:13:18\n       Time zone: Asia/Shanghai (CST, +0800)\n     NTP enabled: yes\nNTP synchronized: no\n RTC in local TZ: no\n      DST active: n/a\n[root@ccx_server128 ~]# timedatectl set-ntp no\n[root@ccx_server128 ~]# timedatectl set-time "2022-02-28 17:13:55"\n[root@ccx_server128 ~]# date\n2022年 02月 28日 星期一 17:13:57 CST\n[root@ccx_server128 ~]# timedatectl \n      Local time: 一 2022-02-28 17:14:02 CST\n  Universal time: 一 2022-02-28 09:14:02 UTC\n        RTC time: 一 2022-02-28 09:14:02\n       Time zone: Asia/Shanghai (CST, +0800)\n     NTP enabled: no\nNTP synchronized: no\n RTC in local TZ: no\n      DST active: n/a\n[root@ccx_server128 ~]# timedatectl set-ntp yes\n[root@ccx_server128 ~]# \n\n# 然后我去客户端立即获取。。。多香啊\n[root@ccx_server129 ~]# date\nTue Mar  1 01:15:13 CST 2022\n[root@ccx_server129 ~]# \n[root@ccx_server129 ~]# ntpdate 192.168.59.128\n28 Feb 17:15:37 ntpdate[46458]: step time server 192.168.59.128 offset -28789.784156 sec\n[root@ccx_server129 ~]# date\nMon Feb 28 17:15:39 CST 2022\n[root@ccx_server129 ~]# \n\n')])])]),e("h4",{attrs:{id:"设置硬件时间"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#设置硬件时间"}},[t._v("#")]),t._v(" 设置硬件时间")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("设置硬件时钟为本地（LOCAL）时间："),e("code",[t._v("timedatectl set-local-rtc 1")]),t._v("【/etc/adjtime 文件中第三个为状态】")])]),t._v(" "),e("li",[e("p",[t._v("设置硬件时钟为UTC时间："),e("code",[t._v("timedatectl set-local-rtc 0")]),t._v("【/etc/adjtime 文件中第三个为状态】")])]),t._v(" "),e("li",[e("p",[t._v("没有加入ntp服务测试：")])])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("[root@ccx_server130 ~]# cat /etc/adjtime  #没有加入ntp显示是这样的\n0.0 0 0.0\n0\nUTC\n[root@ccx_server130 ~]# timedatectl \n      Local time: Tue 2022-03-01 01:27:44 CST\n  Universal time: Mon 2022-02-28 17:27:44 UTC\n        RTC time: Mon 2022-02-28 17:27:44\n       Time zone: Asia/Shanghai (CST, +0800)\n     NTP enabled: yes\nNTP synchronized: no\n RTC in local TZ: no\n      DST active: n/a\n[root@ccx_server130 ~]# \n[root@ccx_server130 ~]# timedatectl set-local-rtc 1 #设置为本地\n[root@ccx_server130 ~]# timedatectl \n      Local time: Tue 2022-03-01 01:27:55 CST\n  Universal time: Mon 2022-02-28 17:27:55 UTC\n        RTC time: Tue 2022-03-01 01:27:56\n       Time zone: Asia/Shanghai (CST, +0800)\n     NTP enabled: yes\nNTP synchronized: no\n RTC in local TZ: yes\n      DST active: n/a\n\n# 改成local以后会有一串这样的警告，也不知道有啥副作用。。..\nWarning: The system is configured to read the RTC time in the local time zone.\n         This mode can not be fully supported. It will create various problems\n         with time zone changes and daylight saving time adjustments. The RTC\n         time is never updated, it relies on external facilities to maintain it.\n         If at all possible, use RTC in UTC by calling\n         'timedatectl set-local-rtc 0'.\n[root@ccx_server130 ~]# cat /etc/adjtime \n0.0 0 0.0\n0\nLOCAL  #显示local\n[root@ccx_server130 ~]# \n[root@ccx_server130 ~]# timedatectl set-local-rtc 0\n[root@ccx_server130 ~]# cat /etc/adjtime \n0.0 0 0.0\n0\nUTC\n[root@ccx_server130 ~]# timedatectl \n      Local time: Tue 2022-03-01 01:28:27 CST\n  Universal time: Mon 2022-02-28 17:28:27 UTC\n        RTC time: Mon 2022-02-28 17:28:27\n       Time zone: Asia/Shanghai (CST, +0800)\n     NTP enabled: yes\nNTP synchronized: no\n RTC in local TZ: no\n      DST active: n/a\n[root@ccx_server130 ~]# \n\n")])])]),e("ul",[e("li",[t._v("加入ntp"),e("br"),t._v("\n就文件中显示不一样而已，我也不知道有啥区别。。。。反正其他倒是一样的，改为local会有一串警告")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("[root@ccx_server129 ~]# cat /etc/adjtime \n0.000000 1646040080 0.000000\n1646040080\nUTC\n[root@ccx_server129 ~]# \n\n")])])]),e("h4",{attrs:{id:"utc测试"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#utc测试"}},[t._v("#")]),t._v(" UTC测试")]),t._v(" "),e("ul",[e("li",[t._v("设置UTC："),e("code",[t._v("timedatectl set-timezone UTC")]),t._v("【别乱操作，设置这个以后上面定义的上海+8就没了，变成+0了】"),e("br"),t._v("\n哈哈 我一开始还没搞懂这个UTC是啥，我以为这个UTC和上面设置硬件时间是一样的【改变的是UTC/LOCAL】"),e("br"),t._v("\n下面是我测试，你先看看，能发现啥不~")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("[root@ccx_server130 ~]# timedatectl  #设置为utc前\n      Local time: Tue 2022-03-01 01:28:27 CST\n  Universal time: Mon 2022-02-28 17:28:27 UTC\n        RTC time: Mon 2022-02-28 17:28:27\n       Time zone: Asia/Shanghai (CST, +0800)\n     NTP enabled: yes\nNTP synchronized: no\n RTC in local TZ: no\n      DST active: n/a\n[root@ccx_server130 ~]# \n[root@ccx_server130 ~]# \n[root@ccx_server130 ~]# cat /etc/adjtime \n0.0 0 0.0\n0\nUTC\n[root@ccx_server130 ~]# timedatectl set-local-rtc 1 \n[root@ccx_server130 ~]# cat /etc/adjtime \n0.0 0 0.0\n0\nLOCAL\n[root@ccx_server130 ~]# timedatectl set-timezone UTC \n[root@ccx_server130 ~]# cat /etc/adjtime \n0.0 0 0.0\n0\nLOCAL\n[root@ccx_server130 ~]# \n[root@ccx_server130 ~]# timedatectl \n      Local time: Mon 2022-02-28 17:31:43 UTC\n  Universal time: Mon 2022-02-28 17:31:43 UTC\n        RTC time: Mon 2022-02-28 17:31:43\n       Time zone: UTC (UTC, +0000)\n     NTP enabled: yes\nNTP synchronized: no\n RTC in local TZ: yes\n      DST active: n/a\n\nWarning: The system is configured to read the RTC time in the local time zone.\n         This mode can not be fully supported. It will create various problems\n         with time zone changes and daylight saving time adjustments. The RTC\n         time is never updated, it relies on external facilities to maintain it.\n         If at all possible, use RTC in UTC by calling\n         'timedatectl set-local-rtc 0'.\n[root@ccx_server130 ~]# timedatectl set-local-rtc 0\n[root@ccx_server130 ~]# timedatectl \n      Local time: Mon 2022-02-28 17:32:07 UTC\n  Universal time: Mon 2022-02-28 17:32:07 UTC\n        RTC time: Mon 2022-02-28 17:32:08\n       Time zone: UTC (UTC, +0000)\n     NTP enabled: yes\nNTP synchronized: no\n RTC in local TZ: no\n      DST active: n/a\n[root@ccx_server130 ~]# \n\n")])])]),e("ul",[e("li",[t._v("解密，后面我发现我设置为LOCAL以后，再设置UTC，但我发现配置文件中LOCAL没变，于是确认这个不是设置硬件时间的。"),e("br"),t._v("\n然后执行"),e("code",[t._v("timedatectl set-timezone LOCAL")]),t._v("报错了，并且我在"),e("code",[t._v("timedatectl list-timezones")]),t._v(" 这里面看到了UTC，发现不对劲，仔细一看"),e("code",[t._v("timedatectl")]),t._v("中的Time zone选项，发现后面变成UTC，并且时间为+0了，哈哈，我之前设置的亚洲上海+8没了。"),e("br"),t._v("\n所以，这个UTC就是恢复默认的哦，为+0，所以我还是需要改回去的哈")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("[root@ccx_server130 ~]# timedatectl set-timezone UTC \n[root@ccx_server130 ~]# timedatectl \n      Local time: Mon 2022-02-28 17:32:12 UTC\n  Universal time: Mon 2022-02-28 17:32:12 UTC\n        RTC time: Mon 2022-02-28 17:32:12\n       Time zone: UTC (UTC, +0000)\n     NTP enabled: yes\nNTP synchronized: no\n RTC in local TZ: no\n      DST active: n/a\n[root@ccx_server130 ~]# \n[root@ccx_server130 ~]# timedatectl set-timezone Asia/Shanghai\n[root@ccx_server130 ~]# timedatectl \n      Local time: Tue 2022-03-01 01:43:26 CST\n  Universal time: Mon 2022-02-28 17:43:26 UTC\n        RTC time: Mon 2022-02-28 17:43:27\n       Time zone: Asia/Shanghai (CST, +0800)\n     NTP enabled: yes\nNTP synchronized: no\n RTC in local TZ: no\n      DST active: n/a\n[root@ccx_server130 ~]# \n\n")])])]),e("p",[t._v("https://blog.csdn.net/cuichongxin/article/details/123178318")]),t._v(" "),e("p",[t._v("https://blog.csdn.net/wangjie72270/article/details/122196213?spm=1018.2226.3001.9630.1&extra%5Btitle%5D=Linux%20%E2%9D%89%20Chronyd%E6%97%B6%E9%97%B4%E5%90%8C%E6%AD%A5%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%AF%A6%E8%A7%A3&extra%5Butm_source%5D=vip_chatgpt_common_search_pc_result&extra%5Butm_medium%5D=distribute.pc_search_result.none-task-cask-2~all~insert_cask~default-1-null.142%5Ev96%5Epc_search_result_base2")])])}),[],!1,null,null,null);e.default=a.exports}}]);