# é—®é¢˜é›†--æ·˜å®é•œåƒæºSSLè¿‡æœŸ

```sh
xxx@MacBook-Pro xfg-dev-tech-blog-master % yarn
yarn install v1.22.17
info No lockfile found.
warning package-lock.json found. Your project contains lock files generated by tools other than Yarn. It is advised not to mix package managers in order to avoid resolution inconsistencies caused by unsynchronized lock files. To clear this warning, remove package-lock.json.
[1/4] ğŸ”  Resolving packages...
error An unexpected error occurred: "https://registry.npm.taobao.org/@vuepress%2fclient: certificate has expired".
info If you think this is a bug, please open a bug report with the information provided in "/Volumes/zs-2T/zs-study/zs-project/xfg-dev-tech-blog-master/yarn-error.log".
info Visit https://yarnpkg.com/en/docs/cli/install for documentation about this command.
```

> *yarn-error.log*

```sh
Trace: 
  Error: certificate has expired
      at TLSSocket.onConnectSecure (node:_tls_wrap:1539:34)
      at TLSSocket.emit (node:events:513:28)
      at TLSSocket._finishInit (node:_tls_wrap:953:8)
      at TLSWrap.ssl.onhandshakedone (node:_tls_wrap:734:12)
      

ç—•è¿¹ï¼š
   é”™è¯¯ï¼šè¯ä¹¦å·²è¿‡æœŸ
       åœ¨ TLSSocket.onConnectSecure ï¼ˆèŠ‚ç‚¹ï¼š_tls_wrapï¼š1539ï¼š34ï¼‰
       åœ¨ TLSSocket.emit ï¼ˆèŠ‚ç‚¹ï¼šäº‹ä»¶ï¼š513ï¼š28ï¼‰
       åœ¨ TLSSocket._finishInit ï¼ˆèŠ‚ç‚¹ï¼š_tls_wrapï¼š953ï¼š8ï¼‰
       åœ¨ TLSWrap.ssl.onhandshakedone ï¼ˆèŠ‚ç‚¹ï¼š_tls_wrapï¼š734ï¼š12ï¼‰
```



## è§£å†³æ–¹å¼

```sh
npm config set strict-ssl false

yarn config set "strict-ssl" false -g
```

## configä¿¡æ¯

```sh
xxx@MacBook-Pro xfg-dev-tech-blog-master % npm config list
; "global" config from /Users/miyufeng/.nvm/versions/node/v16.20.2/etc/npmrc

; registry = "https://registry.npmmirror.com/" ; overridden by user
strict-ssl = true 

; "user" config from /Users/miyufeng/.npmrc

chromedriver_cdnurl = "https://npm.taobao.org/mirrors/chromedriver" 
CHROMEDRIVER_CDNURL = "https://npm.taobao.org/mirrors/chromedriver" 
ELECTRON_BUILDER_BINARIES_MIRROR = "https://npm.taobao.org/mirrors/electron-builder-binaries/" 
ELECTRON_MIRROR = "https://npm.taobao.org/mirrors/electron/" 
global = true 
NVM_NODEJS_ORG_MIRROR = "https://npm.taobao.org/mirrors/node" 
OPERADRIVER = "https://npm.taobao.org/mirrors/operadriver" 
phantomjs_cdnurl = "https://npm.taobao.org/dist/phantomjs" 
PYTHON_MIRROR = "https://npm.taobao.org/mirrors/python" 
registry = "https://registry.npm.taobao.org/" 
sass_binary_site = "https://npm.taobao.org/mirrors/node-sass" 

; node bin location = /Users/miyufeng/.nvm/versions/node/v16.20.2/bin/node
; node version = v16.20.2
; npm local prefix = /Volumes/zs-2T/zs-study/zs-project/xfg-dev-tech-blog-master
; npm version = 8.19.4
; cwd = /Volumes/zs-2T/zs-study/zs-project/xfg-dev-tech-blog-master
; HOME = /Users/miyufeng
; Run `npm config ls -l` to show all defaults.
```

```sh
xxx@MacBook-Pro xfg-dev-tech-blog-master % yarn config list
yarn config v1.22.17
info yarn config
{
  'version-tag-prefix': 'v',
  'version-git-tag': true,
  'version-commit-hooks': true,
  'version-git-sign': false,
  'version-git-message': 'v%s',
  'init-version': '1.0.0',
  'init-license': 'MIT',
  'save-prefix': '^',
  'bin-links': true,
  'ignore-scripts': false,
  'ignore-optional': false,
  registry: 'https://registry.npmmirror.com',
  'strict-ssl': true,
  'user-agent': 'yarn/1.22.17 npm/? node/v16.20.2 darwin x64',
  'ignore-engines': true,
  lastUpdateCheck: 1706663282683
}
info npm config
{
  'strict-ssl': true,
  registry: 'https://registry.npm.taobao.org/',
  phantomjs_cdnurl: 'https://npm.taobao.org/dist/phantomjs',
  chromedriver_cdnurl: 'https://npm.taobao.org/mirrors/chromedriver',
  sass_binary_site: 'https://npm.taobao.org/mirrors/node-sass',
  ELECTRON_MIRROR: 'https://npm.taobao.org/mirrors/electron/',
  NVM_NODEJS_ORG_MIRROR: 'https://npm.taobao.org/mirrors/node',
  CHROMEDRIVER_CDNURL: 'https://npm.taobao.org/mirrors/chromedriver',
  OPERADRIVER: 'https://npm.taobao.org/mirrors/operadriver',
  ELECTRON_BUILDER_BINARIES_MIRROR: 'https://npm.taobao.org/mirrors/electron-builder-binaries/',
  PYTHON_MIRROR: 'https://npm.taobao.org/mirrors/python',
  global: '='
}
âœ¨  Done in 0.37s.
```

### å…³é—­strict-ssl

```sh
npm config set strict-ssl false

yarn config set "strict-ssl" false
```

```sh
xxx@MacBook-Pro xfg-dev-tech-blog-master % yarn config list                  
yarn config v1.22.17
info yarn config
{
...
  'strict-ssl': false,
 ...
}
info npm config
{
  'strict-ssl': false,
...
}
```

### ç›´æ¥ä¿®æ”¹é…ç½®æ–‡ä»¶

> /Users/ç”¨æˆ·å/.yarnrc

```sh
# THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY.
# yarn lockfile v1


registry "https://registry.npmmirror.com"
ignore-engines true
lastUpdateCheck 1706663282683
strict-ssl false

```

> /Users/miyufeng/.npmrc

```sh
registry=https://registry.npm.taobao.org/
phantomjs_cdnurl=https://npm.taobao.org/dist/phantomjs
chromedriver_cdnurl=https://npm.taobao.org/mirrors/chromedriver
sass_binary_site=https://npm.taobao.org/mirrors/node-sass
ELECTRON_MIRROR=https://npm.taobao.org/mirrors/electron/
NVM_NODEJS_ORG_MIRROR=https://npm.taobao.org/mirrors/node
CHROMEDRIVER_CDNURL=https://npm.taobao.org/mirrors/chromedriver
OPERADRIVER=https://npm.taobao.org/mirrors/operadriver
ELECTRON_BUILDER_BINARIES_MIRROR=https://npm.taobao.org/mirrors/electron-builder-binaries/
PYTHON_MIRROR=https://npm.taobao.org/mirrors/python
global="="
```



## .npmrc

### .npmrcé…ç½®æ–‡ä»¶çš„ä¼˜å…ˆçº§

`.npmrc`å¯ä»¥ç†è§£æˆ`npm running cnfiguration`ï¼Œå³`npm`è¿è¡Œæ—¶é…ç½®æ–‡ä»¶ã€‚

`.npmrc`å¯ä»¥è®¾ç½®`package.json`ä¸­ä¾èµ–åŒ…çš„å®‰è£…æ¥æºï¼Œå³ä»å“ªé‡Œä¸‹è½½ä¾èµ–åŒ…ã€‚

ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬çš„ç”µè„‘ä¸­æœ‰å¤šä¸ª`.npmrc`æ–‡ä»¶ï¼Œæˆ‘ä»¬åœ¨å®‰è£…åŒ…æ—¶ï¼Œ`npm`æŒ‰ç…§å¦‚ä¸‹é¡ºåºè¯»å–è¿™äº›é…ç½®æ–‡ä»¶ï¼š

1. é¡¹ç›®é…ç½®æ–‡ä»¶: `/project/.npmrc`

2. ç”¨æˆ·é…ç½®æ–‡ä»¶ï¼š`~/.npmrc`

   æˆ‘ä»¬å¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤ï¼Œæ¥è·å–`.npmrcç”¨æˆ·é…ç½®æ–‡ä»¶`è·¯å¾„ï¼š
   å¦‚æœæƒ³æ¢å¤é»˜è®¤é…ç½®ï¼Œåªéœ€è¦å°†ç”¨æˆ·é…ç½®æ–‡ä»¶`~/.npmrc`åˆ é™¤å³å¯ã€‚

3. å…¨å±€é…ç½®æ–‡ä»¶ï¼š`$PREFIX/etc/npmrc`
   æˆ‘ä»¬å¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤ï¼Œæ¥è·å–`.npmrc å…¨å±€é…ç½®æ–‡ä»¶`è·¯å¾„`$PREFIX`ï¼š

   ```sh
   npm config get prefix
   ```

   **ã€æ³¨æ„ã€‘å¦‚æœä½ ä¸æ›¾é…ç½®è¿‡å…¨å±€æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶ä¸å­˜åœ¨ã€‚**

4. `npm`å†…ç½®é…ç½®æ–‡ä»¶`/path/to/npm/npmrc`

   æˆ‘ä»¬å¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤ï¼Œè·å–`npmrc`åœ¨`npm`çš„è·¯å¾„ï¼š
   ```sh
   which npm
   ```

   ä¸`npm`åŒçº§åˆ«, ä½¿ç”¨`which npm`è·å–`npm`çš„è·¯å¾„ã€‚

### .npmrcè®¾ç½®çš„å‘½ä»¤è¡Œ

åœ¨è®²è§£å¦‚ä½•è®¾ç½®`.npmrc`ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£è®¾ç½®æ–‡ä»¶çš„å‘½ä»¤è¡Œã€‚

æˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨`key-value`çš„æ–¹å¼æ¥è®¾ç½®æ–‡ä»¶ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```sh
npm config set key value
```

ä¾‹å¦‚ï¼Œè®¾ç½®ä»“åº“ä¿¡æ¯ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹è¿°å‘½ä»¤è¡Œï¼š

```sh
npm config set registry https://repo.huaweicloud.com/repository/npm/
```

### å¦‚ä½•è®¾ç½®.npmrc

1. è®¾ç½®é¡¹ç›®é…ç½®æ–‡ä»¶

   é¡¹ç›®ä¸‹`.npmrc`æ–‡ä»¶çš„ä¼˜å…ˆçº§æœ€é«˜ï¼Œå¯ä»¥ç»™æ¯ä¸ªé¡¹ç›®é…ç½®ä¸åŒçš„é•œåƒï¼Œé¡¹ç›®ä¹‹é—´çš„é…ç½®äº’ä¸å½±å“ã€‚

   åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹æ–°å»º`.npmrc`æ–‡ä»¶ï¼Œåœ¨é‡Œé¢ä»¥`key=value`çš„æ ¼å¼è¿›è¡Œé…ç½®ã€‚

   ```sh
   registry=https://registry.npm.taobao.org
   ```

   ä¹Ÿå¯ä»¥æŒ‡å®šç‰¹æ®Šçš„å‘½åç©ºé—´`ï¼ˆscopeï¼‰`çš„æ¥æºã€‚

   æ¯”å¦‚ï¼Œä»¥`@testNpmRc`å¼€å¤´çš„åŒ…ä»`registry=https://npm.xx.com`è¿™é‡Œä¸‹è½½ï¼Œå…¶ä½™å…¨å»æ·˜å®é•œåƒä¸‹è½½ã€‚

   ```sh
   registry=https://registry.npm.taobao.org/
   @testNpmRc:registry = https://npm.xx.com
   ```

2. è®¾ç½®ç”¨æˆ·é…ç½®æ–‡ä»¶

   å¯ä»¥ç›´æ¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤ï¼š

   ```sh
   npm config get userconfig
   ```

   æ‰¾åˆ°ç”¨æˆ·é…ç½®æ–‡ä»¶çš„è·¯å¾„ï¼Œç›´æ¥ä»¿ç…§ä¸Šè¿°æ–¹æ³•ä¿®æ”¹è¯¥æ–‡ä»¶ã€‚

   å½“ç„¶ï¼Œä¹Ÿå¯ä»¥é€šè¿‡`npm config set`å‘½ä»¤ç»§ç»­è®¾ç½®ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

   ```sh
   npm config set registry https://registry.npm.taobao.org
   ```

   å¦‚æœæƒ³è¦åˆ é™¤ä¸€äº›é…ç½®ï¼Œå¯ä»¥ç›´æ¥ç¼–è¾‘`.npmrc`æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å‘½ä»¤è¿›è¡Œåˆ é™¤ï¼Œä¾‹å¦‚ï¼š

   ```sh
   npm config delete registry
   ```

3. è®¾ç½®å…¨å±€é…ç½®æ–‡ä»¶

   æ–¹æ³•åŒè®¾ç½®ç”¨æˆ·é…ç½®æ–‡ä»¶ä¸€æ ·ï¼Œåªä¸è¿‡åœ¨ä½¿ç”¨å‘½ä»¤è¡Œæ—¶éœ€è¦åŠ ä¸Š`-g`å‚æ•°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

   ```sh
   npm config set registry https://registry.npm.taobao.org -g
   ```

4. ç»™`npm`å‘½ä»¤æ·»åŠ æ³¨å†Œæºé€‰é¡¹

   æ¯”å¦‚ï¼Œä¸´æ—¶ä½¿ç”¨æ·˜å®é•œåƒï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

   ```sh
   npm --registry=https://registry.npm.taobao.org [npmå‘½ä»¤]
   ```

   åˆæ¯”å¦‚ï¼Œä½¿ç”¨`npm`å®‰è£…ä¾èµ–åŒ…ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

   ```sh
   npm install  --registry https://registry.npmjs.org
   ```

   ä½†ä¸æ¨èç”¨è¿™ç§åšæ³•ï¼Œæ›´æ¨èè®¾ç½®é¡¹ç›®é…ç½®æ–‡ä»¶`.npmrc`ã€‚

## é…ç½®å‘å¸ƒç»„ä»¶

`npm`é…ç½®ç»„ä»¶å‘å¸ƒçš„æ–¹å¼æœ‰å¦‚ä¸‹ä¸¤ç§ï¼š

- é€šè¿‡é…ç½®`packege.json`å®ç°
- é€šè¿‡é…ç½®æ–‡ä»¶`.npmrc`å®ç°

1. `package.json`é…ç½®æ–¹å¼

   ```sh
   # @aaæ˜¯ç»„ä»¶çš„scopeã€‚
   # scopeåœ¨æ¨¡å—ånameä¸­ä½¿ç”¨æ—¶ï¼Œä»¥@å¼€å¤´ï¼Œåè¾¹è·Ÿä¸€ä¸ª/
   {
      "name": "@aa/xxx", // å‘å¸ƒnpmåŒ…çš„åå­—
      "version": "1.0.0", // ä½ çš„npmåŒ…ç‰ˆæœ¬
      "description": "xxxx", // åŒ…çš„æè¿°
      "main": "dist/btn.js", // æŒ‡å®šç»„ä»¶çš„ä¸»å…¥å£æ–‡ä»¶
      "publishConfig": {
          "registry": "è¦å‘å¸ƒçš„ç§æœ‰ä»“åº“åœ°å€ï¼Œç„¶ååœ¨.npmrcé…ç½®ç”¨æˆ·åå¯†ç "
      }
      ......
   }
   ```

2. `.npmrc`é…ç½®æ–¹å¼

   ```sh
   # package.jsonä¸åšä»»ä½•ä»“åº“çš„é…ç½®:
   {
      "name": "@aa/xxx", // å‘å¸ƒnpmåŒ…çš„åå­—
      "version": "1.0.0", // ä½ çš„npmåŒ…ç‰ˆæœ¬
      "description": "xxxx", // åŒ…çš„æè¿°
      "main": "dist/btn.js", // æŒ‡å®šç»„ä»¶çš„ä¸»å…¥å£æ–‡ä»¶
      ......
   }
   
   # .npmrcé…ç½®ä»“åº“åœ°å€å’Œç”¨æˆ·åå¯†ç ï¼š
   @aa:registry=ç§ä»“åœ°å€
   ```

   é…ç½®å¥½ä»“åº“ä¿¡æ¯åï¼Œæ‰§è¡Œå¦‚ä¸‹å‘å¸ƒå‘½ä»¤ï¼Œå³å¯å°†æ‰“åŒ…å¥½çš„ç»„ä»¶å‘å¸ƒåˆ°ä»“åº“ä¸­ï¼š

   ```sh
   npm publish
   ```

## npmå¸¸ç”¨å‘½ä»¤

```sh
npm config set <key> <value> [-g|--global]  //ç»™é…ç½®å‚æ•°keyè®¾ç½®å€¼ä¸ºvalueï¼›
npm config get <key>                        //è·å–é…ç½®å‚æ•°keyçš„å€¼ï¼›
npm config delete <key>  [-g|--global]      //åˆ é™¤ç½®å‚æ•°keyåŠå…¶å€¼ï¼›
npm config list [-l]                		//æ˜¾ç¤ºnpmçš„æ‰€æœ‰é…ç½®å‚æ•°çš„ä¿¡æ¯ï¼›
npm config edit                     		//ç¼–è¾‘ç”¨æˆ·é…ç½®æ–‡ä»¶
npm get <key>                           	//è·å–é…ç½®å‚æ•° key ç”Ÿæ•ˆçš„å€¼ï¼›
npm set <key> <value> [-g|--global]         //ç»™é…ç½®å‚æ•°keyè®¾ç½®å€¼ä¸ºvalueï¼›
```

## é‡è¦å¤‡æ³¨

### yarn

`yarn`ä¼šè¯»å–`.npmrc`çš„é…ç½®æ–‡ä»¶ï¼Œæ‰€ä»¥ä¸å¿…ä¸º`yarn`å†è®¾ç½®ä¸€æ¬¡ã€‚

### scopeå‘½åç©ºé—´

ä¸Šæ–‡æåˆ°çš„**æŒ‡å®šç‰¹æ®Šçš„å‘½åç©ºé—´`ï¼ˆscopeï¼‰`çš„æ¥æº**ï¼Œå¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼š

```sh
@aa:registry=https://repo.huaweicloud.com/repository/npm/
```

å…¶ä¸­ï¼Œ`@aa`æ˜¯ç»„ä»¶çš„`scope`ï¼Œ`scope`åœ¨æ¨¡å—å`name`ä¸­ä½¿ç”¨æ—¶ï¼Œä»¥`@`å¼€å¤´ï¼Œæ¯”å¦‚ï¼š

```sh
# åœ¨package.jsonçš„dependenciesæ ‡ç­¾ä¸­åŠ ä¸Šå³å¯ä½¿ç”¨ã€‚
"dependencies": {
    "@test/mypackage": "^1.3.0"
}
```

### é•œåƒå‡ºé”™

`.npmrc`æ–‡ä»¶é…ç½®äº†ç§æœ‰åŒ…`registry`æºï¼Œä½†æ˜¯å½“å‰çš„ä¸‹è½½æºæ˜¯æ·˜å®é•œåƒï¼Œå¯èƒ½ä¼šæŠ¥å¦‚ä¸‹é”™è¯¯ï¼š

```sh
error Command failed with exit code 1
```

å¯ä»¥å°†å½“å‰çš„ä¸‹è½½æºæ”¹æˆç§æœ‰åŒ…`registry`æºï¼Œå¦‚æœæ”¹äº†ä¹‹åè¿˜æŠ¥é”™ï¼Œå¯ä»¥å°è¯•å°†`lock`æ–‡ä»¶ï¼Œæˆ–è€…`node_modules`æ–‡ä»¶åˆ æ‰ï¼Œé‡æ–°å¼€å§‹ä¸‹è½½ã€‚