<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>常用配置 | 小邵子</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/favicon.ico">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/icons/apple-touch-icon-152x152.png">
    <link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#3eaf7c">
    <script charset="utf-8" src="/js/custom.js"></script>
    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?b2140ca1d9ce57e6aac1a7709f5f5fe7";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>
    <meta name="description" content="小邵子的个人笔记">
    <meta name="author" content="小邵子">
    <meta name="keywords" content="张邵,小邵子的 vuepress 个人博客">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
    <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/assets/css/0.styles.9632ee24.css" as="style"><link rel="preload" href="/assets/js/app.66e0de8a.js" as="script"><link rel="preload" href="/assets/js/2.ee595431.js" as="script"><link rel="preload" href="/assets/js/25.09128d23.js" as="script"><link rel="preload" href="/assets/js/105.fedb9703.js" as="script"><link rel="prefetch" href="/assets/js/1.815a1552.js"><link rel="prefetch" href="/assets/js/10.2fbce009.js"><link rel="prefetch" href="/assets/js/100.1d75c27e.js"><link rel="prefetch" href="/assets/js/101.4f0cd700.js"><link rel="prefetch" href="/assets/js/102.4a327172.js"><link rel="prefetch" href="/assets/js/103.9a1fcaa2.js"><link rel="prefetch" href="/assets/js/104.ec4969fd.js"><link rel="prefetch" href="/assets/js/106.7d631800.js"><link rel="prefetch" href="/assets/js/107.7d3cce3a.js"><link rel="prefetch" href="/assets/js/108.4c197874.js"><link rel="prefetch" href="/assets/js/109.933cb0b5.js"><link rel="prefetch" href="/assets/js/11.0d0926f9.js"><link rel="prefetch" href="/assets/js/110.eb03c83d.js"><link rel="prefetch" href="/assets/js/111.05ae3af1.js"><link rel="prefetch" href="/assets/js/112.42223abd.js"><link rel="prefetch" href="/assets/js/113.7826e0e1.js"><link rel="prefetch" href="/assets/js/114.e18c920e.js"><link rel="prefetch" href="/assets/js/115.72934011.js"><link rel="prefetch" href="/assets/js/116.51273e07.js"><link rel="prefetch" href="/assets/js/117.6653e32a.js"><link rel="prefetch" href="/assets/js/118.5341f7bd.js"><link rel="prefetch" href="/assets/js/119.46d569ec.js"><link rel="prefetch" href="/assets/js/12.4eb963e8.js"><link rel="prefetch" href="/assets/js/120.51ef6c06.js"><link rel="prefetch" href="/assets/js/121.3ebb3d93.js"><link rel="prefetch" href="/assets/js/122.2d8d7fb4.js"><link rel="prefetch" href="/assets/js/123.4720579f.js"><link rel="prefetch" href="/assets/js/124.3c6d50d4.js"><link rel="prefetch" href="/assets/js/125.42ebf6ae.js"><link rel="prefetch" href="/assets/js/126.db754a97.js"><link rel="prefetch" href="/assets/js/127.e18de6cb.js"><link rel="prefetch" href="/assets/js/128.423a2dc3.js"><link rel="prefetch" href="/assets/js/129.57bfb2d2.js"><link rel="prefetch" href="/assets/js/13.08e6140f.js"><link rel="prefetch" href="/assets/js/130.843aa71d.js"><link rel="prefetch" href="/assets/js/131.ca6d8788.js"><link rel="prefetch" href="/assets/js/132.9976d008.js"><link rel="prefetch" href="/assets/js/133.6f4281d4.js"><link rel="prefetch" href="/assets/js/134.256aa21a.js"><link rel="prefetch" href="/assets/js/135.22e4fd06.js"><link rel="prefetch" href="/assets/js/136.2b7b1520.js"><link rel="prefetch" href="/assets/js/137.4a4950f6.js"><link rel="prefetch" href="/assets/js/138.7a2692bf.js"><link rel="prefetch" href="/assets/js/139.fc14e760.js"><link rel="prefetch" href="/assets/js/14.50b39202.js"><link rel="prefetch" href="/assets/js/140.b3a3c677.js"><link rel="prefetch" href="/assets/js/141.1e6a9047.js"><link rel="prefetch" href="/assets/js/142.f503956d.js"><link rel="prefetch" href="/assets/js/143.17904ba0.js"><link rel="prefetch" href="/assets/js/144.d90daa2f.js"><link rel="prefetch" href="/assets/js/145.1d5e1d28.js"><link rel="prefetch" href="/assets/js/146.44f94245.js"><link rel="prefetch" href="/assets/js/147.3a466731.js"><link rel="prefetch" href="/assets/js/148.a5e26b8e.js"><link rel="prefetch" href="/assets/js/149.e06a8688.js"><link rel="prefetch" href="/assets/js/15.86b99ddd.js"><link rel="prefetch" href="/assets/js/150.7b1c6693.js"><link rel="prefetch" href="/assets/js/151.27430cc6.js"><link rel="prefetch" href="/assets/js/152.869661e1.js"><link rel="prefetch" href="/assets/js/153.ca7cbfb0.js"><link rel="prefetch" href="/assets/js/154.e1a7e9d1.js"><link rel="prefetch" href="/assets/js/155.e22fd4c3.js"><link rel="prefetch" href="/assets/js/156.aeff53d5.js"><link rel="prefetch" href="/assets/js/157.daf0916c.js"><link rel="prefetch" href="/assets/js/158.b268f9c5.js"><link rel="prefetch" href="/assets/js/159.813570a7.js"><link rel="prefetch" href="/assets/js/16.8688d8ce.js"><link rel="prefetch" href="/assets/js/160.19f2a5bd.js"><link rel="prefetch" href="/assets/js/161.ef0431c9.js"><link rel="prefetch" href="/assets/js/162.ee3c4eeb.js"><link rel="prefetch" href="/assets/js/163.af04fe89.js"><link rel="prefetch" href="/assets/js/164.529861af.js"><link rel="prefetch" href="/assets/js/165.5d008b24.js"><link rel="prefetch" href="/assets/js/166.cb614549.js"><link rel="prefetch" href="/assets/js/167.21a39de0.js"><link rel="prefetch" href="/assets/js/168.28083d8e.js"><link rel="prefetch" href="/assets/js/169.c86b0878.js"><link rel="prefetch" href="/assets/js/17.4b3288fb.js"><link rel="prefetch" href="/assets/js/170.cd838cd6.js"><link rel="prefetch" href="/assets/js/171.1fbf6a4c.js"><link rel="prefetch" href="/assets/js/172.c14b93a6.js"><link rel="prefetch" href="/assets/js/173.a678ad92.js"><link rel="prefetch" href="/assets/js/174.967a9c26.js"><link rel="prefetch" href="/assets/js/175.2f465709.js"><link rel="prefetch" href="/assets/js/176.e8e775d8.js"><link rel="prefetch" href="/assets/js/177.79012cf9.js"><link rel="prefetch" href="/assets/js/178.683e841e.js"><link rel="prefetch" href="/assets/js/179.7bc8af74.js"><link rel="prefetch" href="/assets/js/18.4d34bb5f.js"><link rel="prefetch" href="/assets/js/180.fd2d42ab.js"><link rel="prefetch" href="/assets/js/181.c30c8b33.js"><link rel="prefetch" href="/assets/js/182.4e23e280.js"><link rel="prefetch" href="/assets/js/183.d949110e.js"><link rel="prefetch" href="/assets/js/184.cc8de505.js"><link rel="prefetch" href="/assets/js/185.1ecafb92.js"><link rel="prefetch" href="/assets/js/186.2196045d.js"><link rel="prefetch" href="/assets/js/187.6c3269af.js"><link rel="prefetch" href="/assets/js/188.0db02527.js"><link rel="prefetch" href="/assets/js/189.2ef5fae5.js"><link rel="prefetch" href="/assets/js/19.cf4a0e86.js"><link rel="prefetch" href="/assets/js/190.776f10ac.js"><link rel="prefetch" href="/assets/js/191.f5dcddb7.js"><link rel="prefetch" href="/assets/js/192.70125a36.js"><link rel="prefetch" href="/assets/js/193.5b4f2fb2.js"><link rel="prefetch" href="/assets/js/194.6f613b24.js"><link rel="prefetch" href="/assets/js/195.ce7f60e1.js"><link rel="prefetch" href="/assets/js/196.c03a4853.js"><link rel="prefetch" href="/assets/js/197.200a2520.js"><link rel="prefetch" href="/assets/js/198.4287bbba.js"><link rel="prefetch" href="/assets/js/199.d1dc2212.js"><link rel="prefetch" href="/assets/js/20.e48b43d8.js"><link rel="prefetch" href="/assets/js/200.d5ce1325.js"><link rel="prefetch" href="/assets/js/201.14424fbd.js"><link rel="prefetch" href="/assets/js/202.b63a363b.js"><link rel="prefetch" href="/assets/js/203.e6e4fd53.js"><link rel="prefetch" href="/assets/js/204.ca0abc9a.js"><link rel="prefetch" href="/assets/js/205.8f3d5a94.js"><link rel="prefetch" href="/assets/js/206.81ffd5b8.js"><link rel="prefetch" href="/assets/js/207.d2588519.js"><link rel="prefetch" href="/assets/js/208.b2dc4d1e.js"><link rel="prefetch" href="/assets/js/209.abefd65a.js"><link rel="prefetch" href="/assets/js/21.663f23a6.js"><link rel="prefetch" href="/assets/js/210.6ae59ac3.js"><link rel="prefetch" href="/assets/js/211.8e2ad576.js"><link rel="prefetch" href="/assets/js/212.6b047cf8.js"><link rel="prefetch" href="/assets/js/213.bac0a8df.js"><link rel="prefetch" href="/assets/js/214.881e73f0.js"><link rel="prefetch" href="/assets/js/215.fb0f53ac.js"><link rel="prefetch" href="/assets/js/216.3fb36ac6.js"><link rel="prefetch" href="/assets/js/217.67da825d.js"><link rel="prefetch" href="/assets/js/218.c769f875.js"><link rel="prefetch" href="/assets/js/219.8298c06a.js"><link rel="prefetch" href="/assets/js/22.d8021d57.js"><link rel="prefetch" href="/assets/js/220.aa9de19b.js"><link rel="prefetch" href="/assets/js/221.8e4f1280.js"><link rel="prefetch" href="/assets/js/222.aa5530a1.js"><link rel="prefetch" href="/assets/js/223.404bef4c.js"><link rel="prefetch" href="/assets/js/224.42eba800.js"><link rel="prefetch" href="/assets/js/225.37574a6d.js"><link rel="prefetch" href="/assets/js/226.d62b0824.js"><link rel="prefetch" href="/assets/js/227.0e91b4be.js"><link rel="prefetch" href="/assets/js/228.88839e5a.js"><link rel="prefetch" href="/assets/js/229.6522a422.js"><link rel="prefetch" href="/assets/js/23.a3317993.js"><link rel="prefetch" href="/assets/js/230.33efc563.js"><link rel="prefetch" href="/assets/js/231.23bb0089.js"><link rel="prefetch" href="/assets/js/232.2ced61fe.js"><link rel="prefetch" href="/assets/js/233.f5fd34db.js"><link rel="prefetch" href="/assets/js/234.6f508d99.js"><link rel="prefetch" href="/assets/js/235.1160885c.js"><link rel="prefetch" href="/assets/js/236.166ef3f7.js"><link rel="prefetch" href="/assets/js/237.07d95d31.js"><link rel="prefetch" href="/assets/js/238.10309f0d.js"><link rel="prefetch" href="/assets/js/239.e5df59a6.js"><link rel="prefetch" href="/assets/js/24.bc09e779.js"><link rel="prefetch" href="/assets/js/240.20cb4210.js"><link rel="prefetch" href="/assets/js/241.0f262f52.js"><link rel="prefetch" href="/assets/js/242.6af7336e.js"><link rel="prefetch" href="/assets/js/243.d0f2d115.js"><link rel="prefetch" href="/assets/js/244.c9bb760f.js"><link rel="prefetch" href="/assets/js/245.88d33b98.js"><link rel="prefetch" href="/assets/js/246.5f47e31c.js"><link rel="prefetch" href="/assets/js/247.27f154f6.js"><link rel="prefetch" href="/assets/js/248.9f6735e1.js"><link rel="prefetch" href="/assets/js/249.3696b20f.js"><link rel="prefetch" href="/assets/js/250.8b93841b.js"><link rel="prefetch" href="/assets/js/251.bb806d22.js"><link rel="prefetch" href="/assets/js/252.781c6ad8.js"><link rel="prefetch" href="/assets/js/253.b088868c.js"><link rel="prefetch" href="/assets/js/254.047dc537.js"><link rel="prefetch" href="/assets/js/255.35bc02f7.js"><link rel="prefetch" href="/assets/js/256.daafa6d8.js"><link rel="prefetch" href="/assets/js/257.92b01cf2.js"><link rel="prefetch" href="/assets/js/258.aae43972.js"><link rel="prefetch" href="/assets/js/259.ca61093f.js"><link rel="prefetch" href="/assets/js/26.e059cccb.js"><link rel="prefetch" href="/assets/js/260.63ac1ee7.js"><link rel="prefetch" href="/assets/js/261.98d8e9f5.js"><link rel="prefetch" href="/assets/js/262.584ca7ab.js"><link rel="prefetch" href="/assets/js/263.46b91af7.js"><link rel="prefetch" href="/assets/js/264.9e63e624.js"><link rel="prefetch" href="/assets/js/265.501bd616.js"><link rel="prefetch" href="/assets/js/266.150770e8.js"><link rel="prefetch" href="/assets/js/267.259d59b7.js"><link rel="prefetch" href="/assets/js/268.7e524150.js"><link rel="prefetch" href="/assets/js/269.66f93453.js"><link rel="prefetch" href="/assets/js/27.288daea6.js"><link rel="prefetch" href="/assets/js/270.7a5287e4.js"><link rel="prefetch" href="/assets/js/271.22f76540.js"><link rel="prefetch" href="/assets/js/272.2e0c1a55.js"><link rel="prefetch" href="/assets/js/273.456ac818.js"><link rel="prefetch" href="/assets/js/28.766460ff.js"><link rel="prefetch" href="/assets/js/29.84d544e0.js"><link rel="prefetch" href="/assets/js/3.2f95aea3.js"><link rel="prefetch" href="/assets/js/30.f82a7742.js"><link rel="prefetch" href="/assets/js/31.cfd60858.js"><link rel="prefetch" href="/assets/js/32.14bfa4f7.js"><link rel="prefetch" href="/assets/js/33.3fc0bc63.js"><link rel="prefetch" href="/assets/js/34.da2c8ecc.js"><link rel="prefetch" href="/assets/js/35.73bdf190.js"><link rel="prefetch" href="/assets/js/36.d32ff376.js"><link rel="prefetch" href="/assets/js/37.ba57db65.js"><link rel="prefetch" href="/assets/js/38.e121b1f1.js"><link rel="prefetch" href="/assets/js/39.a9b73168.js"><link rel="prefetch" href="/assets/js/4.2332fa3d.js"><link rel="prefetch" href="/assets/js/40.ecd424f5.js"><link rel="prefetch" href="/assets/js/41.c5527d67.js"><link rel="prefetch" href="/assets/js/42.5cefe11c.js"><link rel="prefetch" href="/assets/js/43.9040f9da.js"><link rel="prefetch" href="/assets/js/44.709970bd.js"><link rel="prefetch" href="/assets/js/45.c72a34d2.js"><link rel="prefetch" href="/assets/js/46.7d856d40.js"><link rel="prefetch" href="/assets/js/47.af5594ac.js"><link rel="prefetch" href="/assets/js/48.c373d162.js"><link rel="prefetch" href="/assets/js/49.c26c0bb3.js"><link rel="prefetch" href="/assets/js/5.d9a2a0e0.js"><link rel="prefetch" href="/assets/js/50.83703741.js"><link rel="prefetch" href="/assets/js/51.56c8f3ef.js"><link rel="prefetch" href="/assets/js/52.1421a172.js"><link rel="prefetch" href="/assets/js/53.7a73121f.js"><link rel="prefetch" href="/assets/js/54.e801fd18.js"><link rel="prefetch" href="/assets/js/55.b262f818.js"><link rel="prefetch" href="/assets/js/56.69b77293.js"><link rel="prefetch" href="/assets/js/57.67d41610.js"><link rel="prefetch" href="/assets/js/58.d97f631c.js"><link rel="prefetch" href="/assets/js/59.6ebd54e1.js"><link rel="prefetch" href="/assets/js/6.6fded4f7.js"><link rel="prefetch" href="/assets/js/60.ab01a719.js"><link rel="prefetch" href="/assets/js/61.1962b7c5.js"><link rel="prefetch" href="/assets/js/62.5d1e8678.js"><link rel="prefetch" href="/assets/js/63.eb393235.js"><link rel="prefetch" href="/assets/js/64.35804e94.js"><link rel="prefetch" href="/assets/js/65.8d885ab8.js"><link rel="prefetch" href="/assets/js/66.9e40a5a0.js"><link rel="prefetch" href="/assets/js/67.0fe63a3a.js"><link rel="prefetch" href="/assets/js/68.7f406b49.js"><link rel="prefetch" href="/assets/js/69.c1b11423.js"><link rel="prefetch" href="/assets/js/7.cfc0e615.js"><link rel="prefetch" href="/assets/js/70.678ed459.js"><link rel="prefetch" href="/assets/js/71.5baa035e.js"><link rel="prefetch" href="/assets/js/72.15978ceb.js"><link rel="prefetch" href="/assets/js/73.3f2ad3b2.js"><link rel="prefetch" href="/assets/js/74.de7cf9be.js"><link rel="prefetch" href="/assets/js/75.64e14a8d.js"><link rel="prefetch" href="/assets/js/76.197b409c.js"><link rel="prefetch" href="/assets/js/77.99803e0e.js"><link rel="prefetch" href="/assets/js/78.f7750872.js"><link rel="prefetch" href="/assets/js/79.bc6f748d.js"><link rel="prefetch" href="/assets/js/80.736bed23.js"><link rel="prefetch" href="/assets/js/81.286e52f0.js"><link rel="prefetch" href="/assets/js/82.1ddaf942.js"><link rel="prefetch" href="/assets/js/83.a292690c.js"><link rel="prefetch" href="/assets/js/84.4dc6838a.js"><link rel="prefetch" href="/assets/js/85.b6f9503d.js"><link rel="prefetch" href="/assets/js/86.52f9c173.js"><link rel="prefetch" href="/assets/js/87.a38b8097.js"><link rel="prefetch" href="/assets/js/88.d2cc7e7c.js"><link rel="prefetch" href="/assets/js/89.ca2ab6ae.js"><link rel="prefetch" href="/assets/js/90.51767088.js"><link rel="prefetch" href="/assets/js/91.d477ea17.js"><link rel="prefetch" href="/assets/js/92.4d57d64b.js"><link rel="prefetch" href="/assets/js/93.03888158.js"><link rel="prefetch" href="/assets/js/94.90afb712.js"><link rel="prefetch" href="/assets/js/95.02d0ec2f.js"><link rel="prefetch" href="/assets/js/96.12dd58d1.js"><link rel="prefetch" href="/assets/js/97.1b001235.js"><link rel="prefetch" href="/assets/js/98.26307936.js"><link rel="prefetch" href="/assets/js/99.3b58ef51.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.69b98308.js">
    <link rel="stylesheet" href="/assets/css/0.styles.9632ee24.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">小邵子</span></a> <div class="links"><!----> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="linux" class="dropdown-title"><span class="title">linux</span> <span class="arrow down"></span></button> <button type="button" aria-label="linux" class="mobile-dropdown-title"><span class="title">linux</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/zs-use/linux/基本使用/" class="nav-link">
  基本使用
</a></li><li class="dropdown-item"><!----> <a href="/zs-use/linux/常见问题/" class="nav-link">
  常见问题
</a></li><li class="dropdown-item"><!----> <a href="/zs-use/linux/shell编程/" class="nav-link">
  shell编程
</a></li><li class="dropdown-item"><!----> <a href="/zs-use/linux/虚拟化/" class="nav-link">
  虚拟化
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="中间件" class="dropdown-title"><span class="title">中间件</span> <span class="arrow down"></span></button> <button type="button" aria-label="中间件" class="mobile-dropdown-title"><span class="title">中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/中间件/docker/" class="nav-link">
  docker
</a></li><li class="dropdown-item"><!----> <a href="/中间件/nginx/" class="nav-link">
  nginx
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="小工具" class="dropdown-title"><span class="title">小工具</span> <span class="arrow down"></span></button> <button type="button" aria-label="小工具" class="mobile-dropdown-title"><span class="title">小工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/小工具/axure/" class="nav-link">
  axure
</a></li><li class="dropdown-item"><!----> <a href="/小工具/cygwin/" class="nav-link">
  cygwin
</a></li><li class="dropdown-item"><!----> <a href="/小工具/markmap/" class="nav-link">
  markmap
</a></li><li class="dropdown-item"><!----> <a href="/小工具/html2md/" class="nav-link">
  html2md
</a></li><li class="dropdown-item"><!----> <a href="/小工具/markdown/" class="nav-link">
  markdown
</a></li><li class="dropdown-item"><!----> <a href="/小工具/codeAi/" class="nav-link">
  codeAi
</a></li><li class="dropdown-item"><!----> <a href="/小工具/ppt/图形绘制.html" class="nav-link">
  ppt
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="大工具" class="dropdown-title"><span class="title">大工具</span> <span class="arrow down"></span></button> <button type="button" aria-label="大工具" class="mobile-dropdown-title"><span class="title">大工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/大工具/git/常用命令.html" class="nav-link">
  git
</a></li><li class="dropdown-item"><!----> <a href="/大工具/idea/" class="nav-link">
  idea
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="小需求" class="dropdown-title"><span class="title">小需求</span> <span class="arrow down"></span></button> <button type="button" aria-label="小需求" class="mobile-dropdown-title"><span class="title">小需求</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/小需求/js/js-分组.html" class="nav-link">
  js
</a></li><li class="dropdown-item"><!----> <a href="/小需求/html/video-播放视频.html" class="nav-link">
  html
</a></li><li class="dropdown-item"><!----> <a href="/小需求/iframe/iframe-自适应高度.html" class="nav-link">
  iframe
</a></li><li class="dropdown-item"><!----> <a href="/小需求/css/撑开高度.html" class="nav-link">
  css
</a></li><li class="dropdown-item"><!----> <a href="/小需求/java/ip获取.html" class="nav-link">
  java
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="web" class="dropdown-title"><span class="title">web</span> <span class="arrow down"></span></button> <button type="button" aria-label="web" class="mobile-dropdown-title"><span class="title">web</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/web/js/JSON-stringify函数.html" class="nav-link">
  js
</a></li><li class="dropdown-item"><!----> <a href="/web/iframe/iframe-简单使用.html" class="nav-link">
  iframe
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="小框架" class="dropdown-title"><span class="title">小框架</span> <span class="arrow down"></span></button> <button type="button" aria-label="小框架" class="mobile-dropdown-title"><span class="title">小框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/小框架/kkfileview/" class="nav-link">
  kkFileView
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="杂谈" class="dropdown-title"><span class="title">杂谈</span> <span class="arrow down"></span></button> <button type="button" aria-label="杂谈" class="mobile-dropdown-title"><span class="title">杂谈</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/杂谈/cpu/" class="nav-link">
  cpu
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="zs-se" class="dropdown-title"><span class="title">zs-se</span> <span class="arrow down"></span></button> <button type="button" aria-label="zs-se" class="mobile-dropdown-title"><span class="title">zs-se</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/zs-se/基础/" class="nav-link">
  基础
</a></li><li class="dropdown-item"><!----> <a href="/zs-se/设计模式/" class="nav-link">
  设计模式
</a></li><li class="dropdown-item"><!----> <a href="/zs-se/io/" class="nav-link">
  io
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="zs-ee-框架" class="dropdown-title"><span class="title">zs-ee-框架</span> <span class="arrow down"></span></button> <button type="button" aria-label="zs-ee-框架" class="mobile-dropdown-title"><span class="title">zs-ee-框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/zs-ee-框架/mybatis-plus/" class="nav-link">
  mybatis-plus
</a></li><li class="dropdown-item"><!----> <a href="/zs-ee-框架/spring/" class="nav-link">
  spring
</a></li><li class="dropdown-item"><!----> <a href="/zs-ee-框架/cloud-gateway/" class="nav-link">
  cloud-gateway
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="zs-tool-小结" class="dropdown-title"><span class="title">zs-tool-小结</span> <span class="arrow down"></span></button> <button type="button" aria-label="zs-tool-小结" class="mobile-dropdown-title"><span class="title">zs-tool-小结</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/zs-tool-小结/面经手册/面试--0.开篇.html" class="nav-link">
  面经手册
</a></li><li class="dropdown-item"><!----> <a href="/zs-tool-小结/网址收藏/实用网站.html" class="nav-link">
  网址收藏
</a></li><li class="dropdown-item"><!----> <a href="/zs-tool-小结/文件/" class="nav-link">
  文件
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="zs-tool-框架" class="dropdown-title"><span class="title">zs-tool-框架</span> <span class="arrow down"></span></button> <button type="button" aria-label="zs-tool-框架" class="mobile-dropdown-title"><span class="title">zs-tool-框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/zs-tool-框架/vuepress/" class="nav-link">
  Vuepress
</a></li><li class="dropdown-item"><!----> <a href="/zs-tool-框架/java报表/" class="nav-link">
  java报表
</a></li><li class="dropdown-item"><!----> <a href="/zs-tool-框架/消息推送/消息推送技术方案.html" class="nav-link">
  消息推送
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="zs-use" class="dropdown-title"><span class="title">zs-use</span> <span class="arrow down"></span></button> <button type="button" aria-label="zs-use" class="mobile-dropdown-title"><span class="title">zs-use</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Linux
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/zs-use/linux/基本使用/" class="nav-link">
  基本使用
</a></li><li class="dropdown-subitem"><a href="/zs-use/linux/常见问题/" class="nav-link">
  常见问题
</a></li><li class="dropdown-subitem"><a href="/zs-use/linux/shell编程/" class="nav-link">
  shell编程
</a></li><li class="dropdown-subitem"><a href="/zs-use/linux/虚拟化/" class="nav-link">
  虚拟化
</a></li></ul></li><li class="dropdown-item"><!----> <a href="/zs-use/idea/" class="nav-link">
  IDEA
</a></li><li class="dropdown-item"><!----> <a href="/zs-use/git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/zs-use/env/" class="nav-link">
  env
</a></li><li class="dropdown-item"><!----> <a href="/zs-use/maven/自定义archetype-01.html" class="nav-link">
  maven
</a></li><li class="dropdown-item"><!----> <a href="/zs-use/下载视频/下载器.html" class="nav-link">
  下载视频
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="zs-web" class="dropdown-title"><span class="title">zs-web</span> <span class="arrow down"></span></button> <button type="button" aria-label="zs-web" class="mobile-dropdown-title"><span class="title">zs-web</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/zs-web/tool-小结/" class="nav-link">
  tool-小结
</a></li><li class="dropdown-item"><!----> <a href="/zs-web/project/html/" class="nav-link">
  project
</a></li><li class="dropdown-item"><!----> <a href="/zs-web/node/nvm--安装.html" class="nav-link">
  node
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="zs-project" class="dropdown-title"><span class="title">zs-project</span> <span class="arrow down"></span></button> <button type="button" aria-label="zs-project" class="mobile-dropdown-title"><span class="title">zs-project</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/zs-project/mallchat/" class="nav-link">
  mallchat
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="linux" class="dropdown-title"><span class="title">linux</span> <span class="arrow down"></span></button> <button type="button" aria-label="linux" class="mobile-dropdown-title"><span class="title">linux</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/zs-use/linux/基本使用/" class="nav-link">
  基本使用
</a></li><li class="dropdown-item"><!----> <a href="/zs-use/linux/常见问题/" class="nav-link">
  常见问题
</a></li><li class="dropdown-item"><!----> <a href="/zs-use/linux/shell编程/" class="nav-link">
  shell编程
</a></li><li class="dropdown-item"><!----> <a href="/zs-use/linux/虚拟化/" class="nav-link">
  虚拟化
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="中间件" class="dropdown-title"><span class="title">中间件</span> <span class="arrow down"></span></button> <button type="button" aria-label="中间件" class="mobile-dropdown-title"><span class="title">中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/中间件/docker/" class="nav-link">
  docker
</a></li><li class="dropdown-item"><!----> <a href="/中间件/nginx/" class="nav-link">
  nginx
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="小工具" class="dropdown-title"><span class="title">小工具</span> <span class="arrow down"></span></button> <button type="button" aria-label="小工具" class="mobile-dropdown-title"><span class="title">小工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/小工具/axure/" class="nav-link">
  axure
</a></li><li class="dropdown-item"><!----> <a href="/小工具/cygwin/" class="nav-link">
  cygwin
</a></li><li class="dropdown-item"><!----> <a href="/小工具/markmap/" class="nav-link">
  markmap
</a></li><li class="dropdown-item"><!----> <a href="/小工具/html2md/" class="nav-link">
  html2md
</a></li><li class="dropdown-item"><!----> <a href="/小工具/markdown/" class="nav-link">
  markdown
</a></li><li class="dropdown-item"><!----> <a href="/小工具/codeAi/" class="nav-link">
  codeAi
</a></li><li class="dropdown-item"><!----> <a href="/小工具/ppt/图形绘制.html" class="nav-link">
  ppt
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="大工具" class="dropdown-title"><span class="title">大工具</span> <span class="arrow down"></span></button> <button type="button" aria-label="大工具" class="mobile-dropdown-title"><span class="title">大工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/大工具/git/常用命令.html" class="nav-link">
  git
</a></li><li class="dropdown-item"><!----> <a href="/大工具/idea/" class="nav-link">
  idea
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="小需求" class="dropdown-title"><span class="title">小需求</span> <span class="arrow down"></span></button> <button type="button" aria-label="小需求" class="mobile-dropdown-title"><span class="title">小需求</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/小需求/js/js-分组.html" class="nav-link">
  js
</a></li><li class="dropdown-item"><!----> <a href="/小需求/html/video-播放视频.html" class="nav-link">
  html
</a></li><li class="dropdown-item"><!----> <a href="/小需求/iframe/iframe-自适应高度.html" class="nav-link">
  iframe
</a></li><li class="dropdown-item"><!----> <a href="/小需求/css/撑开高度.html" class="nav-link">
  css
</a></li><li class="dropdown-item"><!----> <a href="/小需求/java/ip获取.html" class="nav-link">
  java
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="web" class="dropdown-title"><span class="title">web</span> <span class="arrow down"></span></button> <button type="button" aria-label="web" class="mobile-dropdown-title"><span class="title">web</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/web/js/JSON-stringify函数.html" class="nav-link">
  js
</a></li><li class="dropdown-item"><!----> <a href="/web/iframe/iframe-简单使用.html" class="nav-link">
  iframe
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="小框架" class="dropdown-title"><span class="title">小框架</span> <span class="arrow down"></span></button> <button type="button" aria-label="小框架" class="mobile-dropdown-title"><span class="title">小框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/小框架/kkfileview/" class="nav-link">
  kkFileView
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="杂谈" class="dropdown-title"><span class="title">杂谈</span> <span class="arrow down"></span></button> <button type="button" aria-label="杂谈" class="mobile-dropdown-title"><span class="title">杂谈</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/杂谈/cpu/" class="nav-link">
  cpu
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="zs-se" class="dropdown-title"><span class="title">zs-se</span> <span class="arrow down"></span></button> <button type="button" aria-label="zs-se" class="mobile-dropdown-title"><span class="title">zs-se</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/zs-se/基础/" class="nav-link">
  基础
</a></li><li class="dropdown-item"><!----> <a href="/zs-se/设计模式/" class="nav-link">
  设计模式
</a></li><li class="dropdown-item"><!----> <a href="/zs-se/io/" class="nav-link">
  io
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="zs-ee-框架" class="dropdown-title"><span class="title">zs-ee-框架</span> <span class="arrow down"></span></button> <button type="button" aria-label="zs-ee-框架" class="mobile-dropdown-title"><span class="title">zs-ee-框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/zs-ee-框架/mybatis-plus/" class="nav-link">
  mybatis-plus
</a></li><li class="dropdown-item"><!----> <a href="/zs-ee-框架/spring/" class="nav-link">
  spring
</a></li><li class="dropdown-item"><!----> <a href="/zs-ee-框架/cloud-gateway/" class="nav-link">
  cloud-gateway
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="zs-tool-小结" class="dropdown-title"><span class="title">zs-tool-小结</span> <span class="arrow down"></span></button> <button type="button" aria-label="zs-tool-小结" class="mobile-dropdown-title"><span class="title">zs-tool-小结</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/zs-tool-小结/面经手册/面试--0.开篇.html" class="nav-link">
  面经手册
</a></li><li class="dropdown-item"><!----> <a href="/zs-tool-小结/网址收藏/实用网站.html" class="nav-link">
  网址收藏
</a></li><li class="dropdown-item"><!----> <a href="/zs-tool-小结/文件/" class="nav-link">
  文件
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="zs-tool-框架" class="dropdown-title"><span class="title">zs-tool-框架</span> <span class="arrow down"></span></button> <button type="button" aria-label="zs-tool-框架" class="mobile-dropdown-title"><span class="title">zs-tool-框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/zs-tool-框架/vuepress/" class="nav-link">
  Vuepress
</a></li><li class="dropdown-item"><!----> <a href="/zs-tool-框架/java报表/" class="nav-link">
  java报表
</a></li><li class="dropdown-item"><!----> <a href="/zs-tool-框架/消息推送/消息推送技术方案.html" class="nav-link">
  消息推送
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="zs-use" class="dropdown-title"><span class="title">zs-use</span> <span class="arrow down"></span></button> <button type="button" aria-label="zs-use" class="mobile-dropdown-title"><span class="title">zs-use</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Linux
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/zs-use/linux/基本使用/" class="nav-link">
  基本使用
</a></li><li class="dropdown-subitem"><a href="/zs-use/linux/常见问题/" class="nav-link">
  常见问题
</a></li><li class="dropdown-subitem"><a href="/zs-use/linux/shell编程/" class="nav-link">
  shell编程
</a></li><li class="dropdown-subitem"><a href="/zs-use/linux/虚拟化/" class="nav-link">
  虚拟化
</a></li></ul></li><li class="dropdown-item"><!----> <a href="/zs-use/idea/" class="nav-link">
  IDEA
</a></li><li class="dropdown-item"><!----> <a href="/zs-use/git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/zs-use/env/" class="nav-link">
  env
</a></li><li class="dropdown-item"><!----> <a href="/zs-use/maven/自定义archetype-01.html" class="nav-link">
  maven
</a></li><li class="dropdown-item"><!----> <a href="/zs-use/下载视频/下载器.html" class="nav-link">
  下载视频
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="zs-web" class="dropdown-title"><span class="title">zs-web</span> <span class="arrow down"></span></button> <button type="button" aria-label="zs-web" class="mobile-dropdown-title"><span class="title">zs-web</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/zs-web/tool-小结/" class="nav-link">
  tool-小结
</a></li><li class="dropdown-item"><!----> <a href="/zs-web/project/html/" class="nav-link">
  project
</a></li><li class="dropdown-item"><!----> <a href="/zs-web/node/nvm--安装.html" class="nav-link">
  node
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="zs-project" class="dropdown-title"><span class="title">zs-project</span> <span class="arrow down"></span></button> <button type="button" aria-label="zs-project" class="mobile-dropdown-title"><span class="title">zs-project</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/zs-project/mallchat/" class="nav-link">
  mallchat
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Nginx</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/nginx/" aria-current="page" class="active sidebar-link">常用配置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/nginx/#下载安装" class="sidebar-link">下载安装</a></li><li class="sidebar-sub-header"><a href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/nginx/#一、web服务器" class="sidebar-link">一、Web服务器</a></li><li class="sidebar-sub-header"><a href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/nginx/#二、反向代理" class="sidebar-link">二、反向代理</a></li><li class="sidebar-sub-header"><a href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/nginx/#三、负载均衡" class="sidebar-link">三、负载均衡</a></li><li class="sidebar-sub-header"><a href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/nginx/#四、url重定向" class="sidebar-link">四、URL重定向</a></li><li class="sidebar-sub-header"><a href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/nginx/#五、防盗链" class="sidebar-link">五、防盗链</a></li><li class="sidebar-sub-header"><a href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/nginx/#六、手机端重定向pc端" class="sidebar-link">六、手机端重定向PC端</a></li><li class="sidebar-sub-header"><a href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/nginx/#七、基于请求路径转发不同服务" class="sidebar-link">七、基于请求路径转发不同服务</a></li><li class="sidebar-sub-header"><a href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/nginx/#四、url重定向-2" class="sidebar-link">四、URL重定向</a></li><li class="sidebar-sub-header"><a href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/nginx/#五、防盗链-2" class="sidebar-link">五、防盗链</a></li><li class="sidebar-sub-header"><a href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/nginx/#六、手机端重定向pc端-2" class="sidebar-link">六、手机端重定向PC端</a></li><li class="sidebar-sub-header"><a href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/nginx/#七、基于请求路径转发不同服务-2" class="sidebar-link">七、基于请求路径转发不同服务</a></li><li class="sidebar-sub-header"><a href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/nginx/#八、目录索引" class="sidebar-link">八、目录索引</a></li><li class="sidebar-sub-header"><a href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/nginx/#九、nginx状态监控-了解" class="sidebar-link">九、Nginx状态监控（了解）</a></li><li class="sidebar-sub-header"><a href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/nginx/#十、nginx访问控制" class="sidebar-link">十、Nginx访问控制</a></li><li class="sidebar-sub-header"><a href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/nginx/#十一、nginx访问限制" class="sidebar-link">十一、Nginx访问限制</a></li><li class="sidebar-sub-header"><a href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/nginx/#nginx-location" class="sidebar-link">Nginx Location</a></li><li class="sidebar-sub-header"><a href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/nginx/#nginx日志" class="sidebar-link">Nginx日志</a></li><li class="sidebar-sub-header"><a href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/nginx/#nginx虚拟主机" class="sidebar-link">Nginx虚拟主机</a></li><li class="sidebar-sub-header"><a href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/nginx/#版本暴露问题" class="sidebar-link">版本暴露问题</a></li><li class="sidebar-sub-header"><a href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/nginx/#ws代理" class="sidebar-link">ws代理</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="常用配置"><a href="#常用配置" class="header-anchor">#</a> 常用配置</h1> <p>https://www.digitalocean.com/community/tools/nginx?global.app.lang=zhCN</p> <p>Nginx，一个高性能的 HTTP 和 反向代理 web 服务器，同时也提供了IMAP/POP3/SMTP 等服务。</p> <p>相对于 Apache 服务器，Nginx 更轻量、更适于高并发场景，单机就能够支持高达 5w 个并发连接数，常用于作为接入层网关，用于负载均衡，分摊用户的请求。</p> <p><img src="/assets/img/image-20240330093426469.b2748bc7.png" alt="image-20240330093426469"></p> <h2 id="下载安装"><a href="#下载安装" class="header-anchor">#</a> 下载安装</h2> <p>先下载直接去官网<a href="https://www.cnblogs.com/taiyonghai/p/nginx.org" target="_blank" rel="noopener noreferrer">nginx.org<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><img src="/assets/img/172889-20180801175638428-284207143.11131068.png" alt="img"></p> <h2 id="一、web服务器"><a href="#一、web服务器" class="header-anchor">#</a> 一、Web服务器</h2> <img src="/assets/img/image-20240330094849885.becb823a.png" alt="image-20240330094849885" style="zoom:50%;"> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span>	<span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span>	_</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">root</span>	/data/wwwroot</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">index</span>	index.html index.htm</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span>	<span class="token number">443</span>	ssl</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span>	_</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">ssl_certificate</span>	/path/to/certificate.crt</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">ssl_certificate_key</span>	/path/to/private-key.key</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">root</span>	/data/wwwroot</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">index</span>	index.html index.htm</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="二、反向代理"><a href="#二、反向代理" class="header-anchor">#</a> 二、反向代理</h2> <h3 id="http代理"><a href="#http代理" class="header-anchor">#</a> http代理</h3> <img src="/assets/img/image-20240330094918086-1725325898326-1.1872c9ab.png" alt="image-20240330094918086" style="zoom:50%;"> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span><span class="token punctuation">{</span>
	<span class="token directive"><span class="token keyword">listen</span>	<span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span>	_</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">proxy_pass</span> http://192.168.1.100</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_set_header</span> Host <span class="token variable">$host</span></span><span class="token punctuation">;</span>
        <span class="token comment"># 域名和访问IP传递</span>
        <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Real-IP <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span>     		<span class="token number">443</span> ssl</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span>  	localhost</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">ssl_dhparam</span>          /etc/nginx/ssl/dhparam.pem</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">ssl_certificate</span>      /etc/nginx/ssl/server.crt</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">ssl_certificate_key</span>  /etc/nginx/ssl/server.key</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">ssl_session_cache</span> 	shared:SSL:1m</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">ssl_session_timeout</span>  <span class="token number">4h</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">ssl_session_tickets</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">ssl_protocols</span> TLSv1.2</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">ssl_prefer_server_ciphers</span>  <span class="token boolean">on</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">client_max_body_size</span> <span class="token number">0</span></span><span class="token punctuation">;</span>	
	<span class="token comment"># 前端页面</span>
    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">autoindex</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_set_header</span> REMOTE-HOST <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Real-IP <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Forwarded-Proto <span class="token variable">$scheme</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_set_header</span> Host <span class="token variable">$http_host</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Forwarded-For <span class="token variable">$proxy_add_x_forwarded_for</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_pass</span> http://127.0.0.1:18002/</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="tcp代理"><a href="#tcp代理" class="header-anchor">#</a> TCP代理</h3> <p>Nginx从<code>1.9.0</code>开始，新增加了一个<code>stream</code>模块，用来实现四层协议的转发、代理或者<a href="https://cloud.tencent.com/product/clb?from_column=20065&amp;from=20065" target="_blank" rel="noopener noreferrer">负载均衡<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>等。</p> <p>也就是说Nginx本来只支持HTTP，添加stream模块后就支持TCP/UDP了。</p> <p>查看是否添加该模块<code>nginx -V</code></p> <p>搜索是否包含<code>--with-stream</code>,如果包含则已添加过此模块。</p> <p>假如Nginx的公网IP为<code>110.119.120.121</code>,Mysql所在的同一个内网的内网IP为<code>192.168.1.20</code></p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token comment">#stream配置</span>
<span class="token directive"><span class="token keyword">stream</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
       <span class="token directive"><span class="token keyword">listen</span> <span class="token number">13306</span></span><span class="token punctuation">;</span> 
       <span class="token directive"><span class="token keyword">proxy_connect_timeout</span> <span class="token number">1s</span></span><span class="token punctuation">;</span>
       <span class="token directive"><span class="token keyword">proxy_timeout</span> <span class="token number">3s</span></span><span class="token punctuation">;</span>
       <span class="token directive"><span class="token keyword">proxy_pass</span> 192.168.1.20:3306</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token directive"><span class="token keyword">http</span></span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这样我们就能通过<code>110.119.120.121:13306</code>访问到Mysql服务了。</p> <p>注意</p> <ol><li>stream配置项和http同级。</li> <li>不支持不同域名转发不同Mysql的功能。</li></ol> <p>这样做的好处</p> <ul><li>避免<a href="https://cloud.tencent.com/product/dbexpert?from_column=20065&amp;from=20065" target="_blank" rel="noopener noreferrer">数据库服务<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>器直接暴漏在公网</li> <li>方便<a href="https://cloud.tencent.com/solution/database?from_column=20065&amp;from=20065" target="_blank" rel="noopener noreferrer">数据库<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>秒级切换</li></ul> <h3 id="udp负载均衡"><a href="#udp负载均衡" class="header-anchor">#</a> UDP负载均衡</h3> <p>下面就是UDP负载均衡的示例</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token comment">#user  nobody;</span>
<span class="token directive"><span class="token keyword">worker_processes</span>  <span class="token number">1</span></span><span class="token punctuation">;</span>

<span class="token comment">#error_log  logs/error.log;</span>
<span class="token comment">#error_log  logs/error.log  notice;</span>
<span class="token comment">#error_log  logs/error.log  info;</span>

<span class="token comment">#pid        logs/nginx.pid;</span>

<span class="token directive"><span class="token keyword">events</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">worker_connections</span>  <span class="token number">1024</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token directive"><span class="token keyword">stream</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">upstream</span> dns</span> <span class="token punctuation">{</span>
       <span class="token directive"><span class="token keyword">server</span> 192.168.111.99:10086</span><span class="token punctuation">;</span>
       <span class="token directive"><span class="token keyword">server</span> 192.168.111.100:10086</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">listen</span> 192.168.111.98:10086 udp</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_responses</span> <span class="token number">1</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_timeout</span> <span class="token number">20s</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_bind</span> <span class="token variable">$server_addr:</span><span class="token variable">$remote_port</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_pass</span> dns</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="stream语法"><a href="#stream语法" class="header-anchor">#</a> stream语法</h3> <p><code>stream</code>:该指令定义了stream服务器。与http块平级，定义在main块中。</p> <ul><li>作用域：main</li> <li>语法：stream {...}</li></ul> <p><code>server</code>:该指令定义一个虚拟主机，与http块中的server类似。我们可以在stream块中定义多个server块。</p> <ul><li>作用域：stream</li> <li>语法：server {...}</li></ul> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">stream</span></span> <span class="token punctuation">{</span>
     <span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
         ......
     <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
</code></pre></div><p><code>listen</code>:该指令定义虚拟主机server要监听的socket的地址和端口。</p> <ul><li>作用域：server</li> <li>语法：listen address:port;</li></ul> <div class="language-nginx extra-class"><pre class="language-nginx"><code> <span class="token directive"><span class="token keyword">listen</span> 127.0.0.1:3306</span><span class="token punctuation">;</span>
 <span class="token directive"><span class="token keyword">listen</span> *:3306</span><span class="token punctuation">;</span>
 <span class="token comment"># 效果与listen *:3306一样</span>
 <span class="token directive"><span class="token keyword">listen</span> <span class="token number">3306</span></span><span class="token punctuation">;</span>
 <span class="token directive"><span class="token keyword">listen</span> localhost:3306</span><span class="token punctuation">;</span>
</code></pre></div><p>配置示例</p> <p>MySQL服务器，端口3306（单机环境）</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">stream</span></span>  <span class="token punctuation">{</span>
     <span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
         <span class="token directive"><span class="token keyword">listen</span> <span class="token number">3306</span></span><span class="token punctuation">;</span>
         <span class="token directive"><span class="token keyword">proxy_pass</span> 192.168.110.101:3306</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
</code></pre></div><p>MySQL服务器，端口3306（集群环境）</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">stream</span></span>  <span class="token punctuation">{</span>
     <span class="token directive"><span class="token keyword">upstream</span> mysql_socket</span> <span class="token punctuation">{</span>
         <span class="token directive"><span class="token keyword">server</span> 192.168.110.101:3306</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
     <span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
             <span class="token directive"><span class="token keyword">listen</span> <span class="token number">3306</span></span><span class="token punctuation">;</span>
             <span class="token directive"><span class="token keyword">proxy_pass</span> mysql_socket</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
</code></pre></div><p><code>allow</code>:该指令设置指定的IP允许访问。可以和deny指令配合使用</p> <ul><li>作用域：stream, server</li> <li>语法：allow address | CIDR | unix: | all;</li></ul> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token comment"># 允许192.168.110.1访问</span>
 <span class="token directive"><span class="token keyword">allow</span> 192.168.110.1</span><span class="token punctuation">;</span>
 
 <span class="token comment"># 允许192.168.110.1到192.168.255.254</span>
 <span class="token directive"><span class="token keyword">allow</span> 192.168.110.0/16</span><span class="token punctuation">;</span>
 
 <span class="token comment"># 允许192.168.110.1到192.168.110.254</span>
 <span class="token directive"><span class="token keyword">allow</span> 192.168.110.0/24</span><span class="token punctuation">;</span>
 
 <span class="token comment"># 允许所有的IP访问</span>
 <span class="token directive"><span class="token keyword">allow</span> all</span><span class="token punctuation">;</span>
</code></pre></div><p><code>deny</code>:该指令设置指定的IP禁止访问。可以和allow指令配合使用。</p> <ul><li>作用域：stream, server</li> <li>语法：deny address | CIDR | unix: | all;</li></ul> <div class="language-nginx extra-class"><pre class="language-nginx"><code> <span class="token comment"># 禁止192.168.110.1访问</span>
 <span class="token directive"><span class="token keyword">deny</span> 192.168.110.1</span><span class="token punctuation">;</span>
 
 <span class="token comment"># 禁止192.168.110.1到192.168.255.254</span>
 <span class="token directive"><span class="token keyword">deny</span> 192.168.110.0/16</span><span class="token punctuation">;</span>
 
 <span class="token comment"># 禁止192.168.110.1到192.168.110.254</span>
 <span class="token directive"><span class="token keyword">deny</span> 192.168.110.0/24</span><span class="token punctuation">;</span>
 
 <span class="token comment"># 禁止所有的IP访问</span>
 <span class="token directive"><span class="token keyword">deny</span> all</span><span class="token punctuation">;</span>
</code></pre></div><p>配置示例</p> <p>禁止所有的IP访问，192.168.110.100除外。</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">allow</span> 192.168.110.100</span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">deny</span> all</span><span class="token punctuation">;</span>
</code></pre></div><p>Tips：如果指定了allow，需要配合deny使用，否则就是允许所有的IP地址访问。</p> <p>只允许192.168.110.100通过Nginx连接MySQL服务器。</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">stream</span></span>  <span class="token punctuation">{</span>
     <span class="token directive"><span class="token keyword">allow</span> 192.168.110.100</span><span class="token punctuation">;</span>
     <span class="token directive"><span class="token keyword">deny</span> all</span><span class="token punctuation">;</span>
     <span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
         <span class="token directive"><span class="token keyword">listen</span> <span class="token number">3306</span></span><span class="token punctuation">;</span>
         <span class="token directive"><span class="token keyword">proxy_pass</span> 192.168.110.101:3306</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
</code></pre></div><h2 id="三、负载均衡"><a href="#三、负载均衡" class="header-anchor">#</a> 三、负载均衡</h2> <img src="/assets/img/image-20240330095654992.29a031b4.png" alt="image-20240330095654992" style="zoom:50%;"> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">upstream</span> webservers</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">ip_hash</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server</span> 192.168.1.100:8080</span><span class="token punctuation">;</span>
 	<span class="token directive"><span class="token keyword">server</span> 192.168.1.101:8080</span><span class="token punctuation">;</span>   
<span class="token punctuation">}</span>

<span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> _</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">proxy_pass</span> http://webservers</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_set_header</span> Host <span class="token variable">$host</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Real-IP <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="轮询-默认"><a href="#轮询-默认" class="header-anchor">#</a> 轮询(默认)</h3> <p>每个请求按时间顺序逐一分配到不同的后端服务器，如果后端服务器down掉，能自动剔除。</p> <div class="language- extra-class"><pre class="language-text"><code>upstream backserver { 
server 192.168.0.14; 
server 192.168.0.15; 
}
</code></pre></div><h3 id="指定权重"><a href="#指定权重" class="header-anchor">#</a> 指定权重</h3> <p>指定轮询几率，weight和访问比率成正比，用于后端服务器性能不均的情况。</p> <div class="language-text extra-class"><pre class="language-text"><code>upstream backserver { 
server 192.168.0.14 weight=8; 
server 192.168.0.15 weight=10; 
} 
</code></pre></div><h3 id="ip绑定-ip-hash"><a href="#ip绑定-ip-hash" class="header-anchor">#</a> IP绑定 ip_hash</h3> <p>每个请求按访问ip的hash结果分配，这样每个访客固定访问一个后端服务器，可以解决session的问题。</p> <div class="language-text extra-class"><pre class="language-text"><code>upstream backserver { 
ip_hash; 
server 192.168.0.14:88; 
server 192.168.0.15:80; 
}
</code></pre></div><h3 id="fair-第三方"><a href="#fair-第三方" class="header-anchor">#</a> fair（第三方）</h3> <p>按后端服务器的响应时间来分配请求，响应时间短的优先分配。</p> <div class="language-text extra-class"><pre class="language-text"><code>upstream backserver { 
server server1; 
server server2; 
fair; 
} 
</code></pre></div><h3 id="url-hash-第三方"><a href="#url-hash-第三方" class="header-anchor">#</a> url_hash（第三方）</h3> <p>按访问url的hash结果来分配请求，使每个url定向到同一个后端服务器，后端服务器为缓存时比较有效。</p> <div class="language-text extra-class"><pre class="language-text"><code>upstream backserver { 
server squid1:3128; 
server squid2:3128; 
hash $request_uri; 
hash_method crc32; 
} 
</code></pre></div><h2 id="四、url重定向"><a href="#四、url重定向" class="header-anchor">#</a> 四、URL重定向</h2> <img src="/assets/img/image-20240330095731707.967f0a9d.png" alt="image-20240330095731707" style="zoom:50%;"> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token comment"># 域名重定向</span>
<span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span>	<span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span>	old.example.org</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">rewrite</span> ^/(.*)$ https://new.example.org/<span class="token variable">$1</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment"># 路径重定向</span>
<span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span>	<span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span>	old.example.org</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">rewrite</span> ^/old-path/(.*)$ /new-path/<span class="token variable">$1</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="五、防盗链"><a href="#五、防盗链" class="header-anchor">#</a> 五、防盗链</h2> <img src="/assets/img/image-20240330100140728.3810ad09.png" alt="image-20240330100140728" style="zoom:50%;"> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span>	<span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span>	_</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">location</span> ~* \.(gif|jpg|png)$</span> <span class="token punctuation">{</span>
        <span class="token comment"># 允许这个域名的访问，其他域名访问禁止</span>
        <span class="token directive"><span class="token keyword">valid_referers</span> none blocked *.example.org</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">if</span> (<span class="token variable">$invalid_referer</span>)</span> <span class="token punctuation">{</span>
            <span class="token directive"><span class="token keyword">return</span> <span class="token number">403</span></span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="六、手机端重定向pc端"><a href="#六、手机端重定向pc端" class="header-anchor">#</a> 六、手机端重定向PC端</h2> <img src="/assets/img/image-20240330100500675.fb6c64e5.png" alt="image-20240330100500675" style="zoom:50%;"> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span>	<span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span>	_</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">if($http_user_agent</span> ~* <span class="token string">'(android|iphone|ipad)'</span>)</span><span class="token punctuation">{</span>
            <span class="token directive"><span class="token keyword">rewrite</span> ^/(.*)$ https://m.example.org/<span class="token variable">$1</span></span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="七、基于请求路径转发不同服务"><a href="#七、基于请求路径转发不同服务" class="header-anchor">#</a> 七、基于请求路径转发不同服务</h2> <img src="/assets/img/image-20240330101003632.1f9d9751.png" alt="image-20240330101003632" style="zoom:50%;"> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span>	<span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span>	_</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">proxy_pass</span> http://192.168.1.100</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_set_header</span> Host <span class="token variable">$host</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Real-IP <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token directive"><span class="token keyword">location</span> /beijing/</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">proxy_pass</span> http://192.168.1.101</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_set_header</span> Host <span class="token variable">$host</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Real-IP <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token directive"><span class="token keyword">location</span> /shanghai/</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">proxy_pass</span> http://192.168.1.102</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_set_header</span> Host <span class="token variable">$host</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Real-IP <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="四、url重定向-2"><a href="#四、url重定向-2" class="header-anchor">#</a> 四、URL重定向</h2> <img src="/assets/img/image-20240330095731707-1723702133339-12.967f0a9d.png" alt="image-20240330095731707" style="zoom:50%;"> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token comment"># 域名重定向</span>
<span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span>	<span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span>	old.example.org</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">rewrite</span> ^/(.*)$ https://new.example.org/<span class="token variable">$1</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment"># 路径重定向</span>
<span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span>	<span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span>	old.example.org</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">rewrite</span> ^/old-path/(.*)$ /new-path/<span class="token variable">$1</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="五、防盗链-2"><a href="#五、防盗链-2" class="header-anchor">#</a> 五、防盗链</h2> <img src="/assets/img/image-20240330100140728-1723702133339-11.3810ad09.png" alt="image-20240330100140728" style="zoom:50%;"> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span>	<span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span>	_</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">location</span> ~* \.(gif|jpg|png)$</span> <span class="token punctuation">{</span>
        <span class="token comment"># 允许这个域名的访问，其他域名访问禁止</span>
        <span class="token directive"><span class="token keyword">valid_referers</span> none blocked *.example.org</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">if</span> (<span class="token variable">$invalid_referer</span>)</span> <span class="token punctuation">{</span>
            <span class="token directive"><span class="token keyword">return</span> <span class="token number">403</span></span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="六、手机端重定向pc端-2"><a href="#六、手机端重定向pc端-2" class="header-anchor">#</a> 六、手机端重定向PC端</h2> <img src="/assets/img/image-20240330100500675-1723702133339-13.fb6c64e5.png" alt="image-20240330100500675" style="zoom:50%;"> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span>	<span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span>	_</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">if($http_user_agent</span> ~* <span class="token string">'(android|iphone|ipad)'</span>)</span><span class="token punctuation">{</span>
            <span class="token directive"><span class="token keyword">rewrite</span> ^/(.*)$ https://m.example.org/<span class="token variable">$1</span></span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="七、基于请求路径转发不同服务-2"><a href="#七、基于请求路径转发不同服务-2" class="header-anchor">#</a> 七、基于请求路径转发不同服务</h2> <img src="/assets/img/image-20240330101003632-1723702133339-14.1f9d9751.png" alt="image-20240330101003632" style="zoom:50%;"> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span>	<span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span>	_</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">proxy_pass</span> http://192.168.1.100</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_set_header</span> Host <span class="token variable">$host</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Real-IP <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token directive"><span class="token keyword">location</span> /beijing/</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">proxy_pass</span> http://192.168.1.101</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_set_header</span> Host <span class="token variable">$host</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Real-IP <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token directive"><span class="token keyword">location</span> /shanghai/</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">proxy_pass</span> http://192.168.1.102</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_set_header</span> Host <span class="token variable">$host</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Real-IP <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="八、目录索引"><a href="#八、目录索引" class="header-anchor">#</a> 八、目录索引</h2> <ul><li><p>Nginx默认是不允许列出整个目录浏览下载</p></li> <li><p>配置目录索引的命令</p> <ul><li><p>语法格式：autoindex on | off ; on开启 off关闭</p></li> <li><p>默认配置：autoindex off; 如果默认开启的话所有的文件都会以列表形式累出来，这些文件是不能给用户看到的</p></li> <li><p>配置区域：http（对所有站点生效）、server（对单个站点生效）、location（对单个页面生效，最常用）</p></li></ul></li> <li><p>autoindex常用参数</p> <ul><li><p>autoindex_exact_size off; 修改为on表示显示出文件的确切大小，单位是bytes，修改为off表示显示出文件的大概大小，单位是kb或者mb或者gb</p></li> <li><p>autoindex_localtime on; 修改为on表示显示的时间为服务器中文件的时间，修改为off表示显示文件时间为GMT时间</p></li> <li><p>charset utf-8,gbk; 默认中文目录乱码，添加上解决乱码，一般只配置一个utf-8即可，如果配置了utf8不行，那么久加上gbk</p></li></ul></li> <li><p>案例：实现目录索引</p></li> <li><p>需求：1.当访问know.com时打开首页，2.访问know.com/download则打开目录索引列表</p></li> <li><p>注意：对单个页面实现目录索引，则在location /xxx{}中进行配置，想要实现首页目录索引，则在location /中配置</p></li></ul> <div class="language-nginx extra-class"><pre class="language-nginx"><code>[root@localhost <span class="token directive"><span class="token keyword">conf.d]#</span> vim know.conf
server</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> know.com</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">root</span>    /web/know</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">index</span>   index.html</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token directive"><span class="token keyword">location</span> /download</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">root</span> /web/know</span><span class="token punctuation">;</span>
        <span class="token comment"># 开启目录文件列表</span>
        <span class="token directive"><span class="token keyword">autoindex</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
        <span class="token comment"># 显示出文件的确切大小，单位是bytes</span>
        <span class="token directive"><span class="token keyword">autoindex_exact_size</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
        <span class="token comment"># 显示的文件时间为文件的服务器时间        </span>
        <span class="token directive"><span class="token keyword">autoindex_localtime</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
        <span class="token comment"># 指定字符集编码</span>
        <span class="token directive"><span class="token keyword">charset</span> utf-8,gbk</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><img src="/assets/img/image-20240330130835784.aa7766bb.png" alt="image-20240330130835784"></p> <h2 id="九、nginx状态监控-了解"><a href="#九、nginx状态监控-了解" class="header-anchor">#</a> 九、Nginx状态监控（了解）</h2> <ul><li>ngx_http_stub_status_module用于展示nginx连接状态信息，需要–with-http_stub_module模块支持</li> <li>配置状态监控命令
<ul><li>语法格式：stub_status; 老版本的nginx需要在后面加个on</li> <li>默认配置：-</li> <li>配置文件：server（对单个站点生效）、location（对单个页面生效，最常用）</li></ul></li> <li>配置nginx status</li></ul> <div class="language-nginx extra-class"><pre class="language-nginx"><code>[root@localhost <span class="token directive"><span class="token keyword">conf.d]#</span> vim know.conf
server</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> know.com</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">root</span>    /web/know</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">index</span>   index.html</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token directive"><span class="token keyword">location</span> /nginx_status</span> <span class="token punctuation">{</span>			//这里必须是nginx_status
            <span class="token directive"><span class="token keyword">stub_status</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">access_log</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span>		//这一项必须加上，表示不把此页面的访问写入到日志中
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><img src="/assets/img/image-20240330102708815.68dad23b.png" alt="image-20240330102708815"> <ul><li>注意：
<ul><li>如果使用restart重置服务，会清空所有的连接数</li> <li>reload重载不会清空之前的连接数</li> <li>通过状态监控，可以验证长连接和短连接的区别</li> <li>设置短连接只需要修改/etc/nginx/nginx.conf文件中keepalive_timeout 0;即可</li></ul></li></ul> <h2 id="十、nginx访问控制"><a href="#十、nginx访问控制" class="header-anchor">#</a> 十、Nginx访问控制</h2> <h3 id="nginx基于ip的访问控制"><a href="#nginx基于ip的访问控制" class="header-anchor">#</a> Nginx基于ip的访问控制</h3> <ul><li>基于ip的访问控制 http_access_module</li> <li>配置命令</li> <li>允许配置语法
<ul><li>语法格式：<code>allow *address|CIDR|unix:|all*;</code></li> <li>默认配置：-</li> <li>配置区域：http（对所有站点生效）、server（对单个站点生效）、location（对单个页面生效，最常用）、limit_except（特殊位置）</li></ul></li> <li>拒绝配置语法
<ul><li>语法格式：<code>deny *address|CIDR|unix:|all*;</code></li> <li>默认配置：-</li> <li>配置区域：<code>http、server、location、limit_except</code></li></ul></li> <li>访问控制规则查看流程：从上往下、依次匹配，满足就不再继续，和网络中的acl规则一致</li> <li>企业中访问控制思路
<ul><li>先写允许的就默认拒绝所有</li> <li>先写拒绝的就默认允许所有</li></ul></li> <li>常见配置
<ul><li>允许一个：<code>allow 192.168.81.210</code></li> <li>允许一个网段：<code>allow 192.168.81.0/24</code></li> <li>允许多个网段就多写几个allow</li> <li>允许所有<code>allow all</code></li> <li>拒绝一个：<code>deny 192.168.81.210</code></li> <li>拒绝一个网段：<code>deny 192.168.81.0/24</code></li> <li>拒绝多个网段就多写几个deny</li> <li>拒绝所有<code>deny all</code></li></ul></li> <li>案例1：只允许<code>192.168.81.1</code>访问nginx_status，其他都拒绝</li></ul> <div class="language-nginx extra-class"><pre class="language-nginx"><code>[root@localhost <span class="token directive"><span class="token keyword">conf.d]#</span> vim know.conf
location /nginx_status</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">stub_status</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">access_log</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">allow</span> 192.168.81.1</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">deny</span> all</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>案例2，拒绝192.168.81.1访问nginx_status，其他都允许</li></ul> <div class="language-nginx extra-class"><pre class="language-nginx"><code>[root@localhost <span class="token directive"><span class="token keyword">conf.d]#</span> vim know.conf
location /nginx_status</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">stub_status</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">access_log</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">deny</span> 192.168.81.1</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">allow</span> all</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="nginx基于用户认证访问控制"><a href="#nginx基于用户认证访问控制" class="header-anchor">#</a> Nginx基于用户认证访问控制</h3> <ul><li><p>基于用户登录认证：http_auth_basic_module</p></li> <li><p>认证配置命令</p> <ul><li>语法格式：auth_basic <em>string</em> |off; string表示描述信息，off表示关闭</li> <li>默认配置：auth_basic off;</li> <li>配置区域：http（对所有站点生效）、server（对单个站点生效）、location（对单个页面生效，最常用）、limit_except（特殊位置）</li></ul></li> <li><p>用户密码配置文件</p> <ul><li>语法格式：auth_basic_user_file <em>filepath</em>；</li> <li>默认配置：-</li> <li>配置区域：配置区域：http（对所有站点生效）、server（对单个站点生效）、location（对单个页面生效，最常用）、limit_except（特殊位置）</li></ul></li> <li><p>实例</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code>生成用户密码文件
[root@localhost ~]# <span class="token directive"><span class="token keyword">htpasswd</span> -b -c /etc/nginx/.auth_passwd.conf admin <span class="token number">123456</span>
Adding password for user admin	
//首次创建使用-c创建出文件，第二次添加用户时不能使用-c，会把原来内容覆盖，-b表示命令行中一并输入用户名和密码而不是根据提示输入密码，可以看见明文，不需要交互，-D 删除指定的用户，建议多创建一些账号密码给不同人使用，某人离职后使用-D给他删掉
[root@localhost ~]# htpasswd -b /etc/nginx/.auth_passwd.conf jiangxl <span class="token number">123456</span>
Adding password for user jiangxl

删除用户
[root@localhost ~]# htpasswd -D /etc/nginx/.auth_passwd.conf wuzh
Deleting password for user wuzh
[root@localhost ~]# cat /etc/nginx/.auth_passwd.conf 
admin:<span class="token variable">$apr1</span><span class="token variable">$ZanWwGuM</span><span class="token variable">$HSZAnt6DfJ0QQ3QK8xFp3</span>.
jiangxl:<span class="token variable">$apr1</span><span class="token variable">$57gO0dsC</span><span class="token variable">$oNVF71wAfQN2qgTck8iI</span>//

[root@localhost conf.d]# vim know.conf
server</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> know.com</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">root</span>    /web/know</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">index</span>   index.html</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token directive"><span class="token keyword">location</span> /download</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">alias</span> /web/know</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">autoindex</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">charset</span> utf-8,gbk</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">autoindex_exact_size</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">autoindex_localtime</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">auth_basic</span> <span class="token string">&quot;Please enter the user name password!!!&quot;</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">auth_basic_user_file</span> /etc/nginx/.auth_passwd.conf</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

[root@localhost ~]# nginx -t
nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf test is successful
[root@localhost ~]# systemctl reload nginx

谷歌看不到我么配置的提示内容，可以使用火狐
</code></pre></div></li></ul> <blockquote><p>需要安装 http 才有 htpasswd 命令</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># centos</span>
yum <span class="token function">install</span> <span class="token parameter variable">-y</span> httpd
<span class="token comment"># ubuntu</span>
<span class="token function">apt-get</span> <span class="token function">install</span> <span class="token parameter variable">-y</span> apache2-utils
</code></pre></div></blockquote> <p><img src="/assets/img/image-20240330131215041.01bad28d.png" alt="image-20240330131215041"></p> <h2 id="十一、nginx访问限制"><a href="#十一、nginx访问限制" class="header-anchor">#</a> 十一、Nginx访问限制</h2> <ul><li>经常会遇到这种情况，服务器流量异常，负载过大等等，对于大流量恶意的攻击访问，会带来带宽的浪费，服务器压力，影响业务，往往开考虑对同一个IP的连接数，并发数进行限制</li> <li>ngx_http_limit_conn_module模块可以根据定义key来限制每个键值的连接数，如同一个IP来源的连接数</li></ul> <h3 id="连接数限制"><a href="#连接数限制" class="header-anchor">#</a> 连接数限制</h3> <ul><li>HTTP请求建立在一次TCP连接基础上，一次TCP连接至少产生一次HTTP请求</li> <li>用到的变量
<ul><li>$binary_remote_addr 变量的长度是固定的4字节，表示客户端的地址存储字节，一个IP就是4字节，完全没有必要用7-15字节的，除非IPv6</li> <li>$remote_addr 变量的长度是7-15字节</li></ul></li> <li>一个IP地址=32bit=4字节，假如我们配置的策略大小是10M那么可以容纳的IP数为10M=10X024X024</li> <li>limit_conn_module连接频率限制</li> <li>NGINX连接限制预语法
<ul><li>定义连接数限制zone
<ul><li>语法格式：limit_conn_zone <em>key</em> zone=<em>name</em>:<em>size</em>;</li> <li>默认配置：-</li> <li>配置区域：http（对所有站点生效）</li></ul></li> <li>调用连接数限制zone
<ul><li>语法格式：limit_conn <em>name number</em>;</li> <li>默认配置：-</li> <li>配置区域：http（对所有站点生效）、server（对单个站点生效）、location（对单个页面生效，最常用）</li></ul></li></ul></li> <li>实例</li></ul> <div class="language-nginx extra-class"><pre class="language-nginx"><code>首先定义一个zone限制，可以定义多个，对不同站点做不同的限制，配置在http模块中，按着正规配置就配置在nginx.conf中的http中，也可以配置到单个server配置中的最上方
[root@localhost <span class="token directive"><span class="token keyword">conf.d]#</span> vim /etc/nginx/nginx.conf
http</span> <span class="token punctuation">{</span>
 	.....
 	.....
    <span class="token directive"><span class="token keyword">limit_conn_zone</span> <span class="token variable">$binary_remote_addr</span> zone=know_conn:10m</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">include</span> /etc/nginx/conf.d/*.conf</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

限制同一个IP来源的数量
[root@localhost <span class="token directive"><span class="token keyword">conf.d]#</span> vim know.conf
limit_conn_zone <span class="token variable">$binary_remote_addr</span> zone=know_conn:10m</span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">server_name</span> know.com</span><span class="token punctuation">;</span>

        <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
                <span class="token directive"><span class="token keyword">root</span>    /web/know</span><span class="token punctuation">;</span>
                <span class="token directive"><span class="token keyword">index</span>   index.html</span><span class="token punctuation">;</span>
                <span class="token directive"><span class="token keyword">limit_conn</span> know_conn <span class="token number">1</span></span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span>        

[root@localhost ~]# <span class="token directive"><span class="token keyword">nginx</span> -t
nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf test is successful

[root@localhost ~]# systemctl reload nginx

解释：
	limit_conn_zone <span class="token variable">$binary_remote_addr</span> zone=know_conn:10m</span><span class="token punctuation">;</span>		//定义一个限制，将用户的IP保存到变量$binary_remote_addr中，定义限制的名称是know_conn大小为10m
	<span class="token directive"><span class="token keyword">limit_conn</span> know_conn <span class="token number">1</span></span><span class="token punctuation">;</span>		//调用刚刚定义的限制zone，1表示同一时刻只允许一个客户端ip连接
</code></pre></div><p>压力测试</p> <div class="language- extra-class"><pre class="language-text"><code>[root@localhost ~]# ab -n 30000 -c 200 http://know.com/index.html
</code></pre></div><ul><li><p>博客详细介绍https://www.cnblogs.com/jingmin/p/9100747.html</p></li> <li><p>重要参数解释</p></li></ul> <table><thead><tr><th>参数</th> <th>含义</th></tr></thead> <tbody><tr><td>Server Software</td> <td>服务器软件名称及版本信息)</td></tr> <tr><td>Server Hostname</td> <td>服务器主机名</td></tr> <tr><td>Server Port</td> <td>服务器端口</td></tr> <tr><td>Document Path</td> <td>供测试的URL路径</td></tr> <tr><td>Document Length</td> <td>供测试的URL返回的文档大小</td></tr> <tr><td>Concurrency Level</td> <td>并发数</td></tr> <tr><td>Time taken for tests</td> <td>压力测试消耗的总时间</td></tr> <tr><td>Complete requests</td> <td>压力测试的的总次数</td></tr> <tr><td>Failed requests</td> <td>失败的请求数</td></tr> <tr><td>Total transferred</td> <td>传输的总数据量</td></tr> <tr><td>HTML transferred</td> <td>HTML文档的总数据量</td></tr> <tr><td>Requests per second</td> <td>平均每秒的请求数</td></tr></tbody></table> <h3 id="请求数限制"><a href="#请求数限制" class="header-anchor">#</a> 请求数限制</h3> <ul><li>limit_req_module请求频率限制</li> <li>请求数限制语法
<ul><li>定义请求数限制语法
<ul><li>语法格式：limit_req_zone <em>key</em> zone=<em>name:size</em> rate=<em>rate</em>;</li> <li>默认配置：-</li> <li>配置区域：http（对所有站点生效）</li></ul></li> <li>调用请求数限制语法
<ul><li>语法格式：limit_req zone number [burst=number] [nodelay];</li> <li>默认配置：-</li> <li>配置区域：http（对所有站点生效）、server（对单个站点生效）、location（对单个页面生效，最常用）</li></ul></li></ul></li> <li>请求数配置实例</li></ul> <div class="language- extra-class"><pre class="language-text"><code>[root@localhost conf.d]# vim know.conf
limit_req_zone $binary_remote_addr zone=know_req:10m rate=1r/s;
server {
        listen 80;
        server_name know.com;

        location / {
                root    /web/know;
                index   index.html;
                limit_req zone=know_req burst=3 nodelay;
        }
}        

解释：
	limit_req_zone $binary_remote_addr zone=know_req:10m rate=1r/s;		//定义一个req请求限制，把ip保存在变量中，zone名称是know_req大小10m，频率为1r/s表示1秒只能请求1个，多了就会报错，实际工作中肯定不会是1，可以根据自身应用的情况来进行调优，800-900适中
	limit_req zone=know_req burst=3 nodelay;   //调用know_req，设置最大吞吐量为3，也就是最小是1，最多请求在给3个，当超过了3个就会报错
	
[root@localhost ~]# nginx -t
nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf test is successful
[root@localhost ~]# systemctl reload nginx

使用压力测试来验证即可
[root@localhost ~]# ab -n 20 -c 10 http://know.com/index.html
</code></pre></div><h2 id="nginx-location"><a href="#nginx-location" class="header-anchor">#</a> Nginx Location</h2> <ul><li>使用Nginx Location可以控制访问网站的路径</li> <li>语法格式
<ul><li><code>location [=||*|^~] uri { … }</code></li></ul></li></ul> <h3 id="location语法优先级排序"><a href="#location语法优先级排序" class="header-anchor">#</a> Location语法优先级排序</h3> <table><thead><tr><th>匹配符</th> <th>匹配规则</th> <th>优先级</th></tr></thead> <tbody><tr><td>=</td> <td>精确匹配</td> <td>1</td></tr> <tr><td>^~</td> <td>以某个字符串开头</td> <td>2</td></tr> <tr><td>~</td> <td>区分大小写的正则匹配</td> <td>3</td></tr> <tr><td>~*</td> <td>不区分大小写的正则匹配</td> <td>4</td></tr> <tr><td>!~</td> <td>区分大小写的不匹配正则</td> <td>5</td></tr> <tr><td>!~*</td> <td>不区分大小写的不匹配正则</td> <td>6</td></tr> <tr><td>/</td> <td>通用匹配，任何请求都会匹配到</td> <td>7</td></tr></tbody></table> <h3 id="配置location优先级"><a href="#配置location优先级" class="header-anchor">#</a> 配置location优先级</h3> <div class="language-nginx extra-class"><pre class="language-nginx"><code>[root@localhost <span class="token directive"><span class="token keyword">conf.d]#</span> vim testserver.conf
server</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> jiangxl.com</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">default_type</span> text/html</span><span class="token punctuation">;</span>			网站类型，必须是文本文档或者html
            <span class="token directive"><span class="token keyword">return</span> <span class="token number">200</span> <span class="token string">&quot;location / jiang&quot;</span></span><span class="token punctuation">;</span>	如果访问代码是200则显示location / jiang
    <span class="token punctuation">}</span>

    <span class="token comment">#location =/ {</span>
    <span class="token comment">#       default_type text/html;</span>
    <span class="token comment">#       return 200 &quot;location =/ xiao&quot;;</span>
    <span class="token comment">#}</span>

    <span class="token directive"><span class="token keyword">location</span> ~ /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">default_type</span> text/html</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">return</span> <span class="token number">200</span> <span class="token string">&quot;location ~/ long&quot;</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="location应用场景"><a href="#location应用场景" class="header-anchor">#</a> location应用场景</h3> <div class="language-nginx extra-class"><pre class="language-nginx"><code>通用匹配，任何请求都会匹配到
<span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>

严格区分大小写，匹配以php结尾的都在这个location
<span class="token directive"><span class="token keyword">location</span> ~ \.php$</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">fastcgi_pass</span> http://127.0.0.1:9000</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

严格区分大小写，匹配jsp结尾的都在这个location
<span class="token directive"><span class="token keyword">location</span> ~ \.jsp$</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">proxy_pass</span> http://127.0.0.1:8080</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

不区分大小写匹配，只要访问.jpg,gif,png,js,css都都这条location
<span class="token directive"><span class="token keyword">location</span> ~* .*\.(jpg|gif|png|js|css)</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">rewrite</span> (.*) http://cdn.oldboyedu.com<span class="token variable">$request_url</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

不区分大小写匹配
<span class="token directive"><span class="token keyword">location</span> ~* .*\.(sql|bak|tgz|tar.gz|git)$</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">default_type</span> text/html</span><span class="token punctuation">;</span>
    return 403 &quot;启用访问控制成功&quot;
<span class="token punctuation">}</span>

区分大小写拒绝访问网页中的avi文件
<span class="token directive"><span class="token keyword">location</span> ~ .*\.avi$</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">deny</span> all</span><span class="token punctuation">;</span>
    <span class="token comment">#return 403 &quot;拒绝成功&quot;;</span>
<span class="token punctuation">}</span>

不区分大小写拒绝访问网页中关于音视频的文件
<span class="token directive"><span class="token keyword">location</span> ~* .*\.(avi|mp3|mp4|pbb)$</span> <span class="token punctuation">{</span>		//前面匹配任意一个字符到多个字符结尾包含.avi或者.mp3或者.mp4或者.pbb的文件
        <span class="token directive"><span class="token keyword">deny</span> all</span><span class="token punctuation">;</span>
    <span class="token comment">#return 403 &quot;拒绝成功&quot;</span>
<span class="token punctuation">}</span>

不区分大小写拒绝网页中的任意图片格式
<span class="token directive"><span class="token keyword">location</span> ~* .*\.(jpg|gif|png|jpeg)$</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">deny</span> all</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

拒绝访问sql、bak、tgz、tar.gz、.git文件
<span class="token directive"><span class="token keyword">location</span> ~* .*\.(sql|bak|tgz|tar.gz|git)$</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">return</span> <span class="token number">403</span> <span class="token string">&quot;启用访问控制成功&quot;</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="nginx日志"><a href="#nginx日志" class="header-anchor">#</a> Nginx日志</h2> <ul><li>Nginx有非常灵活的日志记录模式。每个级别的配置可以有各自独立的访问日志，也就是说每个站点都可以有自己独立的访问日志，日志格式可以通过log_format命令定义格式</li></ul> <h3 id="log-format配置"><a href="#log-format配置" class="header-anchor">#</a> log_format配置</h3> <ul><li><p>log_format指令</p> <ul><li>配置语法对error.log、access.log都生效</li> <li>语法格式：log_format <em>name</em> [escape=default|json string…;</li> <li>默认配置：log_format combined “…”;</li> <li>配置区域：http(对所有站点生效)</li></ul></li> <li><p>默认的Nginx定义日志语法</p> <div class="language- extra-class"><pre class="language-text"><code>默认配置
log_format  main  '$remote_addr - $remote_user [$time_local] &quot;$request&quot; '
                  '$status $body_bytes_sent &quot;$http_referer&quot; '
                  '&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;';

192.168.81.1 - - [07/Apr/2020:18:26:12 +0800] &quot;GET /linux-data/linux-txt.html HTTP/1.1&quot; 200 2875 &quot;http://know.com/&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3770.80 Safari/537.36&quot; &quot;-&quot;

如果做了代理或者负载可以用如下配置
log_format main '$remote_addr $remote_user [$time_local] “$request” '
				'$status $body_bytes_sent “$http_referer” '
				'$http_user_agent $http_x_forwarded_for $request_time 			$upstream_response_time $upstream_addr $upstream_status';
				
log_format用来定义，main是定义的日志名称
可以定义多个log_format，用不同的名字区分最后调用即可
</code></pre></div></li> <li><p>Nginx日志格式允许保安的变量</p> <table><thead><tr><th>变量名</th> <th>日志内容</th> <th>作用</th></tr></thead> <tbody><tr><td>$remote_addr</td> <td>192.168.81.1</td> <td>记录客户端IP地址</td></tr> <tr><td>$remote_user</td> <td>-</td> <td>记录客户端用户名一般为空</td></tr> <tr><td>$time_local</td> <td>[07/Apr/2020:18:26:12 +0800]</td> <td>记录通用的本地时间</td></tr> <tr><td>$time_iso8601</td> <td>[2020-04-07T18:31:29+08:00]</td> <td>记录ISO8601标准格式下的本地时间</td></tr> <tr><td>$request</td> <td>&quot;GET /linux-data/linux-txt.html HTTP/1.1</td> <td>记录请求的方法以及请求的http协议以及请求的文件</td></tr> <tr><td>$status</td> <td>200</td> <td>记录请求状态码</td></tr> <tr><td>$body_bytes_sent</td> <td>2875</td> <td>发送给客户端的资源字节数</td></tr> <tr><td>$bytes_sent</td> <td>180</td> <td>发送给客户端的总字节数</td></tr> <tr><td>$msec</td> <td>1586256157.677</td> <td>日志写入时间，单位为秒，精度是毫秒</td></tr> <tr><td>$http_referer</td> <td>“http://know.com/”</td> <td>记录从哪个页面连接访问过来的</td></tr> <tr><td>$http_host</td> <td>know.com</td> <td>请求地址，即浏览器中输入的访问地址</td></tr> <tr><td>$http_user_agent</td> <td>“Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3770.80 Safari/537.36”</td> <td>记录客户端浏览器相关信息</td></tr> <tr><td>$http_x_forwarded_for</td> <td>-</td> <td>记录客户端IP地址</td></tr> <tr><td>$request_length</td> <td>-</td> <td>请求的长度（包括请求行，请求头和请求正文）</td></tr> <tr><td>$request_time</td> <td>0.000</td> <td>请求花费的时间，单位为秒，精度毫秒</td></tr> <tr><td>$ssl_protocol</td> <td>TLSv1</td> <td>SSL协议版本</td></tr> <tr><td>$ssl_cipher</td> <td>RC4-SHA</td> <td>交换数据中的算法</td></tr> <tr><td>$upstream_addr</td> <td>192.168.81.210</td> <td>后台upstream的地址，即真正提供服务的主机地址</td></tr> <tr><td>$upstream_response_time</td> <td>-</td> <td>请求过程中upstream后台服务器的响应时间</td></tr> <tr><td>$upstream_status</td> <td>200</td> <td>后台服务器响应的状态码</td></tr></tbody></table></li> <li><p>注意：如果nginx位于负载均衡器，nginx反向代理后，web服务器无法直接获取客户端的真实ip地址</p></li> <li><p>$remote_addr获取的是反向代理的ip地址，反向代理服务器在转发请求的http头信息中</p></li> <li><p>增加x-forwarded-for信息，用来记录客户端ip地址和客户端请求的服务器地址，即使客户端设置了代理服务器，同样能看到客户端的源地址，代理服务器和web服务器都需要配置for_forwarded_for</p></li></ul> <h3 id="access-log配置"><a href="#access-log配置" class="header-anchor">#</a> access_log配置</h3> <ul><li>access_log指令
<ul><li>语法格式：access_log <em>path</em> [format [buffer=size] [gzip[=level]] [flush=time] [if=condition] ];</li> <li>access_log off;</li> <li>默认配置：access_log logs/access.log <em>combined</em>;</li> <li>配置区域：配置区域：http（对所有站点生效）、server（对单个站点生效）、location（对单个页面生效，最常用）、limit_except（特殊位置）</li></ul></li></ul> <h3 id="日志配置实例"><a href="#日志配置实例" class="header-anchor">#</a> 日志配置实例</h3> <p>需求：对所有站点设置单独的访问日志和错误日志，并定义不同的日志格式</p> <h5 id="定义不同的日志格式"><a href="#定义不同的日志格式" class="header-anchor">#</a> 定义不同的日志格式</h5> <div class="language- extra-class"><pre class="language-text"><code>修改主配置文件nginx.conf，把其中的access_log、error_log注释掉，并增加多个log_format
即使注释掉，新的站点如果不定义access_log/error_log依然会存放到默认的路径下
[root@localhost conf.d]# vim ../nginx.conf 
#error_log  /var/log/nginx/error.log warn;
http {
.....
    log_format  know_log  '$remote_addr - $remote_user [$time_local] $http_host   &quot;$request&quot; $request_time '
                      '$status $body_bytes_sent &quot;$http_referer&quot; '
                      '&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;';


    log_format  shangmei_log  '$remote_addr - $http_host $remote_user [$time_local]  &quot;$request&quot; $request_time '
                      '$status $body_bytes_sent &quot;$http_referer&quot; '
                      '&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;';

    #access_log  /var/log/nginx/access.log  main;
....
}
</code></pre></div><h5 id="编辑know-com配置文件"><a href="#编辑know-com配置文件" class="header-anchor">#</a> 编辑know.com配置文件</h5> <div class="language- extra-class"><pre class="language-text"><code>修改站点know.com的配置文件，增加access_log、error_log
[root@localhost conf.d]# vim know.conf
server {
        listen 80;
        server_name know.com;
        access_log  /nginx_log/know_access.log know_log;   调用刚刚在主配置文件中增加的know_log
        error_log /nginx_log/know_error.log warn;
        ...
}
</code></pre></div><h5 id="编辑shangmei-com配置文件"><a href="#编辑shangmei-com配置文件" class="header-anchor">#</a> 编辑shangmei.com配置文件</h5> <div class="language- extra-class"><pre class="language-text"><code>修改站点shangmei.com的配置文件
[root@localhost conf.d]# vim shangmei.conf
server {
        listen 80;
        server_name shangmei.com;
        access_log /nginx_log/shangmei_access.log shangmei_log;
        error_log /nginx_log/shangmei_error.log warn;
        ...
}
</code></pre></div><h5 id="新建nginx日志目录并重载"><a href="#新建nginx日志目录并重载" class="header-anchor">#</a> 新建nginx日志目录并重载</h5> <div class="language- extra-class"><pre class="language-text"><code>[root@localhost conf.d]# mkdir /nginx_log

[root@localhost conf.d]# nginx -t
nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf test is successful
[root@localhost conf.d]# systemctl reload nginx

[root@localhost conf.d]# ls /nginx_log/
know_access.log  know_error.log  shangmei_access.log  shangmei_error.log
</code></pre></div><h5 id="验证"><a href="#验证" class="header-anchor">#</a> 验证</h5> <div class="language- extra-class"><pre class="language-text"><code>验证，发现对应的日志文件都有输出内容，并且access日志中格式也有所不同，know.com中url在第四列，shangmei.com中的url在第二列

know.com站点
[root@localhost conf.d]# tail -f /nginx_log/know_access.log 
192.168.81.1 - - [07/Apr/2020:20:39:30 +0800] know.com   &quot;GET /cisco+H3C%20data/%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%BA%94%E7%94%A8.html HTTP/1.1&quot; 0.000 304 0 &quot;http://know.com/cisco+H3C%20data/cisco-text.html&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3770.80 Safari/537.36&quot; &quot;-&quot;
[root@localhost conf.d]# tail -f /nginx_log/know_error.log 
2020/04/07 20:42:30 [error] 34599#34599: *667924 open() &quot;/web/know/cisco+H3C data/Linux笔记大全.html&quot; failed (2: No such file or directory), client: 192.168.81.1, server: know.com, request: &quot;GET /cisco+H3C%20data/Linux%E7%AC%94%E8%AE%B0%E5%A4%A7%E5%85%A8.html HTTP/1.1&quot;, host: &quot;know.com&quot;, referrer: &quot;http://know.com/cisco+H3C%20data/%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%BA%94%E7%94%A8.html&quot;

shangmei.com站点
[root@localhost conf.d]# tail -f /nginx_log/shangmei_access.log
192.168.81.1 - shangmei.com admin [07/Apr/2020:21:06:47 +0800]  &quot;GET /download/ HTTP/1.1&quot; 0.000 200 164 &quot;-&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3770.80 Safari/537.36&quot; &quot;-&quot;
[root@localhost conf.d]# tail -f /nginx_log/shangmei_error.log 
2020/04/07 20:40:16 [error] 34599#34599: *667922 open() &quot;/web/chapter/channel.js&quot; failed (2: No such file or directory), client: 192.168.81.1, server: shangmei.com, request: &quot;GET /channel.js HTTP/1.1&quot;, host: &quot;shangmei.com&quot;, referrer: &quot;http://shangmei.com/&quot;
</code></pre></div><h4 id="【扩展】编译安装实现不同日志存放"><a href="#【扩展】编译安装实现不同日志存放" class="header-anchor">#</a> 【扩展】编译安装实现不同日志存放</h4> <h5 id="server与主配置文件分离"><a href="#server与主配置文件分离" class="header-anchor">#</a> server与主配置文件分离</h5> <ul><li>编译安装的nginx如果想把serve分出来可以这样配置</li></ul> <div class="language- extra-class"><pre class="language-text"><code>[root@localhost ~]# mkdir /application/nginx/conf/conf.d
[root@localhost ~]# cd /application/nginx/conf
[root@localhost conf]# vim nginx.conf
http {
	...
	include       /application/nginx/conf/conf.d/*.conf;
	...
}
[root@localhost conf]# touch conf.d/{know.conf,shangmei.conf,liurenxing.conf}

</code></pre></div><h5 id="构造server站点和日志"><a href="#构造server站点和日志" class="header-anchor">#</a> 构造server站点和日志</h5> <div class="language- extra-class"><pre class="language-text"><code>编译安装的可能在主配置文件定义的log_format不会生效，这个不知道为啥可能跟源码包有关
解决办法是在conf.d某个文件中定义好即可，这里在know.conf中定义

know.com
[root@localhost conf]# vim conf.d/know.conf
log_format  acclog  '$remote_addr - $remote_user [$time_local] &quot;$request&quot; '
                      '$status $body_bytes_sent &quot;$http_referer&quot; '
                      '&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;';

server {
        listen 80;
        server_name know.com;
        access_log  /nginx_log/know_access.log acclog;
        error_log /nginx_log/know_error.log warn;
        location / {
                root    /web/know;
                index   index.html;
        }
}

shangmei.com
[root@localhost conf]# vim conf.d/shangmei.conf
server {
        listen 80;
        server_name shangmei.com;
        access_log /nginx_log/shangmei_access.log acclog;
        error_log /nginx_log/shangmei_error.log warn;
        location / {
                root /web/shangmei;
                index index.html;
        }
}

[root@localhost conf]# vim conf.d/liurenxing.conf
server {
        listen 80;
        server_name lrx.com;
        access_log /nginx_log/lrx_access.log acclog;
        error_log /nginx_log/lrx_error.log warn;

        location / {
                root /web/liurenxing;
                index index.htm;
        }
}
</code></pre></div><h2 id="nginx虚拟主机"><a href="#nginx虚拟主机" class="header-anchor">#</a> Nginx虚拟主机</h2> <ul><li>环境：在一台服务器上实现多个站点</li> <li>实现虚拟主机的方式
<ul><li>基于ip 不同IP实现</li> <li>基于端口 相同IP不同端口</li> <li>基于域名 相同ip相同端口不同域名</li></ul></li> <li>需求：公司有三个站点需要发布分别采用是那种不同虚拟主机来实现，并且每个站点使用不同的日志存放，know.com、shangmei.com用各自定义的log_format，lrx.com用默认的main。</li></ul> <h2 id="版本暴露问题"><a href="#版本暴露问题" class="header-anchor">#</a> 版本暴露问题</h2> <div class="language- extra-class"><pre class="language-text"><code>http {

	# 解决版本号暴露问题
	server_tokens off;
}
</code></pre></div><h2 id="ws代理"><a href="#ws代理" class="header-anchor">#</a> ws代理</h2> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span> 		<span class="token number">82</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> localhost</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">location</span> ^~ /zkhy/100/</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">autoindex</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_pass</span> http://192.168.2.100:82/</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_http_version</span> 1.1</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_set_header</span> Upgrade <span class="token variable">$http_upgrade</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_set_header</span> Connection <span class="token string">&quot;Upgrade&quot;</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_set_header</span> X-real-ip <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Forwarded-For <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_connect_timeout</span> <span class="token number">86400s</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_read_timeout</span> <span class="token number">86400s</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_send_timeout</span> <span class="token number">86400s</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span>     		<span class="token number">443</span> ssl</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span>  	localhost</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">ssl_dhparam</span>          /etc/nginx/ssl/dhparam.pem</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">ssl_certificate</span>      /etc/nginx/ssl/server.crt</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">ssl_certificate_key</span>  /etc/nginx/ssl/server.key</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">ssl_session_cache</span> 	shared:SSL:1m</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">ssl_session_timeout</span>  <span class="token number">4h</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">ssl_session_tickets</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">ssl_protocols</span> TLSv1.2</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">ssl_prefer_server_ciphers</span>  <span class="token boolean">on</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">client_max_body_size</span> <span class="token number">0</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">location</span> ^~ /webSocket/</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">autoindex</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_pass</span> http://127.0.0.1:18002/webSocket/</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_http_version</span> 1.1</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_set_header</span> Upgrade <span class="token variable">$http_upgrade</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_set_header</span> Connection <span class="token string">&quot;Upgrade&quot;</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_set_header</span> X-real-ip <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Forwarded-For <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_connect_timeout</span> <span class="token number">86400s</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_read_timeout</span> <span class="token number">86400s</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_send_timeout</span> <span class="token number">86400s</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">更新时间:</span> <span class="time">2024年8月16日星期五上午9点46分</span></div></footer> <!---->  <!----></main></div><div class="global-ui"><!----><!----><!----></div></div>
    <script src="/assets/js/app.66e0de8a.js" defer></script><script src="/assets/js/2.ee595431.js" defer></script><script src="/assets/js/25.09128d23.js" defer></script><script src="/assets/js/105.fedb9703.js" defer></script>
  </body>
</html>
